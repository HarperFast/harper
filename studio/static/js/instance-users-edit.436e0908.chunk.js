"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[40],{7211:(e,s,r)=>{r.r(s),r.d(s,{default:()=>U});var a=r(7313),t=r(8467),l=r(238),n=r(3516),o=r(6782),c=r(5399),u=r(9327),i=r(1781),d=r(7387),m=r(6160),h=r(9842),x=r(9859);const p=async e=>{let{auth:s,url:r,username:a,password:t,role:l}=e;return(0,x.Z)({operation:{operation:"alter_user",role:l,username:a,password:t,active:!0},auth:s,url:r})};var Z=r(5447),j=r(4220),w=r(2261),b=r(2066),g=r(6417);const f=function(){const{username:e}=(0,t.UO)(),[s,r]=(0,a.useState)({}),[l,n]=(0,a.useState)({}),x=(0,m.VY)(),f=(0,d.Kw)(Z.Z,(e=>e.auth)),v=(0,d.Kw)(Z.Z,(e=>e.url));return(0,g.jsx)(h.SV,{onError:(e,s)=>(0,w.Z)({error:{message:e.message,componentStack:s}}),FallbackComponent:j.Z,children:(0,g.jsxs)(o.Z,{children:[(0,g.jsxs)(c.Z,{xs:"4",className:"py-1",children:["Change user password",(0,g.jsx)("br",{}),(0,g.jsx)("span",{className:"text-small",children:"Modify user's access credentials"})]}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(i.Z,{id:"password",type:"text",className:"text-center",name:"password",placeholder:"enter new password",value:l.password||"",onChange:e=>n({...l,password:e.target.value})})}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(u.Z,{block:!0,color:"success",onClick:async()=>{const{password:s}=l;if(s){r({submitted:!0});const a=await p({auth:f,url:v,username:e,password:s});n({}),-1!==a.message.indexOf("updated")?(x.success("password updated"),(0,b.Z)({auth:f,url:v}),r({})):(x.error(a.message),r({}))}else r({error:"password is required"})},disabled:s.submitted||!l.password,children:"Update Password"})})]})})};var v=r(8212),y=r(3672),C=r.n(y);const k=function(){const{username:e}=(0,t.UO)(),[s,r]=(0,a.useState)({}),[l,n]=(0,a.useState)({}),i=(0,m.VY)(),x=(0,d.Kw)(Z.Z,(e=>e.auth)),f=(0,d.Kw)(Z.Z,(e=>e.url)),y=(0,d.Kw)(Z.Z,(e=>{var s;return parseFloat(null===(s=e.registration)||void 0===s?void 0:s.version)<3})),k=(0,d.Kw)(Z.Z,(e=>e.roles.map((e=>({label:e.role,value:y?e.id:e.role}))))),N=(0,d.Kw)(Z.Z,(s=>s.users&&s.users.find((s=>s.username===e))));return C()((()=>{var e;return n({...l,newRole:null===N||void 0===N||null===(e=N.role)||void 0===e?void 0:e.id})}),[]),(0,g.jsx)(h.SV,{onError:(e,s)=>(0,w.Z)({error:{message:e.message,componentStack:s}}),FallbackComponent:j.Z,children:(0,g.jsxs)(o.Z,{children:[(0,g.jsxs)(c.Z,{xs:"4",className:"py-1",children:["Change user role",(0,g.jsx)("br",{}),(0,g.jsx)("span",{className:"text-small",children:"Change what this user can do"})]}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(v.ZP,{className:"react-select-container",classNamePrefix:"react-select",onChange:e=>{let{value:s}=e;return n({...l,newRole:s})},options:k.filter((e=>e.value!==N.role.id)),value:k.find((e=>e.value===l.newRole)),isSearchable:!1,isClearable:!1,isLoading:!k,placeholder:"select a role",styles:{placeholder:e=>({...e,textAlign:"center",width:"100%",color:"#BCBCBC"})}})}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(u.Z,{id:"updateRole",block:!0,color:"success",onClick:async()=>{const{newRole:s}=l;if(s)if(N.role.id===s)r({error:"user already has this role"});else{r({submitted:!0});const a=await p({auth:x,url:f,username:e,role:s});-1!==a.message.indexOf("updated")?(i.success("user role updated"),(0,b.Z)({auth:x,url:f}),r({})):(i.error(a.message),r({}))}else r({error:"role is required"})},disabled:l.newRole===N.role.id||"submitted"===s,children:"Update Role"})})]})})};var N=r(8525);const S=function(){const{username:e}=(0,t.UO)(),{pathname:s}=(0,t.TH)(),r=(0,t.s0)(),[l,n]=(0,a.useState)({}),[x,p]=(0,a.useState)({}),f=(0,m.VY)(),v=(0,d.Kw)(Z.Z,(e=>e.auth)),y=(0,d.Kw)(Z.Z,(e=>e.url));return(0,g.jsx)(h.SV,{onError:(e,s)=>(0,w.Z)({error:{message:e.message,componentStack:s}}),FallbackComponent:j.Z,children:(0,g.jsxs)(o.Z,{children:[(0,g.jsxs)(c.Z,{xs:"4",className:"py-1",children:["Delete User",(0,g.jsx)("br",{}),(0,g.jsx)("span",{className:"text-small",children:"user will be removed from this instance"})]}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(i.Z,{id:"delete_username",onChange:e=>n({delete_username:e.target.value}),type:"text",className:"text-center",title:"confirm username to delete",placeholder:'Enter "'.concat(e,'" here to enable deletion.'),value:l.delete_username||""})}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(u.Z,{id:"deleteUser",block:!0,color:"success",onClick:async()=>{if(l.delete_username!==e)f.error("Please type the username to delete this user");else{p({submitted:!0});const a=await(0,N.Z)({auth:v,username:e,url:y});-1!==a.message.indexOf("successfully")?(f.success(a.message),(0,b.Z)({auth:v,url:y}),p({}),setTimeout((()=>r(s.replace("/users/".concat(e),"/users"))),0)):(f.error(a.message),p({}))}},disabled:e!==l.delete_username||x.submitted,children:x.submitted?(0,g.jsx)("i",{className:"fa fa-spinner fa-spin text-white"}):(0,g.jsx)("span",{children:"Delete User"})})})]})})};const U=function(){const{username:e}=(0,t.UO)(),{pathname:s}=(0,t.TH)(),r=(0,t.s0)();return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"floating-card-header",children:["existing users > edit > ",(0,g.jsx)("b",{children:e})]}),(0,g.jsx)(l.Z,{className:"my-3",children:(0,g.jsxs)(n.Z,{children:[(0,g.jsx)(f,{}),(0,g.jsx)("hr",{className:"my-3"}),(0,g.jsx)(k,{}),(0,g.jsx)("hr",{className:"my-3"}),(0,g.jsx)(S,{}),(0,g.jsx)("hr",{className:"my-3"}),(0,g.jsxs)(o.Z,{children:[(0,g.jsx)(c.Z,{xs:"8",className:"py-1"}),(0,g.jsx)(c.Z,{xs:"4",children:(0,g.jsx)(u.Z,{id:"returnToUserList",block:!0,color:"grey",onClick:()=>r(s.replace("/".concat(e),"")),children:"Return to User List"})})]})]})})]})}},8525:(e,s,r)=>{r.d(s,{Z:()=>t});var a=r(9859);const t=async e=>{let{auth:s,username:r,url:t}=e;return(0,a.Z)({operation:{operation:"drop_user",username:r},auth:s,url:t})}},2066:(e,s,r)=>{r.d(s,{Z:()=>l});var a=r(9859),t=r(5447);const l=async e=>{let{auth:s,url:r,signal:l}=e;const n=await(0,a.Z)({operation:{operation:"list_users"},auth:s,url:r,signal:l}),o=Array.isArray(n)?[...n].map((e=>({username:e.username,role:e.role.role}))).sort(((e,s)=>e.username.toLowerCase()>s.username.toLowerCase()?1:-1)):[];return t.Z.update((e=>{e.users=o})),o}}}]);