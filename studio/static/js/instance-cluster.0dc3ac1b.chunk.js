"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[463],{1608:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ie});var s=n(7313),a=n(7387),r=n(4122),l=n(8467),o=n(5447),i=n(6782),c=n(5399),u=n(238),d=n(3516),h=n(9842),m=n(35),p=n(4220),g=n(2261),f=n(9327),v=n(8147),b=n(4431),_=n(9859);var x=n(9481),j=n(6123),w=n.n(j),N=n(6417);function k(e){let{error:t,style:n={}}=e;return(0,N.jsx)("div",{style:n,className:w()("form-validation-error",{error:t}),children:t||"input is valid"})}var y=n(1781);const Z=function(e){let{label:t,value:n,type:a="text",max:r=null,min:l=null,editable:o=!1,handleChange:i,validator:c=(()=>!0),errorMessage:u="is required",addSpace:d=!0,valid:h=!1}=e;const[m,p]=(0,s.useState)(null);return o?(0,N.jsxs)(N.Fragment,{children:[d&&(0,N.jsx)("br",{}),(0,N.jsxs)("div",{className:w()("text-nowrap mt-2 mb-1",{"text-danger":m}),children:[t," ",m]}),(0,N.jsx)(y.Z,{id:"cluster-field-".concat(t),type:a,className:w()("cluster-field form-control",{error:m}),max:r,min:l,defaultValue:n,valid:h,onChange:e=>i(e.target.value),onBlur:e=>{const t=c(e.target.value);p(t?null:u)}})]}):(0,N.jsxs)(N.Fragment,{children:[d&&(0,N.jsx)("br",{}),(0,N.jsx)("div",{className:"text-nowrap mt-2 mb-1",children:t}),(0,N.jsx)(y.Z,{readOnly:!0,valid:!0,type:a,value:n})]})};var C=n(4851);const S=function(e){var t,n,r,l,i,c,u,d;let{setConfiguring:h,clusterStatus:m,refreshStatus:p,compute_stack_id:g}=e;const j=(0,a.Kw)(o.Z,(e=>e.auth)),w=(0,a.Kw)(o.Z,(e=>e.url)),y=m.engine,S=1024,P=65535,[E,O]=(0,s.useState)({clusterRole:null===m||void 0===m||null===(t=m.cluster_role)||void 0===t?void 0:t.role,clusterUsername:(null===m||void 0===m||null===(n=m.cluster_user)||void 0===n?void 0:n.username)||"cluster_user",clusterPassword:(null===m||void 0===m||null===(r=m.cluster_user)||void 0===r?void 0:r.password)||"",clusterPort:(null===m||void 0===m?void 0:m.config_cluster_port)||"",clusterNodeName:(null===m||void 0===m?void 0:m.node_name)||g}),[T,R]=(0,s.useState)(null);function M(e){O({...E,...e})}return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(Z,{label:"Cluster Role",handleChange:e=>M({clusterRole:e}),value:E.clusterRole,valid:E.clusterRole.trim().length>0,validator:e=>e.trim().length>0,editable:!(null!==m&&void 0!==m&&null!==(l=m.cluster_role)&&void 0!==l&&l.role),addSpace:!1}),(0,N.jsx)(Z,{label:"Cluster User",handleChange:e=>M({clusterUsername:e}),value:E.clusterUsername,valid:E.clusterUsername.trim().length>0,validator:e=>e.trim().length>0,editable:!(null!==m&&void 0!==m&&null!==(i=m.cluster_user)&&void 0!==i&&i.username)}),(0,N.jsx)(Z,{label:"Cluster Password",type:"password",handleChange:e=>M({clusterPassword:e}),value:null!==m&&void 0!==m&&null!==(c=m.cluster_user)&&void 0!==c&&c.username?"********":E.clusterPassword,valid:(null===m||void 0===m||null===(u=m.cluster_user)||void 0===u?void 0:u.username)||E.clusterPassword.trim().length>0,validator:e=>e.trim().length>0,editable:!(null!==m&&void 0!==m&&null!==(d=m.cluster_user)&&void 0!==d&&d.username),showDivider:!1}),(0,N.jsx)(Z,{label:"Cluster Port",type:"number",max:P,min:S,handleChange:e=>M({clusterPort:e}),value:E.clusterPort,valid:E.clusterPort>=S&&E.clusterPort<=P,validator:e=>e>=S&&e<=P,errorMessage:"must be between ".concat(S," and ").concat(P),editable:!(null!==m&&void 0!==m&&m.config_cluster_port)}),(0,N.jsx)(Z,{label:"Cluster Node Name",handleChange:e=>M({clusterNodeName:e}),value:E.clusterNodeName,valid:E.clusterNodeName.length>0,validator:e=>e.length>0,editable:!(null!==m&&void 0!==m&&m.node_name)}),(0,N.jsx)("hr",{className:"my-3"}),(0,N.jsx)(f.Z,{block:!0,color:"success",disabled:!function(e){var t;let{clusterRole:n,clusterUsername:s,clusterPassword:a,clusterPort:r,clusterNodeName:l}=e;return(null===n||void 0===n?void 0:n.length)>0&&s.length>0&&((null===m||void 0===m||null===(t=m.cluster_user)||void 0===t?void 0:t.username)||a.length>0)&&l.length>0&&r>=S&&r<=P}(E),onClick:async function(){var e;if(R(null),null===(e=m.cluster_role)||void 0===e||!e.role){const e=await(0,C.Z)({auth:j,url:w,role:E.clusterRole,permission:{cluster_user:!0}});if(e.error)return R(e.message)}if(!m.cluster_user){const e=await(0,x.Z)({auth:j,url:w,role:E.clusterRole,username:E.clusterUsername,password:E.clusterPassword});if(e.error)return R(e.message)}const t="nats"===y?await(0,b.Z)({auth:j,url:w,clustering_enabled:!0,clustering_nodeName:E.clusterNodeName,clustering_port:E.clusterPort,clustering_user:E.clusterUsername}):await(async e=>{let{CLUSTERING:t=!1,CLUSTERING_PORT:n,CLUSTERING_USER:s,NODE_NAME:a,auth:r,url:l}=e;return(0,_.Z)({operation:{operation:"configure_cluster",CLUSTERING:t,CLUSTERING_PORT:n,CLUSTERING_USER:s,NODE_NAME:a},auth:r,url:l})})({auth:j,url:w,CLUSTERING:!0,CLUSTERING_PORT:E.clusterPort,CLUSTERING_USER:E.clusterUsername,NODE_NAME:E.clusterNodeName});return t.error?R(t.message):(window._kmq&&window._kmq.push(["record","enabled clustering"]),await(0,v.Z)({auth:j,url:w}),setTimeout((()=>h(!0)),0),p())},children:"Enable Clustering"}),(0,N.jsx)("br",{}),T&&(0,N.jsx)(k,{error:T})]})};const P=function(e){let{setConfiguring:t,clusterStatus:n,refreshStatus:s}=e;const{compute_stack_id:r}=(0,l.UO)(),f=null===n||void 0===n?void 0:n.cluster_role,v=(null===n||void 0===n?void 0:n.cluster_role)&&(null===n||void 0===n?void 0:n.cluster_user),b=(null===n||void 0===n?void 0:n.cluster_role)&&(null===n||void 0===n?void 0:n.cluster_user),_=(null===n||void 0===n?void 0:n.cluster_role)&&(null===n||void 0===n?void 0:n.cluster_user)&&(null===n||void 0===n?void 0:n.node_name),x=(0,a.Kw)(o.Z,(e=>e.rule_arn)),j=Boolean(x);return(0,N.jsxs)(i.Z,{id:"clustering",children:[(0,N.jsxs)(c.Z,{xl:"3",lg:"4",md:"5",xs:"12",children:[(0,N.jsx)("span",{className:"floating-card-header",children:"enable clustering"}),(0,N.jsx)(u.Z,{className:"my-3",children:(0,N.jsx)(d.Z,{children:(0,N.jsx)(h.SV,{onError:(e,t)=>(0,g.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:p.Z,children:(0,N.jsx)(S,{setConfiguring:t,refreshStatus:s,clusterStatus:n,compute_stack_id:r})})})})]}),(0,N.jsx)(c.Z,{xl:"9",lg:"8",md:"7",xs:"12",children:_?(0,N.jsx)(m.Z,{headline:"You're all set!",description:"Click the button at left to enable clustering. NOTE: We'll restart the instance when you click this button.",icon:(0,N.jsx)("i",{className:"fa fa-thumbs-up text-success"})}):b?(0,N.jsx)(m.Z,{headline:"Set Instance Cluster Name",description:'We need to set a unique node name to identify your instance in the cluster. By default, we set it to "'.concat(r,'", but you can choose your own unique node name.'),icon:(0,N.jsx)("i",{className:"fa fa-exclamation-triangle text-warning"})}):v?(0,N.jsx)(m.Z,{headline:"Cluster Port Set To: 12345",description:"If your instance is behind a firewall, you'll need to ensure this port is accessible by other instances if you want to publish/subscribe to/from this instance.",icon:(0,N.jsx)("i",{className:"fa fa-thumbs-up text-success"})}):f?(0,N.jsx)(m.Z,{headline:"Create a Cluster User",description:"If you have other instances you want to cluster together with this one, make sure the cluster user has the same name and password as those other instances.",warning:j?"HarperDB clustering functionality will not work between AWS cloud instances. We are working on upgrading our cloud infrastructure to support clustering functionality.":null,icon:(0,N.jsx)("i",{className:"fa fa-exclamation-triangle text-warning"})}):(0,N.jsx)(m.Z,{headline:"Create a Cluster Role",description:"This role subscribes to instance transaction logs and handles operations that result from its pub/sub configuration.",icon:(0,N.jsx)("i",{className:"fa fa-exclamation-triangle text-warning"})})})]})};var E=n(6160);const O=function(e){let{handleAddNode:t,loading:n}=e;return(0,N.jsx)(f.Z,{color:"purple",className:"round",title:"Connect To This Instance",disabled:n,onClick:t,children:(0,N.jsx)("i",{className:"fa ".concat(n?"fa-spin fa-spinner":"fa-plus"," text-white")})})};const T=function(e){let{handleRemoveNode:t,showModal:n,loading:s}=e;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(f.Z,{color:"danger",className:"round me-1",title:"Why isn't this instance clustering?",disabled:s,onClick:n,children:(0,N.jsx)("i",{className:"fa fa-exclamation"})}),(0,N.jsx)(f.Z,{color:"purple",className:"round",title:"Disconnect From This Instance",disabled:s,onClick:t,children:(0,N.jsx)("i",{className:"fa ".concat(s?"fa-spin fa-spinner":"fa-minus"," text-white")})})]})};const R=function(e){let{handleRemoveNode:t,loading:n}=e;return(0,N.jsx)(f.Z,{color:"purple",className:"round",title:"Disconnect From This Instance",disabled:n,onClick:t,children:(0,N.jsx)("i",{className:"fa ".concat(n?"fa-spin fa-spinner":"fa-minus"," text-white")})})};const M=function(){return(0,N.jsx)(f.Z,{color:"purple",className:"round",title:"Connecting to this instance",disabled:!0,children:(0,N.jsx)("i",{className:"fa fa-spin fa-spinner text-white"})})};const F=function(e){let{handleConfigureNode:t,loading:n}=e;return(0,N.jsx)(f.Z,{color:"success",className:"round me-1",title:"Enable Clustering",disabled:n,onClick:t,children:(0,N.jsx)("i",{className:"fa ".concat(n?"fa-spin fa-spinner":"fa-share"," text-white")})})};const U=function(e){var t,n,s;let{setShowModal:a,item:r,itemType:l,loading:o,handleAddNode:u,handleRemoveNode:d,handleConfigureNode:h,refreshNetwork:m}=e;const p=r.compute_stack_id===o;return(0,N.jsxs)(i.Z,{className:"item-row",children:[(0,N.jsx)(c.Z,{className:"item-label ".concat("closed"===(null===(t=r.connection)||void 0===t?void 0:t.state)?"text-danger":""),children:r.instance_name}),(0,N.jsx)(c.Z,{className:"item-action",children:"incompatible/unreachable"===l?null:"unconfigured"===l?(0,N.jsx)(F,{loading:p,handleConfigureNode:()=>h({compute_stack_id:r.compute_stack_id})}):"CREATE_IN_PROGRESS"===r.instance_status?(0,N.jsx)(f.Z,{color:"grey",className:"round",title:"Creating Instance",disabled:!0,children:(0,N.jsx)("i",{className:"fa fa-spin fa-spinner"})}):r.connection?"closed"===(null===(n=r.connection)||void 0===n?void 0:n.state)?(0,N.jsx)(T,{loading:p,handleRemoveNode:()=>d({compute_stack_id:r.compute_stack_id}),showModal:()=>a(r.instance_name)}):"connecting"===(null===(s=r.connection)||void 0===s?void 0:s.state)?(0,N.jsx)(M,{refreshNetwork:m}):(0,N.jsx)(R,{loading:p,handleRemoveNode:()=>d({compute_stack_id:r.compute_stack_id,instance_host:r.instance_host,clusterPort:r.clusterPort})}):(0,N.jsx)(O,{loading:p,handleAddNode:()=>u({compute_stack_id:r.compute_stack_id,instance_url:r.instance_url,instance_host:r.instance_host,clusterPort:r.clusterPort})})})]})};var I=n(9358);const L=function(e){let{items:t,itemType:n,setShowModal:r,loading:h,setLoading:m,refreshNetwork:p}=e;const{customer_id:g}=(0,l.UO)(),f=(0,l.s0)(),v=(0,E.VY)(),b=(0,a.Kw)(o.Z,(e=>e.compute_stack_id)),x=(0,a.Kw)(o.Z,(e=>e.auth),[b]),j=(0,a.Kw)(o.Z,(e=>e.url),[b]),w=(0,a.Kw)(o.Z,(e=>e.is_local),[b]),k=(0,a.Kw)(o.Z,(e=>{var t;return parseFloat(null===(t=e.auth)||void 0===t?void 0:t.version)>=4?"nats":"socketcluster"}),[b]),y=(0,s.useCallback)((async e=>{m(e.compute_stack_id);const t="nats"===k?await(async e=>{let{auth:t,url:n,server:s="hub",routes:a}=e;return(0,_.Z)({operation:{operation:"cluster_set_routes",server:s,routes:a},auth:t,url:n})})({auth:x,url:j,routes:[{host:e.instance_host,port:e.clusterPort}]}):await(async e=>{let{compute_stack_id:t,instance_host:n,clusterPort:s,auth:a,url:r}=e;return(0,_.Z)({operation:{operation:"add_node",name:t,node_name:t,host:n,port:s,subscriptions:[]},auth:a,url:r})})({...e,auth:x,url:j,is_local:w,customer_id:g});t.error?(v.error("localhost"===e.instance_host?"External instances cannot reach that instance's URL":t.message),m(!1)):("nats"===k&&await(0,I.Z)({auth:x,url:j,service:"clustering config"}),await p()),m(!1)}),[m,x,j,w,g,p,v,k]),Z=(0,s.useCallback)((async e=>{m(e.compute_stack_id);const t="nats"===k?await(async e=>{let{auth:t,url:n,routes:s}=e;return(0,_.Z)({operation:{operation:"cluster_delete_routes",routes:s},auth:t,url:n})})({auth:x,url:j,routes:[{host:e.instance_host,port:e.clusterPort}]}):await(async e=>{let{compute_stack_id:t,auth:n,url:s}=e;return(0,_.Z)({operation:{operation:"remove_node",name:t,node_name:t},auth:n,url:s})})({...e,auth:x,url:j,is_local:w,customer_id:g});t.error?(v.error(t.message),m(!1)):("nats"===k&&await(0,I.Z)({auth:x,url:j,service:"clustering config"}),await p()),m(!1)}),[m,x,j,w,g,p,v,k]),C=(0,s.useCallback)((e=>f("/o/".concat(g,"/i/").concat(e.compute_stack_id,"/cluster"))),[f,g]);return(0,N.jsxs)("div",{className:"entity-manager",children:[(0,N.jsxs)("div",{className:"floating-card-header",children:[n," instances"]}),(0,N.jsx)(u.Z,{className:"my-3",children:(0,N.jsx)(d.Z,{children:null!==t&&void 0!==t&&t.length?t.map((e=>(0,N.jsx)(U,{item:e,itemType:n,setShowModal:r,handleAddNode:y,handleRemoveNode:Z,handleConfigureNode:C,loading:h,refreshNetwork:p},e.instance_name))):t?(0,N.jsx)(i.Z,{className:"item-row",children:(0,N.jsxs)(c.Z,{className:"item-label",children:["There are no ",n," instances"]})}):(0,N.jsx)(i.Z,{className:"item-row",children:(0,N.jsx)(c.Z,{className:"item-label",children:(0,N.jsx)("i",{className:"fa fa-spinner fa-spin"})})})})})]})};var z=n(6855);const A={filtered:[],sorted:[],page:0,totalPages:1,pageSize:20,autoRefresh:!1,showFilter:!1,lastUpdate:!1};const D=function(e){let{refreshNetwork:t,loading:n,setLoading:r}=e;const l=(0,a.Kw)(o.Z,(e=>e.clusterDataTable||[])),h=(0,a.Kw)(o.Z,(e=>e.clusterDataTableColumns||[])),[m,p]=(0,s.useState)(A);(0,s.useEffect)((()=>{p({...m,totalPages:Math.ceil((l.length||m.pageSize)/m.pageSize)})}),[p,m.pageSize]);const g=(0,s.useCallback)((async()=>{r(!0),t()}),[r,t]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(i.Z,{className:"floating-card-header",children:[(0,N.jsx)(c.Z,{children:"manage clustering"}),(0,N.jsx)(c.Z,{className:"text-end",children:(0,N.jsxs)(f.Z,{color:"link",onClick:g,className:"me-2",children:[(0,N.jsx)("span",{className:"me-2",children:"refresh network"}),(0,N.jsx)("i",{title:"Refresh Roles",className:"fa ".concat(n?"fa-spinner fa-spin":"fa-sync-alt")})]})})]}),(0,N.jsx)(u.Z,{className:"my-3",children:(0,N.jsx)(d.Z,{className:"react-table-holder ".concat(n?"loading":""),children:null!==l&&void 0!==l&&l.length?(0,N.jsx)(z.Z,{columns:h,data:l,page:m.page,pageSize:m.pageSize,totalPages:m.totalPages,showFilter:m.showFilter,sorted:m.sorted,onFilteredChange:e=>p({...m,filtered:e}),onSortedChange:e=>p({...m,sorted:e}),onPageChange:e=>p({...m,pageSize:e}),onPageSizeChange:e=>p({...m,page:0,pageSize:e})}):(0,N.jsx)("div",{className:"empty-prompt",children:"Please connect at least one instance to configure clustering"})})})]})};var K=n(1446),G=n(2020),B=n(8642);const X=function(e){let{showModal:t,setShowModal:n}=e;const{compute_stack_id:s}=(0,l.UO)(),r=(0,a.Kw)(o.Z,(e=>e.instance_name),[s]);return(0,N.jsxs)(K.Z,{id:"cluster-state-modal",isOpen:!!t,toggle:()=>n(!1),centered:!0,fade:!1,children:[(0,N.jsx)(G.Z,{toggle:()=>n(!1),children:"Instance Cluster Error"}),(0,N.jsx)(B.Z,{children:(0,N.jsx)(u.Z,{children:(0,N.jsxs)(d.Z,{children:[(0,N.jsx)("b",{children:r})," is unable to open a connection to ",(0,N.jsx)("b",{children:t}),".",(0,N.jsx)("hr",{className:"my-3"}),(0,N.jsxs)("ul",{children:[(0,N.jsx)("li",{children:"Clustered instances must be able to reach each other. This may require allowing access through a firewall."}),(0,N.jsx)("li",{children:"Both instances must be running. In the event of a restart, instances will automatically attempt to reconnect."}),(0,N.jsxs)("li",{children:["Clustered instances must have the same cluster user ",(0,N.jsx)("b",{children:"name"})," and ",(0,N.jsx)("b",{children:"password"}),". You can edit an instance's cluster user credentials in the ",(0,N.jsx)("b",{children:"config"})," ","section."]})]}),(0,N.jsx)("hr",{className:"my-3"}),"If none of these help fix the issue, you can disconnect ",(0,N.jsx)("b",{children:t})," from ",(0,N.jsx)("b",{children:r})," by clicking the purple disconnect button with the minus sign."]})})})]})};var H=n(3406),q=n.n(H);var V=n(2274);const Y=async e=>{let{channel:t,subscriptions:n,buttonState:s,instance_host:a,clusterPort:r,clusterName:l,auth:i,url:c}=e;const u=JSON.parse(JSON.stringify(n)),d=u.findIndex((e=>e.channel===t)),[h,m]=t.split(":");-1===d?u.push({channel:t,schema:h,table:m,publish:"togglePublish"===s,subscribe:"toggleSubscribe"===s}):"togglePublish"===s?u[d].publish=!u[d].publish:"toggleSubscribe"===s&&(u[d].subscribe=!u[d].subscribe),u[d]&&!u[d].publish&&u[d].subscribe;const p={operation:"update_node",name:l,node_name:l,host:a,port:r,subscriptions:u},g=await(0,_.Z)({operation:p,auth:i,url:c});return g.error&&-1!==g.message.indexOf("add_node")&&(p.operation="add_node",await(0,_.Z)({operation:p,auth:i,url:c})),o.Z.update((e=>{e.lastUpdate=Date.now()}))};var W=n(1343),$=n(3708),J=n(4095);const Q=async e=>{let{instance:t,auth:n}=e;const s=n&&await(0,J.Z)({auth:n,url:t.url}),a=n&&await(0,W.Z)({auth:n,url:t.url}),{structure:r}=a?(0,$.Z)(a):{structure:{}},l=new URL(t.url),o={...t,auth:n,structure:r,host:l.hostname,clustering:s};return Object.entries(o).reduce(((e,t)=>{let[n,s]=t;return null==s||(e[n]=s),e}),{})},ee=async e=>{let{auth:t,url:n,instances:s,connections:a}=e;const r=await(async e=>{let{auth:t,url:n}=e;return(0,_.Z)({operation:{operation:"cluster_get_routes"},auth:t,url:n})})({auth:t,url:n});return r.hub.map((e=>{var t;const n=s.find((t=>t.host===e.host||t.private_ip===e.host));if(!n)return!1;const r=n.host===n.private_ip?n.private_ip:n.host,l=a.find((e=>{var t;return e.node_name===(null===n||void 0===n||null===(t=n.clustering)||void 0===t?void 0:t.node_name)})),o=(null===l||void 0===l||null===(t=l.subscriptions)||void 0===t?void 0:t.map((e=>({channel:"".concat(e.schema,":").concat(e.table),...e}))))||[];return{host:r,port:e.port,state:"open",name:null===n||void 0===n?void 0:n.compute_stack_id,subscriptions:o}})).filter((e=>!1!==e))},te=e=>{let{connections:t}=e;return t?t.filter((e=>-1===e.host_address.indexOf("::ffff"))).map((e=>({name:e.node_name,host:e.host_address,port:e.host_port,state:e.state,subscriptions:e.subscriptions}))):[]},ne=async e=>{let{auth:t,url:n,instances:s,compute_stack_id:a,instanceAuths:r,setLoading:l}=e;const i=await Promise.all(s.filter((e=>!!r[e.compute_stack_id])).map((e=>Q({instance:e,auth:r[e.compute_stack_id]})))),c=i.find((e=>e.compute_stack_id===a)),u=c.clustering.message||!c.clustering.is_enabled?[]:"nats"===c.clustering.engine?await ee({auth:t,url:n,instances:i,connections:c.clustering.connections}):te({connections:c.clustering.status.outbound_connections}),d={is_enabled:c.clustering.is_enabled,connections:u},h=(e=>{let{instances:t,network:n,instance_region:s,instance_wavelength_zone_id:a,instance_cluster_engine:r}=e;const l=t.filter((e=>e.url&&"DELETE_IN_PROGRESS"!==e.status)).filter((e=>e.clustering.engine===r)).map((e=>{var t,l;const o="socketcluster"===r?null===n||void 0===n?void 0:n.connections.find((t=>t.name===e.compute_stack_id)):null===n||void 0===n?void 0:n.connections.find((t=>t.host===e.host)),i=(null===o||void 0===o?void 0:o.subscriptions)||[],c=null===e||void 0===e||null===(t=e.clustering)||void 0===t?void 0:t.config_cluster_port,u=e.is_local?"OK":e.status,d=!s||s!==e.instance_region||e.wavelength_zone_id||a?e.url.match(/^https?:\/\/([^/:?#]+)(?:[/:?#]|$)/i)[1]:e.private_ip,h=e.clustering.node_name;return{instance_name:e.instance_name,instance_url:e.url,compute_stack_id:e.compute_stack_id,instance_status:u,instance_host:d,clusterPort:c,clusterName:h,connection:o,subscriptions:i,structure:e.structure,configured:null===(l=e.clustering)||void 0===l?void 0:l.is_ready}})),o=t.filter((e=>e.clustering.engine!==r)).map((e=>({instance_name:e.instance_name,compute_stack_id:e.name})));return{connected:l.filter((e=>e.connection&&e.configured)),unconnected:l.filter((e=>!e.connection&&e.configured)),unconfigured:l.filter((e=>!e.configured)),unreachable:o}})({instances:i.filter((e=>r[e.compute_stack_id]&&e.compute_stack_id!==a)),network:d,instance_region:c.instance_region,instance_wavelength_zone_id:c.wavelength_zone_id,instance_cluster_engine:c.clustering.engine}),m=(e=>{let{instances:t,structure:n}=e;if(!n||!t.length)return[];const s=[];return t.map((e=>{const t=q()(e.structure,n);return Object.keys(t).sort().map(((n,a)=>(Object.keys(t[n]).sort().map(((t,r)=>{const l="".concat(n,":").concat(t),o=l&&e.subscriptions.find((e=>e.channel===l)),i=o&&o.publish,c=o&&o.subscribe;return s.push({is_first_instance:0===a&&0===r,is_first_schema:0===r,instance_name:e.instance_name,schema:n,table:t,compute_stack_id:e.compute_stack_id,instance_host:e.instance_host,clusterPort:e.clusterPort,clusterName:e.clusterName,subscriptions:e.subscriptions,channel:l,publish:i,subscribe:c}),!0})),!0))),!0})),s})({instances:h.connected.filter((e=>"closed"!==e.connection.state)),structure:c.structure}),p=(e=>{let{auth:t,url:n,buildNetwork:s,setLoading:a}=e;return[{Header:"instance",Cell:e=>{let{row:{original:{is_first_instance:t,instance_name:n}}}=e;return(0,N.jsx)("div",{className:"".concat(t?"text-bold":"text-grey"),children:n})}},{Header:"schema",Cell:e=>{let{row:{original:{is_first_schema:t,schema:n}}}=e;return(0,N.jsx)("div",{className:"".concat(t?"text-bold":"text-grey"),children:n})}},{Header:"table",accessor:"table"},{Header:"publish",id:"hdb-narrow-publish",Cell:e=>{let{row:{original:{compute_stack_id:r,instance_host:l,instance_name:o,clusterPort:i,clusterName:c,subscriptions:u,publish:d,channel:h}}}=e;return(0,N.jsx)(V.Z,{checked:d||!1,onChange:async()=>{a(r),await Y({channel:h,subscriptions:u,instance_host:l,instance_name:o,clusterPort:i,clusterName:c,auth:t,url:n,buttonState:"togglePublish"}),s()}})}},{Header:"subscribe",id:"hdb-narrow-subscribe",Cell:e=>{let{row:{original:{compute_stack_id:r,instance_host:l,instance_name:o,clusterPort:i,clusterName:c,subscriptions:u,subscribe:d,channel:h}}}=e;return(0,N.jsx)(V.Z,{checked:d||!1,onChange:async()=>{a(r),await Y({channel:h,subscriptions:u,instance_host:l,instance_name:o,clusterPort:i,clusterName:c,auth:t,url:n,buttonState:"toggleSubscribe"}),s()}})}}]})({auth:t,url:c.url,compute_stack_id:a,buildNetwork:()=>ne({auth:t,url:n,instances:s,compute_stack_id:a,instanceAuths:r,setLoading:l}),setLoading:l});return o.Z.update((e=>{e.network=d,e.clusterPartners=h,e.clusterDataTable=m,e.clusterDataTableColumns=p,e.instances=i})),l(!1),{network:d,clusterPartners:h,clusterDataTable:m,clusterDataTableColumns:p}},se=ne;var ae=n(6449),re=n(2190);const le=function(e){let{configuring:t}=e;const{compute_stack_id:n}=(0,l.UO)(),u=(0,a.Kw)(ae.Z,(e=>e.instances)),[d]=(0,re.Z)({}),m=(0,a.Kw)(o.Z,(e=>e.auth),[n]),f=(0,a.Kw)(o.Z,(e=>e.url),[n]),v=(0,a.Kw)(o.Z,(e=>e.clusterPartners),[n]),b=(0,a.Kw)(o.Z,(e=>e.restarting),[n]),_="socketcluster"===(0,a.Kw)(o.Z,(e=>{var t;return parseFloat(null===(t=e.registration)||void 0===t?void 0:t.version)>=4?"nats":"socketcluster"}),[n])&&(null===v||void 0===v?void 0:v.connected.some((e=>"connecting"===e.connection.state))),[x,j]=(0,s.useState)(!1),[w,k]=(0,s.useState)(!1),y=(0,s.useCallback)((async()=>{m&&f&&u&&n&&!b&&!t&&await se({auth:m,url:f,instances:u,compute_stack_id:n,instanceAuths:d,setLoading:k})}),[m,f,u,n,b,d,t]);return(0,s.useEffect)((()=>{y()}),[y]),(0,r.Z)((()=>_&&y()),1500),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(i.Z,{id:"clustering",children:[(0,N.jsx)(c.Z,{xl:"3",lg:"4",md:"6",xs:"12",children:(0,N.jsxs)(h.SV,{onError:(e,t)=>(0,g.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:p.Z,children:[(0,N.jsx)(L,{items:null===v||void 0===v?void 0:v.connected,itemType:"connected",loading:w,refreshNetwork:y,setLoading:k,setShowModal:j}),(0,N.jsx)(L,{items:null===v||void 0===v?void 0:v.unconnected,itemType:"unconnected",loading:w,refreshNetwork:y,setLoading:k}),(0,N.jsx)(L,{items:null===v||void 0===v?void 0:v.unconfigured,itemType:"unconfigured",loading:w}),(0,N.jsx)(L,{items:null===v||void 0===v?void 0:v.unreachable,itemType:"incompatible/unreachable",loading:w})]})}),(0,N.jsx)(c.Z,{xl:"9",lg:"8",md:"6",xs:"12",children:(0,N.jsx)(D,{refreshNetwork:y,loading:w,setLoading:k})})]}),(0,N.jsx)(X,{showModal:x,setShowModal:j})]})};var oe=n(7377);const ie=function(){const{compute_stack_id:e}=(0,l.UO)(),t=(0,a.Kw)(o.Z,(e=>e.auth),[e]),n=(0,a.Kw)(o.Z,(e=>e.url),[e]),[i,c]=(0,s.useState)(!1),[u,d]=(0,s.useState)(!1),h=(0,s.useCallback)((async()=>{if(t&&n){const e=await(0,J.Z)({auth:t,url:n});c(e),e.is_ready&&d(!1)}}),[t,n]);return(0,r.Z)((async()=>{u&&h()}),3e3),(0,s.useEffect)((()=>{h()}),[h]),(0,s.useEffect)((()=>{c(!1)}),[e]),i?u?(0,N.jsx)(m.Z,{description:"Configuring Clustering",icon:(0,N.jsx)("i",{className:"fa fa-spinner fa-spin"})}):i.is_ready?(0,N.jsx)(le,{configuring:u}):(0,N.jsx)(P,{setConfiguring:d,clusterStatus:i,refreshStatus:h}):(0,N.jsx)(oe.Z,{header:"loading network",spinner:!0})}},6855:(e,t,n)=>{n.d(t,{Z:()=>x});var s=n(7313),a=n(5110),r=n(1781),l=n(9842),o=n(6782),i=n(5399),c=n(6417);const u=e=>{let{headerGroups:t,onSortedChange:n,sorted:s,showFilter:a}=e;return t.map((e=>(0,c.jsxs)("div",{...e.getHeaderGroupProps(),children:[(0,c.jsx)(o.Z,{className:"header g-0",children:e.headers.map((e=>{var t,a;return(0,c.jsx)(i.Z,{onClick:()=>{var t,a;return n([{id:e.id,desc:(null===(t=s[0])||void 0===t?void 0:t.id)===e.id&&!(null!==(a=s[0])&&void 0!==a&&a.desc)}])},className:"".concat((null===(t=s[0])||void 0===t?void 0:t.id)===e.id?"sorted":""," ").concat(null!==(a=s[0])&&void 0!==a&&a.desc?"desc":"asc"," ").concat(-1!==e.id.indexOf("hdb-narrow")?"action":""," px-1"),children:(0,c.jsx)("div",{className:"text-renderer",children:e.render("Header")})},e.id)}))}),a&&(0,c.jsx)(o.Z,{className:"filter g-0",children:e.headers.map((e=>(0,c.jsx)(i.Z,{className:-1!==e.id.indexOf("hdb-narrow")?"action":"",children:e.render("Filter")},e.id)))})]})))};var d=n(9327);const h=function(e){let{page:t,pageSize:n,totalPages:s,onPageChange:a,onPageSizeChange:l,loading:u}=e;return(0,c.jsxs)(o.Z,{className:"pagination",children:[(0,c.jsx)(i.Z,{xs:"12",sm:"2",className:"previous",children:(0,c.jsx)(d.Z,{className:"mb-2 btn-pagination",color:"purple",block:!0,onClick:()=>a(t-1),disabled:!s||0===t,children:(0,c.jsx)("i",{className:"fa fa-chevron-left"})})}),(0,c.jsxs)(i.Z,{xs:"12",sm:"4",className:"paginator",children:[(0,c.jsx)("i",{className:"fa fa-book me-2"}),(0,c.jsx)(r.Z,{className:"mb-2",type:"number",value:t+1,min:1,max:s,onChange:e=>a(e.target.value-1)}),(0,c.jsxs)("div",{className:"page-count",children:["\xa0/\xa0",u?(0,c.jsx)("i",{className:"fa fa-spinner fa-spin"}):s]})]}),(0,c.jsx)(i.Z,{xs:"12",sm:"4",className:"page-size",children:(0,c.jsx)(r.Z,{className:"mb-2",type:"select",value:n,onChange:e=>l(e.target.value),children:[20,50,100,250].map((e=>(0,c.jsxs)("option",{value:e,children:[e," rows"]},e)))})}),(0,c.jsx)(i.Z,{xs:"12",sm:"2",className:"next",children:(0,c.jsx)(d.Z,{className:"mb-2 pull-right btn-pagination",block:!0,color:"purple",onClick:()=>a(t+1),disabled:!s||t+1===s,children:(0,c.jsx)("i",{className:"fa fa-chevron-right"})})})]})};const m=function(e){let{previousPage:t,canPreviousPage:n,pageIndex:s,gotoPage:a,setPageSize:l,pageCount:u,nextPage:h,canNextPage:m,loading:p}=e;return(0,c.jsxs)(o.Z,{className:"pagination",children:[(0,c.jsx)(i.Z,{xs:"12",sm:"2",className:"previous",children:(0,c.jsx)(d.Z,{className:"mb-2 btn-pagination",color:"purple",block:!0,onClick:t,disabled:!u||!n,children:(0,c.jsx)("i",{className:"fa fa-chevron-left"})})}),(0,c.jsxs)(i.Z,{xs:"12",sm:"4",className:"paginator",children:[(0,c.jsx)("i",{className:"fa fa-book me-2"}),(0,c.jsx)(r.Z,{className:"mb-2",type:"number",value:s+1||1,min:1,max:u,onChange:e=>a(e.target.value?Number(e.target.value)-1:0)}),(0,c.jsxs)("div",{className:"page-count",children:["\xa0/\xa0",p?(0,c.jsx)("i",{className:"fa fa-spinner fa-spin"}):u]})]}),(0,c.jsx)(i.Z,{xs:"12",sm:"4",className:"page-size",children:(0,c.jsx)(r.Z,{className:"mb-2",type:"select",onChange:e=>{a(0),setTimeout((()=>l(e.target.value)),1e3)},children:[20,50,100,250].map((e=>(0,c.jsxs)("option",{value:e,children:[e," rows"]},e)))})}),(0,c.jsx)(i.Z,{xs:"12",sm:"2",className:"next",children:(0,c.jsx)(d.Z,{className:"mb-2 pull-right btn-pagination",block:!0,color:"purple",onClick:h,disabled:!u||!m,children:(0,c.jsx)("i",{className:"fa fa-chevron-right"})})})]})};const p=function(e){let{prepareRow:t,row:n,onRowClick:s=!1}=e;return t(n),(0,c.jsx)(o.Z,{onClick:()=>s&&s(n.original),className:"g-0",children:n.cells.map((e=>(0,c.jsx)(i.Z,{className:-1!==e.column.id.indexOf("hdb-narrow")?"action":"",children:e.render("Cell")},"".concat(e.row.id,"-").concat(e.column.id))))})};var g=n(2261),f=n(4220);function v(e){let{value:t}=e;return(0,c.jsx)("div",{className:"text-renderer",children:t})}function b(e){let{src:t}=e;const[n,a]=(0,s.useState)(!1),[r,l]=(0,s.useState)(!1);return(0,c.jsxs)("div",{className:"image-renderer",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[(0,c.jsx)("i",{className:"fa fa-image"}),n&&r?(0,c.jsxs)("div",{className:"preview-image no-image",children:[(0,c.jsx)("i",{className:"fa fa-ban text-danger"}),(0,c.jsx)("div",{className:"mt-2",children:"image failed to load"})]}):n?(0,c.jsx)("img",{onError:l,alt:t,src:t,className:"preview-image"}):null]})}const _={Filter:e=>{let{column:{filterValue:t,setFilter:n}}=e;return(0,c.jsx)(r.Z,{type:"text",value:t||"",onChange:e=>n(e.target.value||void 0)})},Cell:e=>{let{value:t}=e;return(e=>{switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Object]":return(0,c.jsx)(v,{value:JSON.stringify(e)});case"[object Boolean]":return(0,c.jsx)(v,{value:e?"true":"false"});case"[object String]":return(t=e)&&(t.match(/^https?.*\.(jpeg|jpg|gif|png)$/)||-1!==t.indexOf("data:image"))?(0,c.jsx)(b,{src:e}):(0,c.jsx)(v,{value:e});default:return(0,c.jsx)(v,{value:e})}var t})(t)}};const x=function(e){let{columns:t,data:n,currentPage:r,pageSize:o,totalPages:i,onFilteredChange:d,onSortedChange:v,onPageChange:b,onPageSizeChange:x,showFilter:j,onRowClick:w,sorted:N,loading:k,manual:y=!1}=e;const{headerGroups:Z,page:C,rows:S,prepareRow:P,state:E,setAllFilters:O,canPreviousPage:T,canNextPage:R,pageOptions:M,pageCount:F,gotoPage:U,nextPage:I,previousPage:L,setPageSize:z}=(0,a.useTable)({columns:t,data:n,defaultColumn:_,onFilteredChange:d,onSortedChange:v,onPageChange:b,onPageSizeChange:x,onRowClick:w,manualPagination:y,manualFilters:y,initialState:{pageIndex:r,pageSize:o}},a.useFilters,a.usePagination),[A,D]=(0,s.useState)(!0),K=y||!C.length?S:C;return(0,s.useEffect)((()=>{!j&&E.filters.length?O([]):d(E.filters)}),[E.filters,j]),(0,s.useEffect)((()=>{setTimeout((()=>D(!1)),100)}),[null===K||void 0===K?void 0:K.length]),(0,c.jsxs)(l.SV,{onError:(e,t)=>(0,g.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:f.Z,children:[(0,c.jsxs)("div",{className:"react-table-scroller",children:[(0,c.jsx)(u,{headerGroups:Z,onSortedChange:v,sorted:N,showFilter:j}),k||A?(0,c.jsx)("div",{className:"centered text-center",children:(0,c.jsx)("i",{className:"fa fa-spinner fa-spin"})}):K.length?K.map((e=>(0,c.jsx)(p,{row:e,prepareRow:P,onRowClick:w},e.id))):(0,c.jsxs)("div",{className:"centered text-center",children:[(0,c.jsx)("i",{className:"fa fa-exclamation-triangle text-danger"}),(0,c.jsx)("div",{className:"mt-2 text-darkgrey",children:"no records"})]})]}),y?(0,c.jsx)(h,{page:r,pageSize:o,totalPages:i,onPageChange:b,onPageSizeChange:x,loading:k}):(0,c.jsx)(m,{previousPage:L,pageSize:o,canPreviousPage:T,pageIndex:E.pageIndex,pageOptions:M,gotoPage:U,setPageSize:z,pageCount:F,nextPage:I,canNextPage:R,loading:k})]})}},4851:(e,t,n)=>{n.d(t,{Z:()=>a});var s=n(9859);const a=async e=>{let{auth:t,url:n,role:a,permission:r}=e;return(0,s.Z)({operation:{operation:"add_role",role:a,permission:r},auth:t,url:n})}},9481:(e,t,n)=>{n.d(t,{Z:()=>a});var s=n(9859);const a=async e=>{let{auth:t,role:n,username:a,password:r,url:l}=e;return(0,s.Z)({operation:{operation:"add_user",role:n,username:a,password:r,active:!0},auth:t,url:l})}},7093:(e,t,n)=>{n.d(t,{Z:()=>a});var s=n(9859);const a=async e=>{let{auth:t,url:n}=e;return(0,s.Z)({operation:{operation:"get_configuration"},auth:t,url:n})}},5200:(e,t,n)=>{n.d(t,{Z:()=>r});var s=n(9859),a=n(5447);const r=async e=>{let{auth:t,url:n}=e;const r=await(0,s.Z)({operation:{operation:"list_roles"},auth:t,url:n}),l=[...Array.isArray(r)?r:[]].sort(((e,t)=>e.role.toLowerCase()>t.role.toLowerCase()?1:-1));return a.Z.update((e=>{e.roles=l})),l}},2066:(e,t,n)=>{n.d(t,{Z:()=>r});var s=n(9859),a=n(5447);const r=async e=>{let{auth:t,url:n,signal:r}=e;const l=await(0,s.Z)({operation:{operation:"list_users"},auth:t,url:n,signal:r}),o=Array.isArray(l)?[...l].map((e=>({username:e.username,role:e.role.role}))).sort(((e,t)=>e.username.toLowerCase()>t.username.toLowerCase()?1:-1)):[];return a.Z.update((e=>{e.users=o})),o}},8147:(e,t,n)=>{n.d(t,{Z:()=>r});var s=n(9859),a=n(5447);const r=async e=>{let{auth:t,url:n}=e;return a.Z.update((e=>{e.restarting=!0})),(0,s.Z)({operation:{operation:"restart"},auth:t,url:n})}},9358:(e,t,n)=>{n.d(t,{Z:()=>r});var s=n(9859),a=n(5447);const r=async e=>{let{auth:t,url:n,service:r=null}=e;return r?(a.Z.update((e=>{e.restarting_service=r})),(0,s.Z)({operation:{operation:"restart_service",service:r},auth:t,url:n})):{error:!0,message:"You must specify a service"}}},4431:(e,t,n)=>{n.d(t,{Z:()=>a});var s=n(9859);const a=async e=>{let{auth:t,url:n,...a}=e;return(0,s.Z)({operation:{operation:"set_configuration",...a},auth:t,url:n})}},4095:(e,t,n)=>{n.d(t,{Z:()=>i});var s=n(7093),a=n(5200),r=n(2066),l=n(5491),o=n(9859);const i=async e=>{let{auth:t,url:n}=e;const i=await(0,s.Z)({auth:t,url:n}),c=await(0,l.Z)({auth:t,url:n}),u=await(async e=>{let{auth:t,url:n}=e;return(0,o.Z)({operation:{operation:"cluster_status"},auth:t,url:n})})({auth:t,url:n}),d=parseFloat(null===c||void 0===c?void 0:c.version)>=4?"nats":"socketcluster",h=await(0,a.Z)({auth:t,url:n});let m=!1;h.error||(m=h.find((e=>e.permission.cluster_user)));const p=await(0,r.Z)({auth:t,url:n});let g=!1;p.error||(g=m&&p.find((e=>e.role===m.role)));const f="nats"===d?i.clustering.enabled:i.CLUSTERING,v="nats"===d?i.clustering.user:i.CLUSTERING_USER,b="nats"===d?i.clustering.hubServer.cluster.network.port:i.CLUSTERING_PORT,_="nats"===d?i.clustering.nodeName:i.NODE_NAME;return{is_ready:!!f&&!!g&&!!v&&!!m&&!!b&&!!_,cluster_role:m,cluster_user:g,is_enabled:f,config_cluster_user:v,config_cluster_port:b,node_name:_,engine:d,status:null===u||void 0===u?void 0:u.status,message:null===u||void 0===u?void 0:u.message,connections:null===u||void 0===u?void 0:u.connections}}},3406:e=>{var t=function(e){return function(e){return!!e&&"object"===typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)};var n="function"===typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function s(e,t){return!1!==t.clone&&t.isMergeableObject(e)?i((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function a(e,t,n){return e.concat(t).map((function(e){return s(e,n)}))}function r(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function l(e,t){try{return t in e}catch(n){return!1}}function o(e,t,n){var a={};return n.isMergeableObject(e)&&r(e).forEach((function(t){a[t]=s(e[t],n)})),r(t).forEach((function(r){(function(e,t){return l(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,r)||(l(e,r)&&n.isMergeableObject(t[r])?a[r]=function(e,t){if(!t.customMerge)return i;var n=t.customMerge(e);return"function"===typeof n?n:i}(r,n)(e[r],t[r],n):a[r]=s(t[r],n))})),a}function i(e,n,r){(r=r||{}).arrayMerge=r.arrayMerge||a,r.isMergeableObject=r.isMergeableObject||t,r.cloneUnlessOtherwiseSpecified=s;var l=Array.isArray(n);return l===Array.isArray(e)?l?r.arrayMerge(e,n,r):o(e,n,r):s(n,r)}i.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return i(e,n,t)}),{})};var c=i;e.exports=c},6194:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var s,a=n(7313),r=(s=a)&&s.__esModule?s:{default:s};t.default=function(){return r.default.createElement("svg",{width:"14",height:"11",viewBox:"0 0 14 11"},r.default.createElement("path",{d:"M11.264 0L5.26 6.004 2.103 2.847 0 4.95l5.26 5.26 8.108-8.107L11.264 0",fill:"#fff",fillRule:"evenodd"}))}},2274:(e,t,n)=>{var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),r=n(7313),l=h(r),o=h(n(6123)),i=h(n(5192)),c=h(n(6194)),u=h(n(2808)),d=n(8354);function h(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleClick=n.handleClick.bind(n),n.handleTouchStart=n.handleTouchStart.bind(n),n.handleTouchMove=n.handleTouchMove.bind(n),n.handleTouchEnd=n.handleTouchEnd.bind(n),n.handleFocus=n.handleFocus.bind(n),n.handleBlur=n.handleBlur.bind(n),n.previouslyChecked=!(!e.checked&&!e.defaultChecked),n.state={checked:!(!e.checked&&!e.defaultChecked),hasFocus:!1},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),a(t,[{key:"componentDidUpdate",value:function(e){e.checked!==this.props.checked&&this.setState({checked:!!this.props.checked})}},{key:"handleClick",value:function(e){if(!this.props.disabled){var t=this.input;if(e.target!==t&&!this.moved)return this.previouslyChecked=t.checked,e.preventDefault(),t.focus(),void t.click();var n=this.props.hasOwnProperty("checked")?this.props.checked:t.checked;this.setState({checked:n})}}},{key:"handleTouchStart",value:function(e){this.props.disabled||(this.startX=(0,d.pointerCoord)(e).x,this.activated=!0)}},{key:"handleTouchMove",value:function(e){if(this.activated&&(this.moved=!0,this.startX)){var t=(0,d.pointerCoord)(e).x;this.state.checked&&t+15<this.startX?(this.setState({checked:!1}),this.startX=t,this.activated=!0):t-15>this.startX&&(this.setState({checked:!0}),this.startX=t,this.activated=t<this.startX+5)}}},{key:"handleTouchEnd",value:function(e){if(this.moved){var t=this.input;if(e.preventDefault(),this.startX){var n=(0,d.pointerCoord)(e).x;!0===this.previouslyChecked&&this.startX+4>n?this.previouslyChecked!==this.state.checked&&(this.setState({checked:!1}),this.previouslyChecked=this.state.checked,t.click()):this.startX-4<n&&this.previouslyChecked!==this.state.checked&&(this.setState({checked:!0}),this.previouslyChecked=this.state.checked,t.click()),this.activated=!1,this.startX=null,this.moved=!1}}}},{key:"handleFocus",value:function(e){var t=this.props.onFocus;t&&t(e),this.setState({hasFocus:!0})}},{key:"handleBlur",value:function(e){var t=this.props.onBlur;t&&t(e),this.setState({hasFocus:!1})}},{key:"getIcon",value:function(e){var n=this.props.icons;return n?void 0===n[e]?t.defaultProps.icons[e]:n[e]:null}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=(t.icons,function(e,t){var n={};for(var s in e)t.indexOf(s)>=0||Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s]);return n}(t,["className","icons"])),r=(0,o.default)("react-toggle",{"react-toggle--checked":this.state.checked,"react-toggle--focus":this.state.hasFocus,"react-toggle--disabled":this.props.disabled},n);return l.default.createElement("div",{className:r,onClick:this.handleClick,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd},l.default.createElement("div",{className:"react-toggle-track"},l.default.createElement("div",{className:"react-toggle-track-check"},this.getIcon("checked")),l.default.createElement("div",{className:"react-toggle-track-x"},this.getIcon("unchecked"))),l.default.createElement("div",{className:"react-toggle-thumb"}),l.default.createElement("input",s({},a,{ref:function(t){e.input=t},onFocus:this.handleFocus,onBlur:this.handleBlur,className:"react-toggle-screenreader-only",type:"checkbox"})))}}]),t}(r.PureComponent);t.Z=m,m.displayName="Toggle",m.defaultProps={icons:{checked:l.default.createElement(c.default,null),unchecked:l.default.createElement(u.default,null)}},m.propTypes={checked:i.default.bool,disabled:i.default.bool,defaultChecked:i.default.bool,onChange:i.default.func,onFocus:i.default.func,onBlur:i.default.func,className:i.default.string,name:i.default.string,value:i.default.string,id:i.default.string,"aria-labelledby":i.default.string,"aria-label":i.default.string,icons:i.default.oneOfType([i.default.bool,i.default.shape({checked:i.default.node,unchecked:i.default.node})])}},8354:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pointerCoord=function(e){if(e){var t=e.changedTouches;if(t&&t.length>0){var n=t[0];return{x:n.clientX,y:n.clientY}}var s=e.pageX;if(void 0!==s)return{x:s,y:e.pageY}}return{x:0,y:0}}},2808:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var s,a=n(7313),r=(s=a)&&s.__esModule?s:{default:s};t.default=function(){return r.default.createElement("svg",{width:"10",height:"10",viewBox:"0 0 10 10"},r.default.createElement("path",{d:"M9.9 2.12L7.78 0 4.95 2.828 2.12 0 0 2.12l2.83 2.83L0 7.776 2.123 9.9 4.95 7.07 7.78 9.9 9.9 7.776 7.072 4.95 9.9 2.12",fill:"#fff",fillRule:"evenodd"}))}}}]);