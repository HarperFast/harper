"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[8463],{1608:(e,t,s)=>{s.r(t),s.d(t,{default:()=>le,metadata:()=>ie});var a=s(7313),n=s(7387),r=s(4122),o=s(8467),i=s(5447),l=s(6782),c=s(5399),u=s(238),d=s(3516),h=s(9842),m=s(35),p=s(4220),g=s(2261),f=s(9327),v=s(8147),x=s(4431),b=s(9859);var _=s(9481),j=s(6123),N=s.n(j),w=s(6417);function k(e){let{error:t,style:s={}}=e;return(0,w.jsx)("div",{style:s,className:N()("form-validation-error",{error:t}),children:t||"input is valid"})}var y=s(1781);const Z=function(e){let{label:t,value:s,type:n="text",max:r=null,min:o=null,editable:i=!1,handleChange:u,validator:d=(()=>!0),errorMessage:h=null,showDivider:m=!0}=e;const[p,g]=(0,a.useState)(null);return i?(0,w.jsxs)(w.Fragment,{children:[m&&(0,w.jsx)("hr",{className:"my-3"}),(0,w.jsx)("div",{className:"text-nowrap mt-2 mb-1",children:"".concat(t)}),(0,w.jsx)(y.Z,{id:"cluster-field-".concat(t),type:n,className:N()("cluster-field",{error:p}),max:r,min:o,defaultValue:s,onChange:e=>u(e.target.value),onBlur:e=>{const t=d(e.target.value);g(t?null:h)}}),p&&(0,w.jsx)(k,{error:p})]}):(0,w.jsxs)(l.Z,{children:[(0,w.jsx)(c.Z,{xs:"12",children:(0,w.jsx)("hr",{className:"my-3"})}),(0,w.jsx)(c.Z,{xs:"10",className:"text",children:"".concat(t,": ").concat(s)}),(0,w.jsx)(c.Z,{xs:"2",className:"text text-end",children:(0,w.jsx)("i",{className:"fa fa-check-circle fa-lg text-success"})})]})};const C=function(e){var t,s,r;let{setConfiguring:o,clusterStatus:l,refreshStatus:c,compute_stack_id:u}=e;const d=(0,n.Kw)(i.Z,(e=>e.auth)),h=(0,n.Kw)(i.Z,(e=>e.url)),m=l.engine,p=1024,g=65535,[j,N]=(0,a.useState)({clusterRole:(null===l||void 0===l||null===(t=l.cluster_role)||void 0===t?void 0:t.role)||"",clusterUsername:(null===l||void 0===l||null===(s=l.cluster_user)||void 0===s?void 0:s.username)||"cluster_user",clusterPassword:(null===l||void 0===l||null===(r=l.cluster_user)||void 0===r?void 0:r.password)||"",clusterPort:(null===l||void 0===l?void 0:l.config_cluster_port)||"",clusterNodeName:(null===l||void 0===l?void 0:l.node_name)||u}),[y,C]=(0,a.useState)(null);function S(e){N({...j,...e})}async function P(){if(C(null),!l.cluster_user){const e=await(0,_.Z)({auth:d,url:h,role:j.clusterRole,username:j.clusterUsername,password:j.clusterPassword});if(e.error)return void C(e.message)}const e="nats"===m?await(0,x.Z)({auth:d,url:h,clustering_enabled:!0,clustering_nodeName:j.clusterNodeName,clustering_port:j.clusterPort,clustering_user:j.clusterUsername}):await(async e=>{let{CLUSTERING:t=!1,CLUSTERING_PORT:s,CLUSTERING_USER:a,NODE_NAME:n,auth:r,url:o}=e;return(0,b.Z)({operation:{operation:"configure_cluster",CLUSTERING:t,CLUSTERING_PORT:s,CLUSTERING_USER:a,NODE_NAME:n},auth:r,url:o})})({auth:d,url:h,CLUSTERING:!0,CLUSTERING_PORT:j.clusterPort,CLUSTERING_USER:j.clusterUsername,NODE_NAME:j.clusterNodeName});e.error?C(e.message):(window._kmq&&window._kmq.push(["record","enabled clustering"]),await(0,v.Z)({auth:d,url:h}),setTimeout((()=>o(!0)),0),c())}return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Z,{label:"Cluster Role",value:j.clusterRole}),(0,w.jsx)(Z,{label:"Cluster User",handleChange:e=>S({clusterUsername:e}),value:j.clusterUsername,validator:e=>e.trim().length>0,errorMessage:"Please enter a cluster username",editable:!0}),(0,w.jsx)(Z,{label:"Cluster Password",type:"password",handleChange:e=>S({clusterPassword:e}),value:j.clusterPassword,validator:e=>e.trim().length>0,errorMessage:"Please enter a password",editable:!0,showDivider:!1}),(0,w.jsx)(Z,{label:"Cluster Port",type:"number",max:g,min:p,handleChange:e=>S({clusterPort:e}),value:j.clusterPort,validator:e=>e>=p&&e<=g,errorMessage:"Please enter a port number between ".concat(p," and ").concat(g),editable:!0}),(0,w.jsx)(Z,{label:"Cluster Node Name",handleChange:e=>S({clusterNodeName:e}),value:j.clusterNodeName,validator:e=>e.length>0,errorMessage:"Please enter a cluster node name",editable:!0}),(0,w.jsx)("hr",{className:"my-3"}),y&&(0,w.jsx)(k,{error:y}),(0,w.jsx)(f.Z,{block:!0,color:"success",disabled:!function(e){let{clusterRole:t,clusterUsername:s,clusterPassword:a,clusterPort:n,clusterNodeName:r}=e;return(null===t||void 0===t?void 0:t.length)>0&&s.length>0&&a.length>0&&r.length>0&&n>=p&&n<=g}(j),onClick:()=>P(),children:"Enable Clustering"})]})};const S=function(e){let{setConfiguring:t,clusterStatus:s,refreshStatus:a}=e;const{compute_stack_id:r}=(0,o.UO)(),f=null===s||void 0===s?void 0:s.cluster_role,v=(null===s||void 0===s?void 0:s.cluster_role)&&(null===s||void 0===s?void 0:s.cluster_user),x=(null===s||void 0===s?void 0:s.cluster_role)&&(null===s||void 0===s?void 0:s.cluster_user),b=(null===s||void 0===s?void 0:s.cluster_role)&&(null===s||void 0===s?void 0:s.cluster_user)&&(null===s||void 0===s?void 0:s.node_name),_=(0,n.Kw)(i.Z,(e=>e.rule_arn)),j=Boolean(_);return(0,w.jsxs)(l.Z,{id:"clustering",children:[(0,w.jsxs)(c.Z,{xl:"3",lg:"4",md:"5",xs:"12",children:[(0,w.jsx)("span",{className:"floating-card-header",children:"enable clustering"}),(0,w.jsx)(u.Z,{className:"my-3",children:(0,w.jsx)(d.Z,{children:(0,w.jsx)(h.SV,{onError:(e,t)=>(0,g.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:p.Z,children:(0,w.jsx)(C,{setConfiguring:t,refreshStatus:a,clusterStatus:s,compute_stack_id:r})})})})]}),(0,w.jsx)(c.Z,{xl:"9",lg:"8",md:"7",xs:"12",children:b?(0,w.jsx)(m.Z,{headline:"You're all set!",description:"Click the button at left to enable clustering. NOTE: We'll restart the instance when you click this button.",icon:(0,w.jsx)("i",{className:"fa fa-thumbs-up text-success"})}):x?(0,w.jsx)(m.Z,{headline:"Set Instance Cluster Name",description:'We need to set a unique node name to identify your instance in the cluster. By default, we set it to "'.concat(r,'", but you can choose your own unique node name.'),icon:(0,w.jsx)("i",{className:"fa fa-exclamation-triangle text-warning"})}):v?(0,w.jsx)(m.Z,{headline:"Cluster Port Set To: 12345",description:"If your instance is behind a firewall, you'll need to ensure this port is accessible by other instances if you want to publish/subscribe to/from this instance.",icon:(0,w.jsx)("i",{className:"fa fa-thumbs-up text-success"})}):f?(0,w.jsx)(m.Z,{headline:"Create a Cluster User",description:"If you have other instances you want to cluster together with this one, make sure the cluster user has the same name and password as those other instances.",warning:j?"HarperDB clustering functionality will not work between AWS cloud instances. We are working on upgrading our cloud infrastructure to support clustering functionality.":null,icon:(0,w.jsx)("i",{className:"fa fa-exclamation-triangle text-warning"})}):(0,w.jsx)(m.Z,{headline:"Create a Cluster Role",description:"This role subscribes to instance transaction logs and handles operations that result from its pub/sub configuration.",icon:(0,w.jsx)("i",{className:"fa fa-exclamation-triangle text-warning"})})})]})};var P=s(6160);const E=function(e){let{handleAddNode:t,loading:s}=e;return(0,w.jsx)(f.Z,{color:"purple",className:"round",title:"Connect To This Instance",disabled:s,onClick:t,children:(0,w.jsx)("i",{className:"fa ".concat(s?"fa-spin fa-spinner":"fa-plus"," text-white")})})};const O=function(e){let{handleRemoveNode:t,showModal:s,loading:a}=e;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{color:"danger",className:"round me-1",title:"Why isn't this instance clustering?",disabled:a,onClick:s,children:(0,w.jsx)("i",{className:"fa fa-exclamation"})}),(0,w.jsx)(f.Z,{color:"purple",className:"round",title:"Disconnect From This Instance",disabled:a,onClick:t,children:(0,w.jsx)("i",{className:"fa ".concat(a?"fa-spin fa-spinner":"fa-minus"," text-white")})})]})};const T=function(e){let{handleRemoveNode:t,loading:s}=e;return(0,w.jsx)(f.Z,{color:"purple",className:"round",title:"Disconnect From This Instance",disabled:s,onClick:t,children:(0,w.jsx)("i",{className:"fa ".concat(s?"fa-spin fa-spinner":"fa-minus"," text-white")})})};const R=function(){return(0,w.jsx)(f.Z,{color:"purple",className:"round",title:"Connecting to this instance",disabled:!0,children:(0,w.jsx)("i",{className:"fa fa-spin fa-spinner text-white"})})};const M=function(e){let{handleConfigureNode:t,loading:s}=e;return(0,w.jsx)(f.Z,{color:"success",className:"round me-1",title:"Enable Clustering",disabled:s,onClick:t,children:(0,w.jsx)("i",{className:"fa ".concat(s?"fa-spin fa-spinner":"fa-share"," text-white")})})};const F=function(e){var t,s,a;let{setShowModal:n,item:r,itemType:o,loading:i,handleAddNode:u,handleRemoveNode:d,handleConfigureNode:h,refreshNetwork:m}=e;const p=r.compute_stack_id===i;return(0,w.jsxs)(l.Z,{className:"item-row",children:[(0,w.jsx)(c.Z,{className:"item-label ".concat("closed"===(null===(t=r.connection)||void 0===t?void 0:t.state)?"text-danger":""),children:r.instance_name}),(0,w.jsx)(c.Z,{className:"item-action",children:"incompatible/unreachable"===o?null:"unconfigured"===o?(0,w.jsx)(M,{loading:p,handleConfigureNode:()=>h({compute_stack_id:r.compute_stack_id})}):"CREATE_IN_PROGRESS"===r.instance_status?(0,w.jsx)(f.Z,{color:"grey",className:"round",title:"Creating Instance",disabled:!0,children:(0,w.jsx)("i",{className:"fa fa-spin fa-spinner"})}):r.connection?"closed"===(null===(s=r.connection)||void 0===s?void 0:s.state)?(0,w.jsx)(O,{loading:p,handleRemoveNode:()=>d({compute_stack_id:r.compute_stack_id}),showModal:()=>n(r.instance_name)}):"connecting"===(null===(a=r.connection)||void 0===a?void 0:a.state)?(0,w.jsx)(R,{refreshNetwork:m}):(0,w.jsx)(T,{loading:p,handleRemoveNode:()=>d({compute_stack_id:r.compute_stack_id,instance_host:r.instance_host,clusterPort:r.clusterPort})}):(0,w.jsx)(E,{loading:p,handleAddNode:()=>u({compute_stack_id:r.compute_stack_id,instance_url:r.instance_url,instance_host:r.instance_host,clusterPort:r.clusterPort})})})]})};var U=s(9358);const I=function(e){let{items:t,itemType:s,setShowModal:r,loading:h,setLoading:m,refreshNetwork:p}=e;const{customer_id:g}=(0,o.UO)(),f=(0,o.s0)(),v=(0,P.VY)(),x=(0,n.Kw)(i.Z,(e=>e.compute_stack_id)),_=(0,n.Kw)(i.Z,(e=>e.auth),[x]),j=(0,n.Kw)(i.Z,(e=>e.url),[x]),N=(0,n.Kw)(i.Z,(e=>e.is_local),[x]),k=(0,n.Kw)(i.Z,(e=>{var t;return parseFloat(null===(t=e.auth)||void 0===t?void 0:t.version)>=4?"nats":"socketcluster"}),[x]),y=(0,a.useCallback)((async e=>{m(e.compute_stack_id);const t="nats"===k?await(async e=>{let{auth:t,url:s,server:a="hub",routes:n}=e;return(0,b.Z)({operation:{operation:"cluster_set_routes",server:a,routes:n},auth:t,url:s})})({auth:_,url:j,routes:[{host:e.instance_host,port:e.clusterPort}]}):await(async e=>{let{compute_stack_id:t,instance_host:s,clusterPort:a,auth:n,url:r}=e;return(0,b.Z)({operation:{operation:"add_node",name:t,node_name:t,host:s,port:a,subscriptions:[]},auth:n,url:r})})({...e,auth:_,url:j,is_local:N,customer_id:g});t.error?(v.error("localhost"===e.instance_host?"External instances cannot reach that instance's URL":t.message),m(!1)):("nats"===k&&await(0,U.Z)({auth:_,url:j,service:"clustering config"}),await p()),m(!1)}),[m,_,j,N,g,p,v,k]),Z=(0,a.useCallback)((async e=>{m(e.compute_stack_id);const t="nats"===k?await(async e=>{let{auth:t,url:s,routes:a}=e;return(0,b.Z)({operation:{operation:"cluster_delete_routes",routes:a},auth:t,url:s})})({auth:_,url:j,routes:[{host:e.instance_host,port:e.clusterPort}]}):await(async e=>{let{compute_stack_id:t,auth:s,url:a}=e;return(0,b.Z)({operation:{operation:"remove_node",name:t,node_name:t},auth:s,url:a})})({...e,auth:_,url:j,is_local:N,customer_id:g});t.error?(v.error(t.message),m(!1)):("nats"===k&&await(0,U.Z)({auth:_,url:j,service:"clustering config"}),await p()),m(!1)}),[m,_,j,N,g,p,v,k]),C=(0,a.useCallback)((e=>f("/o/".concat(g,"/i/").concat(e.compute_stack_id,"/cluster"))),[f,g]);return(0,w.jsxs)("div",{className:"entity-manager",children:[(0,w.jsxs)("div",{className:"floating-card-header",children:[s," instances"]}),(0,w.jsx)(u.Z,{className:"my-3",children:(0,w.jsx)(d.Z,{children:null!==t&&void 0!==t&&t.length?t.map((e=>(0,w.jsx)(F,{item:e,itemType:s,setShowModal:r,handleAddNode:y,handleRemoveNode:Z,handleConfigureNode:C,loading:h,refreshNetwork:p},e.instance_name))):t?(0,w.jsx)(l.Z,{className:"item-row",children:(0,w.jsxs)(c.Z,{className:"item-label",children:["There are no ",s," instances"]})}):(0,w.jsx)(l.Z,{className:"item-row",children:(0,w.jsx)(c.Z,{className:"item-label",children:(0,w.jsx)("i",{className:"fa fa-spinner fa-spin"})})})})})]})};var L=s(6855);const z={filtered:[],sorted:[],page:0,totalPages:1,pageSize:20,autoRefresh:!1,showFilter:!1,lastUpdate:!1};const A=function(e){let{refreshNetwork:t,loading:s,setLoading:r}=e;const o=(0,n.Kw)(i.Z,(e=>e.clusterDataTable||[])),h=(0,n.Kw)(i.Z,(e=>e.clusterDataTableColumns||[])),[m,p]=(0,a.useState)(z);(0,a.useEffect)((()=>{p({...m,totalPages:Math.ceil((o.length||m.pageSize)/m.pageSize)})}),[p,m.pageSize]);const g=(0,a.useCallback)((async()=>{r(!0),t()}),[r,t]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(l.Z,{className:"floating-card-header",children:[(0,w.jsx)(c.Z,{children:"manage clustering"}),(0,w.jsx)(c.Z,{className:"text-end",children:(0,w.jsxs)(f.Z,{color:"link",onClick:g,className:"me-2",children:[(0,w.jsx)("span",{className:"me-2",children:"refresh network"}),(0,w.jsx)("i",{title:"Refresh Roles",className:"fa ".concat(s?"fa-spinner fa-spin":"fa-refresh")})]})})]}),(0,w.jsx)(u.Z,{className:"my-3",children:(0,w.jsx)(d.Z,{className:"react-table-holder ".concat(s?"loading":""),children:null!==o&&void 0!==o&&o.length?(0,w.jsx)(L.Z,{columns:h,data:o,page:m.page,pageSize:m.pageSize,totalPages:m.totalPages,showFilter:m.showFilter,sorted:m.sorted,onFilteredChange:e=>p({...m,filtered:e}),onSortedChange:e=>p({...m,sorted:e}),onPageChange:e=>p({...m,pageSize:e}),onPageSizeChange:e=>p({...m,page:0,pageSize:e})}):(0,w.jsx)("div",{className:"empty-prompt",children:"Please connect at least one instance to configure clustering"})})})]})};var D=s(1446),K=s(2020),G=s(8642);const B=function(e){let{showModal:t,setShowModal:s}=e;const{compute_stack_id:a}=(0,o.UO)(),r=(0,n.Kw)(i.Z,(e=>e.instance_name),[a]);return(0,w.jsxs)(D.Z,{id:"cluster-state-modal",isOpen:!!t,toggle:()=>s(!1),centered:!0,fade:!1,children:[(0,w.jsx)(K.Z,{toggle:()=>s(!1),children:"Instance Cluster Error"}),(0,w.jsx)(G.Z,{children:(0,w.jsx)(u.Z,{children:(0,w.jsxs)(d.Z,{children:[(0,w.jsx)("b",{children:r})," is unable to open a connection to ",(0,w.jsx)("b",{children:t}),".",(0,w.jsx)("hr",{className:"my-3"}),(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"Clustered instances must be able to reach each other. This may require allowing access through a firewall."}),(0,w.jsx)("li",{children:"Both instances must be running. In the event of a restart, instances will automatically attempt to reconnect."}),(0,w.jsxs)("li",{children:["Clustered instances must have the same cluster user ",(0,w.jsx)("b",{children:"name"})," and ",(0,w.jsx)("b",{children:"password"}),". You can edit an instance's cluster user credentials in the ",(0,w.jsx)("b",{children:"config"})," ","section."]})]}),(0,w.jsx)("hr",{className:"my-3"}),"If none of these help fix the issue, you can disconnect ",(0,w.jsx)("b",{children:t})," from ",(0,w.jsx)("b",{children:r})," by clicking the purple disconnect button with the minus sign."]})})})]})};var X=s(3406),H=s.n(X);var V=s(2274);const Y=async e=>{let{channel:t,subscriptions:s,buttonState:a,instance_host:n,clusterPort:r,clusterName:o,auth:l,url:c}=e;const u=JSON.parse(JSON.stringify(s)),d=u.findIndex((e=>e.channel===t)),[h,m]=t.split(":");-1===d?u.push({channel:t,schema:h,table:m,publish:"togglePublish"===a,subscribe:"toggleSubscribe"===a}):"togglePublish"===a?u[d].publish=!u[d].publish:"toggleSubscribe"===a&&(u[d].subscribe=!u[d].subscribe),u[d]&&!u[d].publish&&u[d].subscribe;const p={operation:"update_node",name:o,node_name:o,host:n,port:r,subscriptions:u},g=await(0,b.Z)({operation:p,auth:l,url:c});return g.error&&-1!==g.message.indexOf("add_node")&&(p.operation="add_node",await(0,b.Z)({operation:p,auth:l,url:c})),i.Z.update((e=>{e.lastUpdate=Date.now()}))};var q=s(1343),W=s(3708),$=s(4095);const J=async e=>{let{instance:t,auth:s}=e;const a=s&&await(0,$.Z)({auth:s,url:t.url}),n=s&&await(0,q.Z)({auth:s,url:t.url}),{structure:r}=n?(0,W.Z)(n):{structure:{}},o=new URL(t.url),i={...t,auth:s,structure:r,host:o.hostname,clustering:a};return Object.entries(i).reduce(((e,t)=>{let[s,a]=t;return null==a||(e[s]=a),e}),{})},Q=async e=>{let{auth:t,url:s,instances:a,connections:n}=e;const r=await(async e=>{let{auth:t,url:s}=e;return(0,b.Z)({operation:{operation:"cluster_get_routes"},auth:t,url:s})})({auth:t,url:s});return r.hub.map((e=>{var t;const s=a.find((t=>t.host===e.host||t.private_ip===e.host));if(!s)return!1;const r=s.host===s.private_ip?s.private_ip:s.host,o=n.find((e=>{var t;return e.node_name===(null===s||void 0===s||null===(t=s.clustering)||void 0===t?void 0:t.node_name)})),i=(null===o||void 0===o||null===(t=o.subscriptions)||void 0===t?void 0:t.map((e=>({channel:"".concat(e.schema,":").concat(e.table),...e}))))||[];return{host:r,port:e.port,state:"open",name:null===s||void 0===s?void 0:s.compute_stack_id,subscriptions:i}})).filter((e=>!1!==e))},ee=e=>{let{connections:t}=e;return t?t.filter((e=>-1===e.host_address.indexOf("::ffff"))).map((e=>({name:e.node_name,host:e.host_address,port:e.host_port,state:e.state,subscriptions:e.subscriptions}))):[]},te=async e=>{let{auth:t,url:s,instances:a,compute_stack_id:n,instanceAuths:r,setLoading:o}=e;const l=await Promise.all(a.filter((e=>!!r[e.compute_stack_id])).map((e=>J({instance:e,auth:r[e.compute_stack_id]})))),c=l.find((e=>e.compute_stack_id===n)),u=c.clustering.message||!c.clustering.is_enabled?[]:"nats"===c.clustering.engine?await Q({auth:t,url:s,instances:l,connections:c.clustering.connections}):ee({connections:c.clustering.status.outbound_connections}),d={is_enabled:c.clustering.is_enabled,connections:u},h=(e=>{let{instances:t,network:s,instance_region:a,instance_wavelength_zone_id:n,instance_cluster_engine:r}=e;const o=t.filter((e=>e.url&&"DELETE_IN_PROGRESS"!==e.status)).filter((e=>e.clustering.engine===r)).map((e=>{var t,o;const i="socketcluster"===r?null===s||void 0===s?void 0:s.connections.find((t=>t.name===e.compute_stack_id)):null===s||void 0===s?void 0:s.connections.find((t=>t.host===e.host)),l=(null===i||void 0===i?void 0:i.subscriptions)||[],c=null===e||void 0===e||null===(t=e.clustering)||void 0===t?void 0:t.config_cluster_port,u=e.is_local?"OK":e.status,d=!a||a!==e.instance_region||e.wavelength_zone_id||n?e.url.match(/^https?:\/\/([^/:?#]+)(?:[/:?#]|$)/i)[1]:e.private_ip,h=e.clustering.node_name;return{instance_name:e.instance_name,instance_url:e.url,compute_stack_id:e.compute_stack_id,instance_status:u,instance_host:d,clusterPort:c,clusterName:h,connection:i,subscriptions:l,structure:e.structure,configured:null===(o=e.clustering)||void 0===o?void 0:o.is_ready}})),i=t.filter((e=>e.clustering.engine!==r)).map((e=>({instance_name:e.instance_name,compute_stack_id:e.name})));return{connected:o.filter((e=>e.connection&&e.configured)),unconnected:o.filter((e=>!e.connection&&e.configured)),unconfigured:o.filter((e=>!e.configured)),unreachable:i}})({instances:l.filter((e=>r[e.compute_stack_id]&&e.compute_stack_id!==n)),network:d,instance_region:c.instance_region,instance_wavelength_zone_id:c.wavelength_zone_id,instance_cluster_engine:c.clustering.engine}),m=(e=>{let{instances:t,structure:s}=e;if(!s||!t.length)return[];const a=[];return t.map((e=>{const t=H()(e.structure,s);return Object.keys(t).sort().map(((s,n)=>(Object.keys(t[s]).sort().map(((t,r)=>{const o="".concat(s,":").concat(t),i=o&&e.subscriptions.find((e=>e.channel===o)),l=i&&i.publish,c=i&&i.subscribe;return a.push({is_first_instance:0===n&&0===r,is_first_schema:0===r,instance_name:e.instance_name,schema:s,table:t,compute_stack_id:e.compute_stack_id,instance_host:e.instance_host,clusterPort:e.clusterPort,clusterName:e.clusterName,subscriptions:e.subscriptions,channel:o,publish:l,subscribe:c}),!0})),!0))),!0})),a})({instances:h.connected.filter((e=>"closed"!==e.connection.state)),structure:c.structure}),p=(e=>{let{auth:t,url:s,buildNetwork:a,setLoading:n}=e;return[{Header:"instance",Cell:e=>{let{row:{original:{is_first_instance:t,instance_name:s}}}=e;return(0,w.jsx)("div",{className:"".concat(t?"text-bold":"text-grey"),children:s})}},{Header:"schema",Cell:e=>{let{row:{original:{is_first_schema:t,schema:s}}}=e;return(0,w.jsx)("div",{className:"".concat(t?"text-bold":"text-grey"),children:s})}},{Header:"table",accessor:"table"},{Header:"publish",id:"hdb-narrow-publish",Cell:e=>{let{row:{original:{compute_stack_id:r,instance_host:o,instance_name:i,clusterPort:l,clusterName:c,subscriptions:u,publish:d,channel:h}}}=e;return(0,w.jsx)(V.Z,{checked:d||!1,onChange:async()=>{n(r),await Y({channel:h,subscriptions:u,instance_host:o,instance_name:i,clusterPort:l,clusterName:c,auth:t,url:s,buttonState:"togglePublish"}),a()}})}},{Header:"subscribe",id:"hdb-narrow-subscribe",Cell:e=>{let{row:{original:{compute_stack_id:r,instance_host:o,instance_name:i,clusterPort:l,clusterName:c,subscriptions:u,subscribe:d,channel:h}}}=e;return(0,w.jsx)(V.Z,{checked:d||!1,onChange:async()=>{n(r),await Y({channel:h,subscriptions:u,instance_host:o,instance_name:i,clusterPort:l,clusterName:c,auth:t,url:s,buttonState:"toggleSubscribe"}),a()}})}}]})({auth:t,url:c.url,compute_stack_id:n,buildNetwork:()=>te({auth:t,url:s,instances:a,compute_stack_id:n,instanceAuths:r,setLoading:o}),setLoading:o});return i.Z.update((e=>{e.network=d,e.clusterPartners=h,e.clusterDataTable=m,e.clusterDataTableColumns=p,e.instances=l})),o(!1),{network:d,clusterPartners:h,clusterDataTable:m,clusterDataTableColumns:p}},se=te;var ae=s(6449),ne=s(2190);const re=function(e){let{configuring:t}=e;const{compute_stack_id:s}=(0,o.UO)(),u=(0,n.Kw)(ae.Z,(e=>e.instances)),[d]=(0,ne.Z)({}),m=(0,n.Kw)(i.Z,(e=>e.auth),[s]),f=(0,n.Kw)(i.Z,(e=>e.url),[s]),v=(0,n.Kw)(i.Z,(e=>e.clusterPartners),[s]),x=(0,n.Kw)(i.Z,(e=>e.restarting),[s]),b="socketcluster"===(0,n.Kw)(i.Z,(e=>{var t;return parseFloat(null===(t=e.registration)||void 0===t?void 0:t.version)>=4?"nats":"socketcluster"}),[s])&&(null===v||void 0===v?void 0:v.connected.some((e=>"connecting"===e.connection.state))),[_,j]=(0,a.useState)(!1),[N,k]=(0,a.useState)(!1),y=(0,a.useCallback)((async()=>{m&&f&&u&&s&&!x&&!t&&await se({auth:m,url:f,instances:u,compute_stack_id:s,instanceAuths:d,setLoading:k})}),[m,f,u,s,x,d,t]);return(0,a.useEffect)((()=>{y()}),[y]),(0,r.Z)((()=>b&&y()),1500),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(l.Z,{id:"clustering",children:[(0,w.jsx)(c.Z,{xl:"3",lg:"4",md:"6",xs:"12",children:(0,w.jsxs)(h.SV,{onError:(e,t)=>(0,g.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:p.Z,children:[(0,w.jsx)(I,{items:null===v||void 0===v?void 0:v.connected,itemType:"connected",loading:N,refreshNetwork:y,setLoading:k,setShowModal:j}),(0,w.jsx)(I,{items:null===v||void 0===v?void 0:v.unconnected,itemType:"unconnected",loading:N,refreshNetwork:y,setLoading:k}),(0,w.jsx)(I,{items:null===v||void 0===v?void 0:v.unconfigured,itemType:"unconfigured",loading:N}),(0,w.jsx)(I,{items:null===v||void 0===v?void 0:v.unreachable,itemType:"incompatible/unreachable",loading:N})]})}),(0,w.jsx)(c.Z,{xl:"9",lg:"8",md:"6",xs:"12",children:(0,w.jsx)(A,{refreshNetwork:y,loading:N,setLoading:k})})]}),(0,w.jsx)(B,{showModal:_,setShowModal:j})]})};var oe=s(7377);const ie={path:"replication",link:"replication",label:"replication",icon:"cubes",iconCode:"f1e0"};const le=function(){const{compute_stack_id:e}=(0,o.UO)(),t=(0,n.Kw)(i.Z,(e=>e.auth),[e]),s=(0,n.Kw)(i.Z,(e=>e.url),[e]),[l,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)(!1),h=(0,a.useCallback)((async()=>{if(t&&s){const e=await(0,$.Z)({auth:t,url:s});c(e),e.is_ready&&d(!1)}}),[t,s]);return(0,r.Z)((async()=>{u&&h()}),3e3),(0,a.useEffect)((()=>{h()}),[h]),(0,a.useEffect)((()=>{c(!1)}),[e]),l?u?(0,w.jsx)(m.Z,{description:"Configuring Clustering",icon:(0,w.jsx)("i",{className:"fa fa-spinner fa-spin"})}):l.is_ready?(0,w.jsx)(re,{configuring:u}):(0,w.jsx)(S,{setConfiguring:d,clusterStatus:l,refreshStatus:h}):(0,w.jsx)(oe.Z,{header:"loading network",spinner:!0})}},6855:(e,t,s)=>{s.d(t,{Z:()=>_});var a=s(7313),n=s(5110),r=s(1781),o=s(9842),i=s(6782),l=s(5399),c=s(6417);const u=e=>{let{headerGroups:t,onSortedChange:s,sorted:a,showFilter:n}=e;return t.map((e=>(0,c.jsxs)("div",{...e.getHeaderGroupProps(),children:[(0,c.jsx)(i.Z,{className:"header g-0",children:e.headers.map((e=>{var t,n;return(0,c.jsx)(l.Z,{onClick:()=>{var t,n;return s([{id:e.id,desc:(null===(t=a[0])||void 0===t?void 0:t.id)===e.id&&!(null!==(n=a[0])&&void 0!==n&&n.desc)}])},className:"".concat((null===(t=a[0])||void 0===t?void 0:t.id)===e.id?"sorted":""," ").concat(null!==(n=a[0])&&void 0!==n&&n.desc?"desc":"asc"," ").concat(-1!==e.id.indexOf("hdb-narrow")?"action":""," px-1"),children:(0,c.jsx)("div",{className:"text-renderer",children:e.render("Header")})},e.id)}))}),n&&(0,c.jsx)(i.Z,{className:"filter g-0",children:e.headers.map((e=>(0,c.jsx)(l.Z,{className:-1!==e.id.indexOf("hdb-narrow")?"action":"",children:e.render("Filter")},e.id)))})]})))};var d=s(9327);const h=function(e){let{page:t,pageSize:s,totalPages:a,onPageChange:n,onPageSizeChange:o,loading:u}=e;return(0,c.jsxs)(i.Z,{className:"pagination",children:[(0,c.jsx)(l.Z,{xs:"12",sm:"2",className:"previous",children:(0,c.jsx)(d.Z,{className:"mb-2 btn-pagination",color:"purple",block:!0,onClick:()=>n(t-1),disabled:!a||0===t,children:(0,c.jsx)("i",{className:"fa fa-chevron-left"})})}),(0,c.jsxs)(l.Z,{xs:"12",sm:"4",className:"paginator",children:[(0,c.jsx)("i",{className:"fa fa-book me-2"}),(0,c.jsx)(r.Z,{className:"mb-2",type:"number",value:t+1,min:1,max:a,onChange:e=>n(e.target.value-1)}),(0,c.jsxs)("div",{className:"page-count",children:["\xa0/\xa0",u?(0,c.jsx)("i",{className:"fa fa-spinner fa-spin"}):a]})]}),(0,c.jsx)(l.Z,{xs:"12",sm:"4",className:"page-size",children:(0,c.jsx)(r.Z,{className:"mb-2",type:"select",value:s,onChange:e=>o(e.target.value),children:[20,50,100,250].map((e=>(0,c.jsxs)("option",{value:e,children:[e," rows"]},e)))})}),(0,c.jsx)(l.Z,{xs:"12",sm:"2",className:"next",children:(0,c.jsx)(d.Z,{className:"mb-2 pull-right btn-pagination",block:!0,color:"purple",onClick:()=>n(t+1),disabled:!a||t+1===a,children:(0,c.jsx)("i",{className:"fa fa-chevron-right"})})})]})};const m=function(e){let{previousPage:t,canPreviousPage:s,pageIndex:a,gotoPage:n,setPageSize:o,pageCount:u,nextPage:h,canNextPage:m,loading:p}=e;return(0,c.jsxs)(i.Z,{className:"pagination",children:[(0,c.jsx)(l.Z,{xs:"12",sm:"2",className:"previous",children:(0,c.jsx)(d.Z,{className:"mb-2 btn-pagination",color:"purple",block:!0,onClick:t,disabled:!u||!s,children:(0,c.jsx)("i",{className:"fa fa-chevron-left"})})}),(0,c.jsxs)(l.Z,{xs:"12",sm:"4",className:"paginator",children:[(0,c.jsx)("i",{className:"fa fa-book me-2"}),(0,c.jsx)(r.Z,{className:"mb-2",type:"number",value:a+1||1,min:1,max:u,onChange:e=>n(e.target.value?Number(e.target.value)-1:0)}),(0,c.jsxs)("div",{className:"page-count",children:["\xa0/\xa0",p?(0,c.jsx)("i",{className:"fa fa-spinner fa-spin"}):u]})]}),(0,c.jsx)(l.Z,{xs:"12",sm:"4",className:"page-size",children:(0,c.jsx)(r.Z,{className:"mb-2",type:"select",onChange:e=>{n(0),setTimeout((()=>o(e.target.value)),1e3)},children:[20,50,100,250].map((e=>(0,c.jsxs)("option",{value:e,children:[e," rows"]},e)))})}),(0,c.jsx)(l.Z,{xs:"12",sm:"2",className:"next",children:(0,c.jsx)(d.Z,{className:"mb-2 pull-right btn-pagination",block:!0,color:"purple",onClick:h,disabled:!u||!m,children:(0,c.jsx)("i",{className:"fa fa-chevron-right"})})})]})};const p=function(e){let{prepareRow:t,row:s,onRowClick:a=!1}=e;return t(s),(0,c.jsx)(i.Z,{onClick:()=>a&&a(s.original),className:"g-0",children:s.cells.map((e=>(0,c.jsx)(l.Z,{className:-1!==e.column.id.indexOf("hdb-narrow")?"action":"",children:e.render("Cell")},"".concat(e.row.id,"-").concat(e.column.id))))})};var g=s(2261),f=s(4220);function v(e){let{value:t}=e;return(0,c.jsx)("div",{className:"text-renderer",children:t})}function x(e){let{src:t}=e;const[s,n]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1);return(0,c.jsxs)("div",{className:"image-renderer",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[(0,c.jsx)("i",{className:"fa fa-image"}),s&&r?(0,c.jsxs)("div",{className:"preview-image no-image",children:[(0,c.jsx)("i",{className:"fa fa-ban text-danger"}),(0,c.jsx)("div",{className:"mt-2",children:"image failed to load"})]}):s?(0,c.jsx)("img",{onError:o,alt:t,src:t,className:"preview-image"}):null]})}const b={Filter:e=>{let{column:{filterValue:t,setFilter:s}}=e;return(0,c.jsx)(r.Z,{type:"text",value:t||"",onChange:e=>s(e.target.value||void 0)})},Cell:e=>{let{value:t}=e;return(e=>{switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Object]":return(0,c.jsx)(v,{value:JSON.stringify(e)});case"[object Boolean]":return(0,c.jsx)(v,{value:e?"true":"false"});case"[object String]":return(t=e)&&(t.match(/^https?.*\.(jpeg|jpg|gif|png)$/)||-1!==t.indexOf("data:image"))?(0,c.jsx)(x,{src:e}):(0,c.jsx)(v,{value:e});default:return(0,c.jsx)(v,{value:e})}var t})(t)}};const _=function(e){let{columns:t,data:s,currentPage:r,pageSize:i,totalPages:l,onFilteredChange:d,onSortedChange:v,onPageChange:x,onPageSizeChange:_,showFilter:j,onRowClick:N,sorted:w,loading:k,manual:y=!1}=e;const{headerGroups:Z,page:C,rows:S,prepareRow:P,state:E,setAllFilters:O,canPreviousPage:T,canNextPage:R,pageOptions:M,pageCount:F,gotoPage:U,nextPage:I,previousPage:L,setPageSize:z}=(0,n.useTable)({columns:t,data:s,defaultColumn:b,onFilteredChange:d,onSortedChange:v,onPageChange:x,onPageSizeChange:_,onRowClick:N,manualPagination:y,manualFilters:y,initialState:{pageIndex:r,pageSize:i}},n.useFilters,n.usePagination),[A,D]=(0,a.useState)(!0),K=y||!C.length?S:C;return(0,a.useEffect)((()=>{!j&&E.filters.length?O([]):d(E.filters)}),[E.filters,j]),(0,a.useEffect)((()=>{setTimeout((()=>D(!1)),100)}),[null===K||void 0===K?void 0:K.length]),(0,c.jsxs)(o.SV,{onError:(e,t)=>(0,g.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:f.Z,children:[(0,c.jsxs)("div",{className:"react-table-scroller",children:[(0,c.jsx)(u,{headerGroups:Z,onSortedChange:v,sorted:w,showFilter:j}),k||A?(0,c.jsx)("div",{className:"centered text-center",children:(0,c.jsx)("i",{className:"fa fa-spinner fa-spin"})}):K.length?K.map((e=>(0,c.jsx)(p,{row:e,prepareRow:P,onRowClick:N},e.id))):(0,c.jsxs)("div",{className:"centered text-center",children:[(0,c.jsx)("i",{className:"fa fa-exclamation-triangle text-danger"}),(0,c.jsx)("div",{className:"mt-2 text-darkgrey",children:"no records"})]})]}),y?(0,c.jsx)(h,{page:r,pageSize:i,totalPages:l,onPageChange:x,onPageSizeChange:_,loading:k}):(0,c.jsx)(m,{previousPage:L,pageSize:i,canPreviousPage:T,pageIndex:E.pageIndex,pageOptions:M,gotoPage:U,setPageSize:z,pageCount:F,nextPage:I,canNextPage:R,loading:k})]})}},9481:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(9859);const n=async e=>{let{auth:t,role:s,username:n,password:r,url:o}=e;return(0,a.Z)({operation:{operation:"add_user",role:s,username:n,password:r,active:!0},auth:t,url:o})}},7093:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(9859);const n=async e=>{let{auth:t,url:s}=e;return(0,a.Z)({operation:{operation:"get_configuration"},auth:t,url:s})}},5200:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(9859),n=s(5447);const r=async e=>{let{auth:t,url:s}=e;const r=await(0,a.Z)({operation:{operation:"list_roles"},auth:t,url:s}),o=[...Array.isArray(r)?r:[]].sort(((e,t)=>e.role.toLowerCase()>t.role.toLowerCase()?1:-1));return n.Z.update((e=>{e.roles=o})),o}},2066:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(9859),n=s(5447);const r=async e=>{let{auth:t,url:s,signal:r}=e;const o=await(0,a.Z)({operation:{operation:"list_users"},auth:t,url:s,signal:r}),i=Array.isArray(o)?[...o].map((e=>({username:e.username,role:e.role.role}))).sort(((e,t)=>e.username.toLowerCase()>t.username.toLowerCase()?1:-1)):[];return n.Z.update((e=>{e.users=i})),i}},8147:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(9859),n=s(5447);const r=async e=>{let{auth:t,url:s}=e;return n.Z.update((e=>{e.restarting=!0})),(0,a.Z)({operation:{operation:"restart"},auth:t,url:s})}},9358:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(9859),n=s(5447);const r=async e=>{let{auth:t,url:s,service:r=null}=e;return r?(n.Z.update((e=>{e.restarting_service=r})),(0,a.Z)({operation:{operation:"restart_service",service:r},auth:t,url:s})):{error:!0,message:"You must specify a service"}}},4431:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(9859);const n=async e=>{let{auth:t,url:s,...n}=e;return(0,a.Z)({operation:{operation:"set_configuration",...n},auth:t,url:s})}},4095:(e,t,s)=>{s.d(t,{Z:()=>l});var a=s(7093),n=s(5200),r=s(2066),o=s(5491),i=s(9859);const l=async e=>{let{auth:t,url:s}=e;const l=await(0,a.Z)({auth:t,url:s}),c=await(0,o.Z)({auth:t,url:s}),u=await(async e=>{let{auth:t,url:s}=e;return(0,i.Z)({operation:{operation:"cluster_status"},auth:t,url:s})})({auth:t,url:s}),d=parseFloat(null===c||void 0===c?void 0:c.version)>=4?"nats":"socketcluster",h=await(0,n.Z)({auth:t,url:s});let m=!1;h.error||(m=h.find((e=>e.permission.cluster_user)));const p=await(0,r.Z)({auth:t,url:s});let g=!1;p.error||(g=m&&p.find((e=>e.role===m.role)));const f="nats"===d?l.clustering.enabled:l.CLUSTERING,v="nats"===d?l.clustering.user:l.CLUSTERING_USER,x="nats"===d?l.clustering.hubServer.cluster.network.port:l.CLUSTERING_PORT,b="nats"===d?l.clustering.nodeName:l.NODE_NAME;return{is_ready:!!f&&!!g&&!!v&&!!m&&!!x&&!!b,cluster_role:m,cluster_user:g,is_enabled:f,config_cluster_user:v,config_cluster_port:x,node_name:b,engine:d,status:null===u||void 0===u?void 0:u.status,message:null===u||void 0===u?void 0:u.message,connections:null===u||void 0===u?void 0:u.connections}}},3406:e=>{var t=function(e){return function(e){return!!e&&"object"===typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===s}(e)}(e)};var s="function"===typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function a(e,t){return!1!==t.clone&&t.isMergeableObject(e)?l((s=e,Array.isArray(s)?[]:{}),e,t):e;var s}function n(e,t,s){return e.concat(t).map((function(e){return a(e,s)}))}function r(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function o(e,t){try{return t in e}catch(s){return!1}}function i(e,t,s){var n={};return s.isMergeableObject(e)&&r(e).forEach((function(t){n[t]=a(e[t],s)})),r(t).forEach((function(r){(function(e,t){return o(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,r)||(o(e,r)&&s.isMergeableObject(t[r])?n[r]=function(e,t){if(!t.customMerge)return l;var s=t.customMerge(e);return"function"===typeof s?s:l}(r,s)(e[r],t[r],s):n[r]=a(t[r],s))})),n}function l(e,s,r){(r=r||{}).arrayMerge=r.arrayMerge||n,r.isMergeableObject=r.isMergeableObject||t,r.cloneUnlessOtherwiseSpecified=a;var o=Array.isArray(s);return o===Array.isArray(e)?o?r.arrayMerge(e,s,r):i(e,s,r):a(s,r)}l.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,s){return l(e,s,t)}),{})};var c=l;e.exports=c},6194:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});var a,n=s(7313),r=(a=n)&&a.__esModule?a:{default:a};t.default=function(){return r.default.createElement("svg",{width:"14",height:"11",viewBox:"0 0 14 11"},r.default.createElement("path",{d:"M11.264 0L5.26 6.004 2.103 2.847 0 4.95l5.26 5.26 8.108-8.107L11.264 0",fill:"#fff",fillRule:"evenodd"}))}},2274:(e,t,s)=>{var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n=function(){function e(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),r=s(7313),o=h(r),i=h(s(6123)),l=h(s(5192)),c=h(s(6194)),u=h(s(2808)),d=s(8354);function h(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.handleClick=s.handleClick.bind(s),s.handleTouchStart=s.handleTouchStart.bind(s),s.handleTouchMove=s.handleTouchMove.bind(s),s.handleTouchEnd=s.handleTouchEnd.bind(s),s.handleFocus=s.handleFocus.bind(s),s.handleBlur=s.handleBlur.bind(s),s.previouslyChecked=!(!e.checked&&!e.defaultChecked),s.state={checked:!(!e.checked&&!e.defaultChecked),hasFocus:!1},s}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"componentDidUpdate",value:function(e){e.checked!==this.props.checked&&this.setState({checked:!!this.props.checked})}},{key:"handleClick",value:function(e){if(!this.props.disabled){var t=this.input;if(e.target!==t&&!this.moved)return this.previouslyChecked=t.checked,e.preventDefault(),t.focus(),void t.click();var s=this.props.hasOwnProperty("checked")?this.props.checked:t.checked;this.setState({checked:s})}}},{key:"handleTouchStart",value:function(e){this.props.disabled||(this.startX=(0,d.pointerCoord)(e).x,this.activated=!0)}},{key:"handleTouchMove",value:function(e){if(this.activated&&(this.moved=!0,this.startX)){var t=(0,d.pointerCoord)(e).x;this.state.checked&&t+15<this.startX?(this.setState({checked:!1}),this.startX=t,this.activated=!0):t-15>this.startX&&(this.setState({checked:!0}),this.startX=t,this.activated=t<this.startX+5)}}},{key:"handleTouchEnd",value:function(e){if(this.moved){var t=this.input;if(e.preventDefault(),this.startX){var s=(0,d.pointerCoord)(e).x;!0===this.previouslyChecked&&this.startX+4>s?this.previouslyChecked!==this.state.checked&&(this.setState({checked:!1}),this.previouslyChecked=this.state.checked,t.click()):this.startX-4<s&&this.previouslyChecked!==this.state.checked&&(this.setState({checked:!0}),this.previouslyChecked=this.state.checked,t.click()),this.activated=!1,this.startX=null,this.moved=!1}}}},{key:"handleFocus",value:function(e){var t=this.props.onFocus;t&&t(e),this.setState({hasFocus:!0})}},{key:"handleBlur",value:function(e){var t=this.props.onBlur;t&&t(e),this.setState({hasFocus:!1})}},{key:"getIcon",value:function(e){var s=this.props.icons;return s?void 0===s[e]?t.defaultProps.icons[e]:s[e]:null}},{key:"render",value:function(){var e=this,t=this.props,s=t.className,n=(t.icons,function(e,t){var s={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(s[a]=e[a]);return s}(t,["className","icons"])),r=(0,i.default)("react-toggle",{"react-toggle--checked":this.state.checked,"react-toggle--focus":this.state.hasFocus,"react-toggle--disabled":this.props.disabled},s);return o.default.createElement("div",{className:r,onClick:this.handleClick,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd},o.default.createElement("div",{className:"react-toggle-track"},o.default.createElement("div",{className:"react-toggle-track-check"},this.getIcon("checked")),o.default.createElement("div",{className:"react-toggle-track-x"},this.getIcon("unchecked"))),o.default.createElement("div",{className:"react-toggle-thumb"}),o.default.createElement("input",a({},n,{ref:function(t){e.input=t},onFocus:this.handleFocus,onBlur:this.handleBlur,className:"react-toggle-screenreader-only",type:"checkbox"})))}}]),t}(r.PureComponent);t.Z=m,m.displayName="Toggle",m.defaultProps={icons:{checked:o.default.createElement(c.default,null),unchecked:o.default.createElement(u.default,null)}},m.propTypes={checked:l.default.bool,disabled:l.default.bool,defaultChecked:l.default.bool,onChange:l.default.func,onFocus:l.default.func,onBlur:l.default.func,className:l.default.string,name:l.default.string,value:l.default.string,id:l.default.string,"aria-labelledby":l.default.string,"aria-label":l.default.string,icons:l.default.oneOfType([l.default.bool,l.default.shape({checked:l.default.node,unchecked:l.default.node})])}},8354:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pointerCoord=function(e){if(e){var t=e.changedTouches;if(t&&t.length>0){var s=t[0];return{x:s.clientX,y:s.clientY}}var a=e.pageX;if(void 0!==a)return{x:a,y:e.pageY}}return{x:0,y:0}}},2808:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});var a,n=s(7313),r=(a=n)&&a.__esModule?a:{default:a};t.default=function(){return r.default.createElement("svg",{width:"10",height:"10",viewBox:"0 0 10 10"},r.default.createElement("path",{d:"M9.9 2.12L7.78 0 4.95 2.828 2.12 0 0 2.12l2.83 2.83L0 7.776 2.123 9.9 4.95 7.07 7.78 9.9 9.9 7.776 7.072 4.95 9.9 2.12",fill:"#fff",fillRule:"evenodd"}))}}}]);