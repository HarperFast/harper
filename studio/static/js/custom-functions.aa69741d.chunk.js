"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[442],{3218:(e,t,n)=>{n.r(t),n.d(t,{default:()=>jt});var a=n(7313),s=n(7387),r=n(4122),o=n(5447),l=n(6782),c=n(5399),i=n(238),u=n(3516),d=n(8467),p=n(9842),m=n(1781),h=n(9327),f=n(3672),g=n.n(f),j=n(3262),x=n(9859);const v=async e=>{let{auth:t,url:n}=e;return(0,x.Z)({operation:{operation:"custom_functions_status"},auth:t,url:n,timeout:5e3})},b=async e=>{let{auth:t,url:n}=e;return(0,x.Z)({operation:{operation:"get_custom_functions"},auth:t,url:n})};function y(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e&&e.entries){t===n&&(e.path=n,e.key=crypto.randomUUID());for(const s of e.entries){const e="".concat(t,"/").concat(s.name),[,r]=e.split("/");s.project=r,s.path=e,s.key=crypto.randomUUID(),s.readOnly=a||!!s.package,y(s,e,n,s.readOnly)}}}const N=async e=>{let{auth:t,url:n}=e;const a=await(0,x.Z)({operation:{operation:"get_components"},auth:t,url:n});return y(a,a.name,a.name,!1),a},w=async e=>{let{auth:t,url:n}=e;const{is_enabled:a,port:s,directory:r,error:l,message:c}=await v({auth:t,url:n}),i=await N({auth:t,url:n}),u={is_enabled:a,port:s,endpoints:a?await b({auth:t,url:n}):{},directory:r,error:l,message:c,fileTree:i};return o.Z.update((e=>{e.custom_functions=u})),{custom_functions:u}};var k=n(6417);const C=function(){const e=(0,s.Kw)(o.Z,(e=>e.auth)),t=(0,s.Kw)(o.Z,(e=>e.url)),n=(0,s.Kw)(o.Z,(e=>e.is_local)),r=(0,s.Kw)(o.Z,(e=>{var t;return null===(t=e.custom_functions)||void 0===t?void 0:t.port})),[d,p]=(0,a.useState)({}),[f,v]=(0,a.useState)({port:r||9926});return g()((async()=>{const{submitted:n}=d;if(n){const{port:n}=f;if(n)if((0,j.Z)(n)){const a=await(async e=>{let{auth:t,url:n,port:a}=e;return(0,x.Z)({operation:{operation:"configure_cluster",CUSTOM_FUNCTIONS_PORT:parseInt(a,10)},auth:t,url:n})})({auth:e,url:t,port:n});a.error?p({error:a.message}):w({auth:e,url:t})}else p({error:"port must be a valid number"});else p({error:"All fields are required"})}}),[d]),g()((()=>{d.submitted||p({})}),[f]),n&&!r?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"text-nowrap mb-3",children:"Custom Functions Port"}),(0,k.jsx)(m.Z,{id:"custom_api_port",onChange:e=>v({...f,port:e.target.value}),className:"mb-3 ".concat(d.error&&!f.port?"error":""),type:"number",title:"custom api port",placeholder:"9926",value:f.port}),(0,k.jsx)(h.Z,{color:"success",block:!0,onClick:()=>p({submitted:!0}),children:"Set Custom API Port"}),!!d.error&&(0,k.jsx)(i.Z,{className:"mt-3 error",children:(0,k.jsx)(u.Z,{children:d.error})})]}):(0,k.jsxs)(l.Z,{children:[(0,k.jsxs)(c.Z,{xs:"10",children:["Custom Functions Port ",n?r:"Set"]}),(0,k.jsx)(c.Z,{xs:"2",className:"text-end",children:(0,k.jsx)("i",{className:"fa fa-check-circle fa-lg text-success"})})]})};var Z=n(4431),_=n(8147),S=n(4095);const F=function(e){let{setConfiguring:t}=e;const{compute_stack_id:n}=(0,d.UO)(),r=(0,s.Kw)(o.Z,(e=>e.auth),[n]),l=(0,s.Kw)(o.Z,(e=>e.url),[n]),c=(0,s.Kw)(o.Z,(e=>{var t;return parseFloat(null===(t=e.registration)||void 0===t?void 0:t.version)>=4?"nats":"socketcluster"}),[n]),[i,u]=(0,a.useState)({});return g()((async()=>{if(i.submitted){if("nats"===c)await(0,Z.Z)({auth:r,url:l,customFunctions_enabled:!0});else{const e=await(0,S.Z)({auth:r,url:l});await(0,Z.Z)({auth:r,url:l,operation:"configure_cluster",CUSTOM_FUNCTIONS:!0,CLUSTERING:Boolean(null===e||void 0===e?void 0:e.config_cluster_user),CLUSTERING_PORT:null===e||void 0===e?void 0:e.config_cluster_port,CLUSTERING_USER:null===e||void 0===e?void 0:e.config_cluster_user,NODE_NAME:null===e||void 0===e?void 0:e.nodeName})}window._kmq&&window._kmq.push(["record","enabled custom functions"]),(0,_.Z)({auth:r,url:l}),setTimeout((()=>t(!0)),0)}}),[i.submitted]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("hr",{className:"my-3"}),(0,k.jsx)(h.Z,{color:"success",disabled:i.submitted,block:!0,onClick:()=>u({submitted:!0}),children:i.submitted?(0,k.jsx)("i",{className:"fa fa-spinner fa-spin text-white"}):"Enable Custom Functions"})]})};var P=n(35),O=n(4220),E=n(2261);const D=function(e){let{setConfiguring:t}=e;const{compute_stack_id:n}=(0,d.UO)(),a=(0,s.Kw)(o.Z,(e=>{var t;return null===(t=e.custom_functions)||void 0===t?void 0:t.port}),[n]);return(0,k.jsxs)(l.Z,{id:"functions",children:[(0,k.jsxs)(c.Z,{xl:"3",lg:"4",md:"5",xs:"12",children:[(0,k.jsx)("span",{className:"floating-card-header",children:"enable custom functions"}),(0,k.jsx)(i.Z,{className:"my-3",children:(0,k.jsx)(u.Z,{children:(0,k.jsxs)(p.SV,{onError:(e,t)=>(0,E.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:O.Z,children:[(0,k.jsx)(C,{}),!!a&&(0,k.jsx)(F,{setConfiguring:t})]})})})]}),(0,k.jsx)(c.Z,{xl:"9",lg:"8",md:"7",xs:"12",children:a?(0,k.jsx)(P.Z,{headline:"Enable Custom Functions",description:"Click the button at left to enable Custom Functions. NOTE: We'll restart the instance when you click this button.",icon:(0,k.jsx)("i",{className:"fa fa-thumbs-up text-success"})}):(0,k.jsx)(P.Z,{headline:"Set Your Custom Functions Server Port",description:"If your instance is behind a firewall, you'll need to ensure this port is accessible by other instances if you want to access the API.",icon:(0,k.jsx)("i",{className:"fa fa-thumbs-up text-success"})})})]})};var I=n(6160),R=n(6449);const T=async e=>{let{auth:t,url:n,project:a,file:s}=e;return(0,x.Z)({operation:{operation:"get_component_file",project:a,file:s},auth:t,url:n})},A=async e=>{let{auth:t,url:n,project:a,file:s,payload:r}=e;return(0,x.Z)({operation:{operation:"set_component_file",project:a,file:s,payload:r},auth:t,url:n})},U=async e=>{let{auth:t,url:n,project:a,file:s}=e;return(0,x.Z)({operation:{operation:"drop_component",project:a,file:s},auth:t,url:n})},z=async e=>{let{auth:t,url:n,project:a,packageUrl:s,payload:r}=e;return r?(0,x.Z)({auth:t,url:n,operation:{operation:"deploy_component",project:a,payload:r}}):(0,x.Z)({auth:t,url:n,operation:{operation:"deploy_component",project:a,package:s}})};var K=n(9358),L=n(2190);const W=(0,n(8131).Z)("editorCache");var B=n(6123),q=n.n(B);function M(){return(0,k.jsx)(i.Z,{className:"file-browser-scroll-container",children:(0,k.jsx)(u.Z,{children:(0,k.jsxs)("div",{className:"p-4",children:["You have no HarperDB applications yet. ",(0,k.jsx)("br",{}),(0,k.jsx)("br",{}),'Click "',(0,k.jsx)("i",{className:"fas fa-plus"}),' app" above to create one!',(0,k.jsx)("br",{}),(0,k.jsx)("br",{}),"See the"," ",(0,k.jsx)("a",{className:"docs-link",href:"https://docs.harperdb.io",target:"_blank",rel:"noreferrer",children:"documentation"})," ","for more info on HarperDB Applications."]})})})}function H(e,t){const n=+Boolean(e.entries),a=+Boolean(t.entries);return n===a?e.name.localeCompare(t.name):a-n}const G=e=>Boolean(e.entries);function V(){return(0,k.jsx)("i",{className:q()("package-icon fas fa-cube")})}function Y(e){let{name:t,url:n,onPackageSelect:s,selectedPackage:r}=e;const[o,l]=(0,a.useState)(Boolean(r)&&t===(null===r||void 0===r?void 0:r.name));return(0,a.useEffect)((()=>{l(r&&r.name===t)}),[r,t]),(0,k.jsxs)("button",{type:"button",onClick:e=>{s(o?null:{name:t,url:n,event:e}),l(!o)},className:q()("package",{"package-selected":o}),onKeyDown:()=>{},children:[(0,k.jsx)(V,{}),(0,k.jsx)("span",{className:"package-text",children:t})]})}function $(e){let{directoryEntry:t,selectedFile:n,selectedFolder:a,onFileSelect:s,onFolderSelect:r,Icon:o}=e;const l=G(t),c=t.path===n,i=t.path===(null===a||void 0===a?void 0:a.path);return(0,k.jsxs)("button",{type:"button",onClick:function(e){const n=e.target.classList.contains("rename-file")||e.target.classList.contains("deploy-project");l?i&&n||r(i?null:t):s(c?null:t)},className:q()("file",{"file-selected":c,"folder-selected":i}),onKeyDown:function(){},children:[(0,k.jsx)(o,{className:"filename-icon"}),(0,k.jsx)("span",{className:"filename-text",children:t.name})]})}function J(e){let{directoryEntry:t,userOnSelect:n,onFolderSelect:s,onDeployProject:r,onFileSelect:o,onPackageSelect:l,onFileRename:c,selectedFile:i,selectedFolder:u,selectedPackage:d}=e;const[p,m]=(0,a.useState)(!0),h=[...t.entries||[]].sort(H),f=(g=t.name)&&[...g].includes(".")?g.split(".").slice(-1)[0]:null;var g;let j;return j=2===t.path.split("/").length?()=>(0,k.jsx)("i",{className:q()("project-icon fas fa-file-code")}):t.entries?()=>function(e){let{toggleClosed:t}=e;return(0,k.jsx)("i",{onClick:t,onKeyDown:t,className:q()("folder-icon fas fa-folder-open")})}({isOpen:p,toggleClosed:()=>m(!p)}):()=>function(e){let{extension:t}=e;switch(t){case"js":return(0,k.jsx)("i",{className:q()("file-icon filetype-js fab fa-js")});case"yaml":return(0,k.jsx)("i",{className:q()("file-icon filetype-yaml fas fa-cog")});default:return(0,k.jsx)("i",{className:q()("file-icon filetype-unknown far fa-file-alt")})}}({extension:f}),(0,k.jsxs)(k.Fragment,{children:["components"!==t.name?(0,k.jsx)("li",{className:q()("folder-container"),children:t.package?(0,k.jsx)(Y,{selectedPackage:d,onPackageSelect:l,name:t.name,url:t.package}):(0,k.jsx)($,{Icon:j,selectedFile:i,selectedFolder:u,selectedPackage:d,directoryEntry:t,onDeployProject:r,onFileRename:()=>{c(t)},onFileSelect:o,onFolderSelect:s,userOnSelect:n})},t.key):null,h.map((e=>(0,k.jsx)("li",{children:(0,k.jsx)("ul",{className:q()("folder",{"folder-contents-open":!0,"folder-contents-closed":!1}),children:(0,k.jsx)(J,{selectedFile:i,selectedFolder:u,selectedPackage:d,directoryEntry:e,onFileSelect:o,onDeployProject:r,onFileRename:c,onFolderSelect:s,onPackageSelect:l,userOnSelect:n})})},e.key)))]})}const Q=function(e){var t;let{files:n,userOnSelect:a,onFileSelect:s,onPackageSelect:r,onDeployProject:o,onFileRename:l,onFolderSelect:c,selectedFile:d,selectedFolder:p,selectedPackage:m}=e;return null!==n&&void 0!==n&&null!==(t=n.entries)&&void 0!==t&&t.length?(0,k.jsx)(i.Z,{className:"file-browser-scroll-container",children:(0,k.jsx)(u.Z,{children:(0,k.jsx)("ul",{className:"file-browser",children:(0,k.jsx)(J,{selectedFile:d,selectedFolder:p,selectedPackage:m,onFileSelect:s,onFileRename:l,onFolderSelect:c,onDeployProject:o,onPackageSelect:r,userOnSelect:a,directoryEntry:n})})})}):(0,k.jsx)(M,{})};var X=n(9424);const ee={js:"javascript",yaml:"yaml",ts:"typescript",json:"json",md:"markdown",html:"html",css:"css",graphql:"graphql"};const te=function(e){let{active:t,file:n,onFileChange:s}=e;const[r,o]=(0,a.useState)("javascript");return(0,a.useEffect)((()=>{const e=function(e){var t;const n=null===(t=e||"")||void 0===t?void 0:t.split(".");return n.length>1?n.slice(-1)[0]:""}(null===n||void 0===n?void 0:n.name);o(ee[e]||"plaintext")}),[n]),t?(0,k.jsx)(X.ZP,{height:"100%",language:r,value:(null===n||void 0===n?void 0:n.content)||"",theme:"vs-dark",onChange:s,options:{readOnly:null===n||void 0===n?void 0:n.readOnly,automaticLayout:!0,minimap:{enabled:!1}}}):null};function ne(e){let{onClick:t,disabled:n=!1,text:a="",extraClasses:s=""}=e;return(0,k.jsxs)("button",{type:"button",disabled:n,onClick:t,className:s,title:"Create a new app",children:[(0,k.jsx)("i",{className:"fas fa-plus"}),a&&(0,k.jsxs)("span",{className:"ms-1",children:[" ",a]})]})}function ae(e){let{onClick:t,disabled:n=!1,text:a="",extraClasses:s=""}=e;return(0,k.jsxs)("button",{type:"button",disabled:n,onClick:t,className:s,title:"Add a folder",children:[(0,k.jsx)("i",{className:"fas fa-plus"}),a&&(0,k.jsx)("span",{className:"ms-1 d-none d-lg-inline-block",children:a})]})}function se(e){let{onClick:t,disabled:n=!1,text:a="",extraClasses:s=""}=e;return(0,k.jsxs)("button",{type:"button",onClick:t,disabled:n,className:s,title:"Delete selected app or folder",children:[(0,k.jsx)("i",{className:"fas fa-minus"}),a&&(0,k.jsx)("span",{className:"ms-1 d-none d-lg-inline-block",children:a})]})}function re(e){let{onClick:t,disabled:n,text:a="",extraClasses:s=""}=e;return(0,k.jsxs)("button",{type:"button",disabled:n,onClick:t,className:s,title:"Add a new file",children:[(0,k.jsx)("i",{className:"fas fa-plus"}),a&&(0,k.jsxs)("span",{className:"ms-1 d-none d-lg-inline-block",children:[" ",a]})]})}function oe(e){let{onClick:t,disabled:n,text:a="",extraClasses:s=""}=e;return(0,k.jsxs)("button",{type:"button",onClick:t,disabled:n,className:s,title:"Delete selected file",children:[(0,k.jsx)("i",{className:"fas fa-minus"}),a&&(0,k.jsxs)("span",{className:"ms-1 d-none d-lg-inline-block",children:[" ",a]})]})}const le=function(e){let{children:t}=e;return(0,k.jsx)("ul",{className:"file-menu text-nowrap",children:t.map((e=>e&&(0,k.jsx)("li",{className:"file-menu-item",children:e},crypto.randomUUID())))})};function ce(e){let{onClick:t,disabled:n=!1,text:a="",extraClasses:s=""}=e;return(0,k.jsxs)("button",{type:"button",disabled:n,onClick:t,className:s,title:"Import external component or application",children:[(0,k.jsx)("i",{className:"fas fa-share-alt"}),a&&(0,k.jsx)("span",{className:"ms-2 d-none d-lg-inline-block",children:a})]})}function ie(e){let{onClick:t,savingFile:n,disabled:a=!1,text:s="",extraClasses:r=""}=e;return(0,k.jsxs)("button",{type:"button",onClick:t,disabled:a,className:r,title:"save file to instance",children:[(0,k.jsx)("i",{className:q()("fas",{"fa-save":!n,"fa-spinner":n,"fa-spin":n})}),s&&(0,k.jsx)("span",{className:"ms-2 d-none d-lg-inline-block",children:s})]})}function ue(e){let{onClick:t,restarting:n,disabled:a=!1,text:s="",extraClasses:r=""}=e;return(0,k.jsxs)("button",{type:"button",onClick:t,disabled:a,className:r,title:"Click to restart your instance",children:[(0,k.jsx)("i",{className:q()("fas",{"fa-sync":!n,"fa-spinner":n,"fa-spin":n})}),s&&(0,k.jsx)("span",{className:"ms-2 d-none d-lg-inline-block",children:s})]})}function de(e){let{onClick:t,restartAfterSave:n,disabled:a=!1,text:s="",extraClasses:r=""}=e;return(0,k.jsxs)("button",{type:"button",onClick:t,disabled:a,className:r,title:"Toggle whether saving a file restarts the application",children:[(0,k.jsx)("i",{className:q()("fa",{"fa-toggle-on":n,"fa-toggle-off":!n})}),s&&(0,k.jsx)("span",{className:"ms-2 d-none d-lg-inline-block",children:s})]})}function pe(e){let{onClick:t,disabled:n=!1,text:a="",extraClasses:s="",loading:r}=e;return(0,k.jsxs)("button",{type:"button",disabled:n,onClick:t,className:s,title:"revert file",children:[(0,k.jsx)("i",{className:q()("revert-file fas",{disabled:n,"fa-history":!r,"fa-spinner":r,"fa-spin":r})}),a&&(0,k.jsx)("span",{className:"ms-2 d-none d-lg-inline-block",children:a})]})}function me(e){let{children:t}=e;return(0,k.jsx)("ul",{className:"editor-menu",children:t.map((e=>e&&(0,k.jsx)("li",{className:"editor-menu-item",children:e},crypto.randomUUID())))})}function he(e){let{active:t,AddProjectButtonClick:n,InstallPackageButtonClick:a}=e;return t?(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsx)("h4",{className:"mb-5",children:"Add A New Application"}),(0,k.jsx)(ne,{text:"Create A New Application Using The Default Template",extraClasses:"btn btn-block btn-success",onClick:n}),(0,k.jsx)(ce,{text:"Import Or Deploy A Remote Application Package",extraClasses:"btn btn-block btn-outline-success mt-2",onClick:a})]}):null}function fe(e){let{active:t,type:n}=e;return t?(0,k.jsxs)("div",{className:"content-window text-nowrap",children:[(0,k.jsx)("i",{className:"fa fa-exclamation-triangle mt-5 pt-5"}),"\xa0",(0,k.jsxs)("span",{children:["You have selected a ",n,". Nothing to see here!"]})]}):null}var ge=n(8212);function je(e){return/^[a-zA-Z0-9-_]+$/.test(e)}function xe(e){if(!e)return null;const t={type:null,user:null,repo:null,url:null,package:null,tag:null};if(e.url.match("://"))t.url=e.url,t.type="url";else if(e.url.match("semver:")){const[n,a,s]=e.url.split(/[/#]/);t.type="github",t.user=n,t.repo=a,t.tag=s.replace("semver:","")}else{t.type="npm";const n=e.url.split("/");if(1===n.length){const[e,a]=n[0].split("@");t.package=e,t.tag=a}else if(2===n.length){const[,e]=n,[a,s]=e.split("@");t.package=a,t.tag=s}}return t}function ve(e,t,n){var s=this,r=(0,a.useRef)(null),o=(0,a.useRef)(0),l=(0,a.useRef)(null),c=(0,a.useRef)([]),i=(0,a.useRef)(),u=(0,a.useRef)(),d=(0,a.useRef)(e),p=(0,a.useRef)(!0);d.current=e;var m="undefined"!=typeof window,h=!t&&0!==t&&m;if("function"!=typeof e)throw new TypeError("Expected a function");t=+t||0;var f=!!(n=n||{}).leading,g=!("trailing"in n)||!!n.trailing,j="maxWait"in n,x="debounceOnServer"in n&&!!n.debounceOnServer,v=j?Math.max(+n.maxWait||0,t):null;(0,a.useEffect)((function(){return p.current=!0,function(){p.current=!1}}),[]);var b=(0,a.useMemo)((function(){var e=function(e){var t=c.current,n=i.current;return c.current=i.current=null,o.current=e,u.current=d.current.apply(n,t)},n=function(e,t){h&&cancelAnimationFrame(l.current),l.current=h?requestAnimationFrame(e):setTimeout(e,t)},a=function(e){if(!p.current)return!1;var n=e-r.current;return!r.current||n>=t||n<0||j&&e-o.current>=v},b=function(t){return l.current=null,g&&c.current?e(t):(c.current=i.current=null,u.current)},y=function e(){var s=Date.now();if(a(s))return b(s);if(p.current){var l=t-(s-r.current),c=j?Math.min(l,v-(s-o.current)):l;n(e,c)}},N=function(){if(m||x){var d=Date.now(),h=a(d);if(c.current=[].slice.call(arguments),i.current=s,r.current=d,h){if(!l.current&&p.current)return o.current=r.current,n(y,t),f?e(r.current):u.current;if(j)return n(y,t),e(r.current)}return l.current||n(y,t),u.current}};return N.cancel=function(){l.current&&(h?cancelAnimationFrame(l.current):clearTimeout(l.current)),o.current=0,c.current=r.current=i.current=l.current=null},N.isPending=function(){return!!l.current},N.flush=function(){return l.current?b(Date.now()):u.current},N}),[f,j,t,v,g,h,m,x]);return b}function be(e,t){return e===t}function ye(e,t){return t}function Ne(e,t,n){var s=n&&n.equalityFn||be,r=(0,a.useReducer)(ye,e),o=r[0],l=r[1],c=ve((0,a.useCallback)((function(e){return l(e)}),[l]),t,n),i=(0,a.useRef)(e);return s(i.current,e)||(c(e),i.current=e),[o,c]}function we(e){let{pkg:t,setPackageSpec:n}=e;const[s,r]=(0,a.useState)((null===t||void 0===t?void 0:t.user)||""),[o]=Ne(s,300),[l,c]=(0,a.useState)((null===t||void 0===t?void 0:t.repo)||""),[i]=Ne(l,300),[u,d]=(0,a.useState)([]),[p,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)((null===t||void 0===t?void 0:t.tag)||""),[j,x]=(0,a.useState)(""),[,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{r((null===t||void 0===t?void 0:t.user)||""),c((null===t||void 0===t?void 0:t.repo)||""),d(null!==t&&void 0!==t&&t.tag?[null===t||void 0===t?void 0:t.tag]:[]),g((null===t||void 0===t?void 0:t.tag)||"")}),[t]),(0,a.useEffect)((()=>{o&&i?(v(!0),async function(e,t){try{const n=await fetch("https://api.github.com/repos/".concat(e,"/").concat(t)),a=await n.json();return n.status<400?a.name:null}catch(n){return null}}(s,i).then((e=>{e?(x(e),y(!0),async function(e,t){const n=await fetch("https://api.github.com/repos/".concat(e,"/").concat(t,"/git/refs/tags"));if(n.status<400)return(await n.json()).map((e=>e.ref.split("/").slice(-1)[0]));return[]}(s,i).then((e=>{v(!1),h(!0),d(e)}))):(v(!1),y(!1),x(""),d([]))})).catch((()=>{v(!1)}))):(y(!1),v(!1),d([]),g(""))}),[o,i,s]),(0,a.useEffect)((()=>{if(s&&l&&j){const e=f?"".concat(s,"/").concat(l,"#semver:").concat(f):"".concat(s,"/").concat(l);n(e)}else n("")}),[j,f,s,n,l]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(m.Z,{title:"Github Organization",className:"mt-2 form-control",valid:o.length>0&&i.length>0&&b,placeholder:"Github Organization",onChange:e=>r(e.target.value),value:s}),(0,k.jsx)(m.Z,{title:"Github Repo",className:"mt-2",placeholder:"Github Repo",onChange:e=>c(e.target.value),value:l}),(null===u||void 0===u?void 0:u.length)>0&&(0,k.jsx)(ge.ZP,{className:"react-select-container github-tag-select mt-2",classNamePrefix:"react-select",isDisabled:!j,isSearchable:!0,placeholder:"Choose a tag",onChange:e=>g(e.value),options:u.map((e=>({label:e,value:e})))})]})}function ke(e){let{pkg:t,setPackageSpec:n}=e;const[s,r]=(0,a.useState)(""),[o]=Ne(s,300),[l,c]=(0,a.useState)(""),[i,u]=(0,a.useState)(""),[d,p]=(0,a.useState)(""),[m,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{r((null===t||void 0===t?void 0:t.package)||"")}),[t]),(0,a.useEffect)((function(){if(d){const e=i?"".concat(d,"@").concat(i):d;n(e)}else n("")}),[d,i,n]),(0,a.useEffect)((function(){o?(h(!0),async function(e){var t;const n=await fetch("https://registry.npmjs.org/-/v1/search?text=".concat(e)),a=(await n.json()).objects.find((t=>t.package.name===e));return null===a||void 0===a||null===(t=a.package)||void 0===t?void 0:t.name}(o).then((e=>{h(!1),g(!!e),p(e),e&&async function(e){const t=await fetch("https://registry.npmjs.org/".concat(e));return(await t.json())["dist-tags"]}(e).then((e=>{c(e),u(null)})).catch((e=>{throw e}))})).catch((()=>{h(!1)}))):(p(null),c(null),u(null))}),[o]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"input-group",children:[(0,k.jsx)("input",{className:"mt-2 form-control",title:"enter an npm package specifier",value:s,placeholder:"Enter the [@scope]/package",onChange:function(e){r(e.target.value)}}),(0,k.jsx)("div",{className:"input-group-append",children:(0,k.jsx)("i",{className:q()("input-group-text fa mt-2",{"fa-spinner fa-spin loading":m,"fa-check found":o.length>0&&f,"fa-times not-found":o.length>0&&!(m||f),"fa-check not-searching":0===o.length})})})]}),(0,k.jsx)(ge.ZP,{className:"react-select-container mt-2",classNamePrefix:"react-select",isDisabled:!s,placeholder:"Choose a tag",disabled:!l,onChange:function(e){let{value:t}=e;u(t)},options:Object.entries(l||[]).map((e=>{let[t,n]=e;return{label:"".concat(t," (").concat(n,")"),value:t}}))})]})}function Ce(e){return function(e){try{return Boolean(new URL(e))}catch(t){return!1}}(e)&&(e.endsWith(".tar")||e.endsWith(".tar.gz")||e.endsWith(".tgz"))}function Ze(e){let{pkg:t,setPackageSpec:n}=e;const[s,r]=(0,a.useState)((null===t||void 0===t?void 0:t.url)||""),[o,l]=(0,a.useState)(Ce(null===t||void 0===t?void 0:t.url));return(0,a.useEffect)((()=>{n(o?s:"")}),[s,o,n]),(0,k.jsx)(m.Z,{type:"text",id:"tarball-url",title:"URL to gzipped tarball",className:q()("package-url-input mt-2",{invalid:!o}),value:s,onChange:e=>{l(0===e.target.value.length||Ce(e.target.value)),r(e.target.value)},placeholder:"URL to gzipped tarball"})}var _e=n(511);function Se(e){let{selectedPackage:t,onConfirm:n,onCancel:r,deployTargets:l,active:c}=e;const i=!1,[u,d]=(0,a.useState)(Boolean(t)),[p,f]=(0,a.useState)(xe(t)),[g,j]=(0,a.useState)((null===p||void 0===p?void 0:p.type)||i),[x,v]=(0,a.useState)((null===t||void 0===t?void 0:t.name)||""),[b,y]=(0,a.useState)(!0),[N,w]=(0,a.useState)(""),[C,Z]=(0,a.useState)(!1),_=(0,s.Kw)(o.Z,(e=>e.auth)),S=(0,s.Kw)(o.Z,(e=>e.url)),[F,P]=(0,a.useState)([{isCurrentInstance:!0,auth:_,instance:{url:S,instance_name:"This Instance"}}]);function O(){v(""),y(!1),j(!1),P([]),r()}return(0,a.useEffect)((function(){const e=xe(t);v((null===t||void 0===t?void 0:t.name)||""),f(xe(t)),j((null===e||void 0===e?void 0:e.type)||i),d(Boolean(t))}),[t,i]),(0,a.useEffect)((function(){y(je(x))}),[x]),c?(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsx)("h4",{className:"mb-5",children:"Import Remote App Package"}),(0,k.jsx)(m.Z,{valid:b&&x.length>0,title:"enter a name for this package",value:x,placeholder:"Application Name",onChange:e=>{v(e.target.value),y(je(e.target.value))}}),!_e.Z.is_local_studio&&(0,k.jsx)(ge.ZP,{className:"react-select-container package-install-deploy-targets-dropdown mt-2",classNamePrefix:"react-select",isSearchable:!0,isMulti:!0,placeholder:"Choose your deploy targets",onChange:e=>{const t=e.map((e=>e.value)),n=l.filter((e=>t.includes(e.instance.url)));P(n)},options:l.map((e=>({label:e.instance.instance_name,value:e.instance.url})))}),(0,k.jsx)(ge.ZP,{className:"react-select-container mt-2",classNamePrefix:"react-select",placeholder:"How would you like to fetch this package?",onChange:function(e){let{value:t}=e;j(t)},options:[{label:"A Public GitHub Repo",value:"github"},{label:"Install a gzipped .tar file from a URL",value:"url"}]}),!b&&x.length>0&&(0,k.jsxs)("span",{className:"text-danger text-center mt-3",children:[(0,k.jsx)("i",{className:"fa fa-exclamation-triangle"}),(0,k.jsx)("br",{}),(0,k.jsx)("span",{className:"mt-2",children:"Project name limited to alphanumeric, dashes, & underscores."})]}),b&&F.length>0&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"mt-2"}),"npm"===g&&(0,k.jsx)(ke,{projectName:x,installed:u,pkg:p,setPackageSpec:w}),"github"===g&&(0,k.jsx)(we,{projectName:x,installed:u,pkg:p,setPackageSpec:w}),"url"===g&&(0,k.jsx)(Ze,{projectName:x,installed:u,pkg:p,setPackageSpec:w})]}),b&&F.length>0&&g?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(h.Z,{onClick:async()=>{Z(!0);try{await n(x,N,F)}catch(e){Z(!1)}Z(!1)},className:q()("btn btn-block btn-success mt-3",{loading:C}),disabled:!je(x)||!N||!F.length,children:C?(0,k.jsx)("i",{className:"install-package-status-icon fa fa-spinner fa-spin"}):"Install Package"}),(0,k.jsx)(h.Z,{onClick:O,className:"btn btn-block btn-outline-success mt-2",children:"Cancel"})]}):(0,k.jsx)(h.Z,{onClick:O,className:"btn btn-block btn-outline-success mt-3",children:"Cancel"})]}):null}function Fe(e){let{className:t,onClick:n,disabled:s,children:r}=e;const[o,l]=(0,a.useState)(!1);return(0,k.jsx)("button",{disabled:s,type:"button",onClick:async()=>{l(!0);try{await n(),l(!1)}catch(e){l(!1)}},className:q()("".concat(t," button-with-loader"),{loading:o}),children:o?(0,k.jsx)("i",{className:"button-with-loader-icon fas fa-spinner fa-spin"}):r})}function Pe(e){let{onCancel:t,onConfirm:n,onEnter:s,value:r,type:o,validate:l=(()=>!0)}=e;const[c,i]=(0,a.useState)(r||""),[u,d]=(0,a.useState)(!1);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("input",{className:q()("w-100 text-center",{invalid:c.length>0&&!u}),autoFocus:!0,onChange:e=>{i(e.target.value),d(l(e.target.value))},onKeyDown:function(e){"Enter"===e.key?s(e.target.value):"Esc"===e.key&&t()},value:c,placeholder:"name for your new ".concat(o),title:"name for your new ".concat(o)}),(0,k.jsx)("i",{title:"error: name must contain only alphanumeric characters, dashes and underscores.",className:q()("text-danger fa fa-warning",{hidden:u||0===c.length})}),(0,k.jsx)(Fe,{disabled:!u,className:"btn btn-success btn-block mt-3",onClick:()=>n(c),children:"OK"}),(0,k.jsx)("button",{type:"button",className:"btn btn-outline-success btn-block mt-2",onClick:t,children:"Cancel"}),c.length>0&&!u&&(0,k.jsx)("div",{className:"validation-message mt-5",children:"error: name must contain only alphanumeric characters, dashes and underscores."})]})}function Oe(e){let{active:t,onConfirm:n,onCancel:a}=e;return t?(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsx)("h4",{className:"mb-5",children:"Default Template Application"}),(0,k.jsx)(Pe,{type:"project",validate:je,onEnter:n,onConfirm:n,onCancel:a})]}):null}function Ee(e){let{active:t,onConfirm:n,onCancel:a,selectedFolder:s}=e;return t?(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsxs)("h4",{className:"mb-5",children:["Add Folder To ",(0,k.jsx)("span",{className:"text-success",children:s.path.replace("components","")})]}),(0,k.jsx)(Pe,{type:"folder",selectedFolder:s,onEnter:n,onConfirm:n,onCancel:a})]}):null}function De(e){let{active:t,onConfirm:n,onCancel:a}=e;return t?(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsx)("h4",{className:"mb-5",children:"Add A New File"}),(0,k.jsx)(Pe,{type:"file",onEnter:n,onConfirm:n,onCancel:a})]}):null}function Ie(e){let{active:t,selectedFile:n,onConfirm:a,onCancel:s}=e;if(!t)return null;const{path:r}=n,o=r.split("/"),l=o.pop(),c=o.slice(1);return(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsxs)("h4",{className:"mb-5",children:["Delete ",(0,k.jsx)("span",{className:"text-danger",children:l})," File"]}),(0,k.jsx)(Fe,{className:"btn btn-danger btn-block delete-button mt-2",onClick:a,children:"Delete"}),(0,k.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-block mt-2",onClick:s,children:"Cancel"}),(0,k.jsxs)("div",{className:"mt-5",children:["Are you sure you want to delete ",(0,k.jsx)("span",{className:"text-danger",children:l})," from ",(0,k.jsx)("span",{className:"text-danger",children:c.join("/")}),"?"]})]})}function Re(e){let{active:t,selectedFolder:n,onConfirm:a,onCancel:s}=e;if(!t)return null;if(!n)return null;const r=n.path.split("/"),o=2===r.length,l=o?null:r.slice(-1)[0];return(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsxs)("h4",{className:"mb-5",children:["Delete ",(0,k.jsx)("span",{className:"text-danger",children:o?null===n||void 0===n?void 0:n.project:l})," ",o?"Project":"Folder"]}),(0,k.jsx)(Fe,{className:"btn btn-danger btn-block delete-button mt-2",onClick:a,children:"Delete"}),(0,k.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-block mt-2",onClick:s,children:"Cancel"}),(0,k.jsx)("div",{className:"mt-5",children:o?(0,k.jsxs)("div",{children:["Are you sure you want to delete project ",(0,k.jsx)("span",{className:"text-danger",children:null===n||void 0===n?void 0:n.project})," ?"]}):(0,k.jsxs)("div",{children:["Are you sure you want to delete the folder ",(0,k.jsx)("span",{className:"text-danger",children:l})," from ",(0,k.jsx)("span",{className:"text-danger",children:null===n||void 0===n?void 0:n.project}),"?"]})})]})}function Te(e){let{active:t,selectedPackage:n,onConfirm:a,onCancel:s}=e;if(!t)return null;const r=n.name;return(0,k.jsxs)("div",{className:"content-window",children:[(0,k.jsxs)("h4",{className:"mb-5",children:["Delete ",(0,k.jsx)("span",{className:"text-danger",children:r})," Package"]}),(0,k.jsx)(Fe,{className:"btn btn-danger btn-block delete-button mt-2",onClick:a,children:"Delete"}),(0,k.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-block mt-2",onClick:s,children:"Cancel"}),(0,k.jsxs)("div",{className:"mt-5",children:["Are you sure you want to delete ",(0,k.jsx)("span",{className:"text-danger",children:r}),"?"]})]})}const Ae="DEFAULT_WINDOW",Ue="DEFAULT_FOLDER_WINDOW",ze="CODE_EDITOR_WINDOW",Ke="NAME_FILE_WINDOW",Le="NAME_PROJECT_WINDOW",We="NAME_PROJECT_FOLDER_WINDOW",Be="INSTALL_PACKAGE_WINDOW",qe="DELETE_FILE_WINDOW",Me="DELETE_FOLDER_WINDOW",He="DELETE_PACKAGE_WINDOW";function Ge(e){let{children:t}=e;return(0,k.jsx)(i.Z,{className:"editor-window",children:(0,k.jsx)(u.Z,{children:t})})}const Ve=function(e){var t,n,s,r;let{deployTargets:o,fileTree:i,onFileSave:u,onAddFile:d,onRevertFile:p,onAddProjectFolder:m,onAddProject:h,onFileChange:f,onDeleteFolder:g,onDeleteFile:j,onDeletePackage:x,onDeployProject:v,onFileSelect:b,onFileRename:y,onFolderRename:N,onInstallPackage:w,onUpdate:C,restartInstance:Z,restartingInstance:_,refreshCustomFunctions:S}=e;const[F,P]=(0,a.useState)(null),[O,E]=(0,a.useState)(null),[D,I]=(0,a.useState)(null),[R,T]=(0,a.useState)(Ae),[A,U]=(0,a.useState)(null),[z,K]=(0,a.useState)(!0),[L,W]=(0,a.useState)(!1),[B,q]=(0,a.useState)(!1),M=(null===i||void 0===i||null===(t=i.entries)||void 0===t?void 0:t.length)>0,H=Boolean(M&&F),G=Boolean(M&&(F||D)),V=Boolean(F);function Y(e,t){T(e),U(t)}function $(){I(null),P(null),E(null)}function J(){Y(Ae,R)}return(0,k.jsxs)(l.Z,{id:"webide",children:[(0,k.jsxs)(c.Z,{md:"4",xl:"3",className:"file-browser-outer-container mb-3",children:[(0,k.jsx)("div",{className:"floating-card-header-row",children:(0,k.jsxs)(le,{children:[(0,k.jsx)(ne,{onClick:()=>Y(Ae,R),text:"app"}),(V||G)&&(0,k.jsx)("span",{className:"px-1",children:"|"}),V&&(0,k.jsx)(ae,{disabled:!V,onClick:()=>Y(We,R),text:!G&&"folder"}),G&&(0,k.jsx)(se,{disabled:!G,onClick:()=>{D?Y(He,R):F&&Y(Me,R)},text:"folder"}),(H||(null===O||void 0===O?void 0:O.path))&&(0,k.jsx)("span",{className:"px-1",children:"|"}),H&&(0,k.jsx)(re,{onClick:()=>Y(Ke,R),disabled:!H,text:!(null!==O&&void 0!==O&&O.path)&&"file"}),(null===O||void 0===O?void 0:O.path)&&(0,k.jsx)(oe,{disabled:!(null!==O&&void 0!==O&&O.path),onClick:()=>Y(qe,R),text:!H&&"file"})]})}),(0,k.jsx)(Q,{files:i,root:i.path,selectedFile:null===O||void 0===O?void 0:O.path,selectedFolder:F,selectedPackage:D,onDeployProject:v,onFolderSelect:e=>{$(),P(e),Y(e?Ue:Ae,R)},onPackageSelect:e=>{$(),I(e),Y(e?Ue:Ae,R)},onFileSelect:async e=>{const t=!e;if($(),t)E(null),Y(Ae,R);else{const t=await b(e),{content:n,cached:a}=t;E({...e,content:n,cached:a}),Y(ze,R)}}})]}),(0,k.jsxs)(c.Z,{md:"8",xl:"9",className:"editor-window-container",children:[(0,k.jsxs)(l.Z,{className:"floating-card-header-row g-0",children:[(0,k.jsx)(c.Z,{className:"text-nowrap",children:O&&(0,k.jsxs)(k.Fragment,{children:[null===O||void 0===O||null===(n=O.path)||void 0===n||null===(s=n.split("/"))||void 0===s||null===(r=s.slice(1))||void 0===r?void 0:r.join(" > ")," ",(0,k.jsxs)("span",{className:"text-grey d-none d-xl-inline-block",children:["| ",(null===O||void 0===O?void 0:O.size)||"..."," bytes | ",null!==O&&void 0!==O&&O.mtime?new Date(O.mtime).toLocaleTimeString():"..."]})]})}),(0,k.jsx)(c.Z,{className:"text-nowrap",children:(0,k.jsxs)(me,{children:[(0,k.jsx)(ie,{savingFile:B,disabled:!(null!==O&&void 0!==O&&O.cached&&R===ze),onClick:async()=>{q(!0),await u(O,z),q(!1)},text:"save"}),(0,k.jsx)(pe,{loading:L,disabled:!(null!==O&&void 0!==O&&O.cached&&R===ze),onClick:async()=>{W(!0);try{const e=await p(O),t={...O,content:e,cached:!1};E(t)}finally{W(!1)}},text:"revert"}),(0,k.jsx)("span",{className:"px-1",children:"|"}),(0,k.jsx)(ue,{restarting:_,onClick:Z,text:"restart"}),(0,k.jsx)(de,{restartAfterSave:z,onClick:()=>K(!z),text:"auto"})]})})]}),(0,k.jsxs)(Ge,{children:[(0,k.jsx)(he,{fileTree:i,active:R===Ae,AddProjectButtonClick:()=>Y(Le,R),InstallPackageButtonClick:()=>{I(null),Y(Be,R)}}),(0,k.jsx)(fe,{active:R===Ue,type:D?"package":F?"folder":"nothing"}),(0,k.jsx)(Oe,{active:R===Le,onConfirm:async function(e){await h(e),Y(A,R)},onCancel:J}),(0,k.jsx)(Ee,{projectName:null===F||void 0===F?void 0:F.project,active:R===We,selectedFolder:F,onConfirm:async function(e){await m(e,F),Y(A,R)},onCancel:J}),(0,k.jsx)(De,{active:R===Ke,onConfirm:async function(e){const t=await d(e,F);E(t),Y(ze,R)},onCancel:J}),(0,k.jsx)(Se,{active:R===Be,onConfirm:async function(e,t,n){await w(e,t,n),I(null),Y(Ae,R)},onCancel:J,deployTargets:o,selectedPackage:D}),(0,k.jsx)(Te,{active:R===He,selectedPackage:D,onConfirm:async()=>{await x(D),Y(Ae,R),$()},onCancel:J}),(0,k.jsx)(Re,{active:R===Me,selectedFolder:F,onConfirm:async()=>{await g(F),Y(Ae,R),$()},onCancel:J}),(0,k.jsx)(Ie,{active:R===qe,selectedFile:O,onConfirm:async()=>{await j(O),Y(Ae,R),$()},onCancel:J}),(0,k.jsx)(te,{active:R===ze,file:O,onFileChange:async e=>{!function(e){const t={...O,content:e};E(t)}(e),await f({path:null===O||void 0===O?void 0:O.path,content:e}),E({...O,content:e,cached:!0})}})]})]})]})},Ye=async e=>{let{auth:t,url:n,function_content:a,project:s,type:r,file:o}=e;return(0,x.Z)({operation:{operation:"set_custom_function",function_content:a,project:s,type:r,file:o},auth:t,url:n})},$e={routes:"'use strict';\n\n/* Dependencies\n- import any packages that are listed in your projects package.json\n- for example:\nimport needle from 'needle'\n*/\n\n/* Helpers\n- import any helper methods from your project's \"helpers\" directory\n- for example:\nimport filter from '../helpers/filter.js';\n*/\n\nmodule.exports = async (server, { hdbCore, logger }) => {\n  // POST route\n  // with hdbCore.preValidation to process basic auth\n  // uses hdbCore.requese to execute the validated request\n  server.route({\n    url: '/path/to/my/route',\n    method: 'POST',\n    preValidation: hdbCore.preValidation,\n    handler: hdbCore.request,\n  })\n\n  // GET route\n  // with custom validation\n  // uses hdbCore.requestWithoutAuthentication\n  server.route({\n    url: '/path/to/my/route/:id',\n    method: 'GET',\n    preValidation: async (request, reply) => {\n      const token = request.headers.authorization\n      const results = hdbCore.requestWithoutAuthentication({\n        body: {\n          operation: 'search_by_hash',\n          schema: 'auth',\n          table: 'tokens',\n          hash_values: [token],\n          get_attributes: ['id']\n        }\n      })\n      if (!results.length) {\n        const errorString = result.body.error || 'Sorry, there was an error authenticating your request';\n        logger.error(errorString);\n        throw new Error(errorString);\n      }\n    },\n    handler: async (request) => {\n      const id = parseInt(request.params.id)\n      request.body= {\n        operation: 'sql',\n        sql: `SELECT * FROM dev.dogs WHERE id = ${id}`\n      };\n\n      /*\n       * requestWithoutAuthentication bypasses the standard HarperDB authentication.\n       * YOU MUST ADD YOUR OWN preValidation method above, or this method will be available to anyone.\n       */\n      const result = await hdbCore.requestWithoutAuthentication(request);\n\n      return result\n    }\n  });\n};\n",helpers:"\n/* filters the results, only returning the selected keys */\nexport default (result, keys) => {\n  return result.map(r => {\n    const f = {}\n    keys.forEach(k => f[k] = r[k])\n    return f;\n  })\n}\n"};var Je=n(3517);const Qe=function(e){let{items:t,toggleDropItem:n,toggleCreate:r,baseUrl:i,restarting:u,itemType:p,project:f}=e;const g=(0,d.s0)(),j=(0,I.VY)(),v=(0,s.Kw)(o.Z,(e=>e.auth)),b=(0,s.Kw)(o.Z,(e=>e.url)),[y,N]=(0,a.useState)(!1),[C,Z]=(0,a.useState)(!1),[_,S]=(0,a.useState)(!1),F=async e=>{e.preventDefault();let n,a=!1;if(y&&!t.includes(y)||(Z(!0),a=!0),y&&!(0,Je.Z)(y)&&(Z(!0),a=!0,j.error("".concat("projects"===p?"Project":"File"," names may only contain letters, numbers, hyphens, or underscores."))),a)return!1;if(S(!0),"projects"===p)n=await(async e=>{let{auth:t,url:n,project:a}=e;return(0,x.Z)({operation:{operation:"add_custom_function_project",project:a},auth:t,url:n})})({auth:v,url:b,project:y});else{const e=(e=>$e[e]||null)(p);n=await Ye({auth:v,url:b,project:f,type:p,file:y,function_content:e})}return n.error?(S(!1),r(!1),j.error(n.message)):setTimeout((async()=>(await(0,K.Z)({auth:v,url:b,service:"custom_functions"}),await w({auth:v,url:b}),g("".concat(i,"/").concat(y)))),500)};return(0,a.useEffect)((()=>{n()}),[n]),(0,a.useEffect)((()=>{y&&t.find((e=>e===y))&&g("".concat(i,"/").concat(y))}),[t]),(0,k.jsxs)(l.Z,{className:"item-row form",children:[(0,k.jsx)(c.Z,{className:"input-holder",children:(0,k.jsx)(m.Z,{id:"name",invalid:C,onChange:e=>{Z(!1),N(e.target.value)},value:y||"",disabled:_,type:"text",name:"name",placeholder:"projects"===p?"ex: api, api-v1, dogs":"routes"===p?"ex: v1, post, public":"ex: filter, auth, queries"})}),(0,k.jsx)(c.Z,{className:"item-action",children:_?(0,k.jsx)(h.Z,{color:"success",className:"round me-1",children:(0,k.jsx)("i",{className:"fa fa-spinner fa-spin text-white"})}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(h.Z,{id:"createItem",color:"success",className:"round me-1",disabled:u,onClick:F,onKeyDown:e=>13!==e.keyCode||F(e),children:(0,k.jsx)("i",{className:"fa fa-check text-white"})}),(0,k.jsx)(h.Z,{id:"toggleCreate",color:"black",className:"round",onClick:()=>r(!1),children:(0,k.jsx)("i",{className:"fa fa-times text-white"})})]})})]})},Xe=async e=>{let{auth:t,url:n,project:a}=e;return(0,x.Z)({operation:{operation:"drop_custom_function_project",project:a},auth:t,url:n})};const et=function(e){let{item:t,baseUrl:n,isActive:r,toggleDropItem:i,isDropping:u,itemType:p,restarting:m}=e;const{project:f}=(0,d.UO)(),g=(0,d.s0)(),j=(0,I.VY)(),[v,b]=(0,a.useState)(!1),[y,N]=(0,a.useState)(!1),C=(0,s.Kw)(o.Z,(e=>e.auth)),Z=(0,s.Kw)(o.Z,(e=>e.url)),_=async()=>{if(!v)return!1;let e;return e="projects"===p?await Xe({auth:C,url:Z,project:t}):await(async e=>{let{auth:t,url:n,project:a,type:s,file:r}=e;return(0,x.Z)({operation:{operation:"drop_custom_function",project:a,type:s,file:r},auth:t,url:n})})({auth:C,url:Z,project:f,type:p,file:t}),e.error?(b(!1),N(!1),j.error(e.message)):(j.success(e.message),(0,K.Z)({auth:C,url:Z,service:"custom_functions"}),await w({auth:C,url:Z}),g(n))};return(0,k.jsxs)(l.Z,{title:"View".concat(r?"ing":""," ").concat(t),className:"item-row ".concat(r?"active":""),onClick:m?null:()=>!(r||u||v)&&g("".concat(n,"/").concat(t)),tabIndex:"0",children:[(0,k.jsx)(c.Z,{className:"item-label ".concat(v?"text-danger text-nowrap":""),children:v?"drop ".concat(t,"?"):"projects"===p?"/".concat(t):t}),(0,k.jsx)(c.Z,{className:"item-action",children:y?(0,k.jsx)(h.Z,{tabIndex:"-1",disabled:!0,color:"purple",className:"round",children:(0,k.jsx)("i",{className:"fa fa-spinner fa-spin"})}):v?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(h.Z,{id:"confirmDropItem",color:"danger",className:"round me-1",title:"confirm drop ".concat(t),onClick:()=>{b(!1),N(!0),_()},children:(0,k.jsx)("i",{className:"fa fa-check text-white"})}),(0,k.jsx)(h.Z,{id:"cancelDropItem",color:"black",className:"round",title:"Cancel drop ".concat(t),onClick:()=>{b(!1)},children:(0,k.jsx)("i",{className:"fa fa-times text-white"})})]}):u?(0,k.jsx)(h.Z,{id:"dropItem",color:"danger",className:"round",title:"Drop ".concat(t),onClick:()=>{b(t),i(!1)},children:(0,k.jsx)("i",{className:"fa fa-minus text-white"})}):r?(0,k.jsx)(h.Z,{tabIndex:"-1",color:"purple",className:"round",children:(0,k.jsx)("i",{className:"fa fa-chevron-right"})}):null})]},t)};const tt=function(e){let{items:t,toggleDropItem:n,isDropping:a,toggleCreate:s,project:r,isCreating:o,restarting:i,itemType:u,showForm:d}=e;return(0,k.jsxs)(l.Z,{className:"floating-card-header",children:[(0,k.jsx)(c.Z,{children:"projects"===u?"projects":"/".concat(r,"/").concat(u)}),d&&null!==t&&void 0!==t&&t.length?(0,k.jsxs)(c.Z,{className:"text-end",children:[(0,k.jsx)(h.Z,{disabled:i,id:"toggleRemove",color:"link",title:"Remove Functions",className:"add-remove me-3",onClick:()=>{n(!a),s(!1)},children:(0,k.jsx)("i",{className:"fa fa-minus"})}),(0,k.jsx)(h.Z,{disabled:i,id:"toggleCreate",color:"link",title:"Add Function",className:"add-remove me-1",onClick:()=>{s(!o),n(!1)},children:(0,k.jsx)("i",{className:"fa fa-plus"})})]}):null]})};const nt=function(e){let{items:t,activeItem:n,baseUrl:s,restarting:r,itemType:o,project:l,showForm:c}=e;const[d,p]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{h(),p()}),[n,t.length]),(0,k.jsxs)("div",{className:"entity-manager",children:[(0,k.jsx)(tt,{items:t,itemType:o,isDropping:d,toggleDropItem:p,isCreating:m,toggleCreate:h,restarting:r,project:l,showForm:c}),(0,k.jsxs)(i.Z,{className:"my-3",children:[t&&t.length?(0,k.jsx)(u.Z,{className:"scrollable ".concat(m?"creating":""),children:t.map((e=>(0,k.jsx)(et,{item:e,baseUrl:s,isActive:n===e,isDropping:d,toggleDropItem:p,itemType:o,restarting:r},e)))}):null,c&&t&&!t.length||m?(0,k.jsx)(u.Z,{children:(0,k.jsx)(Qe,{items:t,itemType:o,baseUrl:s,isDropping:d,toggleDropItem:p,isCreating:m,toggleCreate:h,restarting:r,project:l})}):!t||t.length||m?null:(0,k.jsx)(u.Z,{children:(0,k.jsx)("div",{className:"py-3 text-center no-content",children:"no functions found"})})]})]})};const at=function(){const e=(0,d.s0)(),t=(0,I.VY)(),{customer_id:n,compute_stack_id:r,project:p,type:m,file:f}=(0,d.UO)(),g=(0,s.Kw)(o.Z,(e=>e.auth)),j=(0,s.Kw)(o.Z,(e=>e.url)),[v,b]=(0,a.useState)(""),[y,N]=(0,a.useState)(""),w=(0,a.useCallback)((async()=>{if(p&&m&&f&&"undefined"!==f){const e=await(async e=>{let{auth:t,url:n,project:a,type:s,file:r}=e;return(0,x.Z)({operation:{operation:"get_custom_function",project:a,type:s,file:r},auth:t,url:n})})({auth:g,url:j,project:p,type:m,file:f});b(null===e||void 0===e?void 0:e.message),N(null===e||void 0===e?void 0:e.message)}else b("")}),[g,j,p,m,f,b]);return(0,a.useEffect)((()=>{w()}),[p,f,w,r]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l.Z,{className:"floating-card-header",children:[(0,k.jsxs)(c.Z,{children:["edit >\xa0",(0,k.jsxs)("i",{children:["/",p,f&&"undefined"!==f&&"/".concat(m,"/").concat(f,".js")]})]}),(0,k.jsxs)(c.Z,{className:"text-end",children:[(0,k.jsxs)(h.Z,{onClick:w,color:"link",className:"me-2",children:[(0,k.jsx)("span",{className:"me-2",children:"reload"}),(0,k.jsx)("i",{title:"Reload File",className:"fa fa-sync-alt"})]}),(0,k.jsx)("span",{className:"mx-3 text",children:"|"}),(0,k.jsxs)(h.Z,{onClick:()=>e("/o/".concat(n,"/i/").concat(r,"/functions/deploy/").concat(p)),color:"link",className:"me-2",children:[(0,k.jsx)("span",{className:"me-2",children:"deploy"}),(0,k.jsx)("i",{title:"Deploy Project",className:"fa fa-share"})]})]})]}),(0,k.jsx)(i.Z,{className:"my-3",children:v?(0,k.jsxs)(u.Z,{children:[(0,k.jsx)("div",{className:"code-editor-holder",children:(0,k.jsx)(X.ZP,{height:"100%",defaultLanguage:"javascript",value:v,theme:"vs-dark",onChange:b})}),(0,k.jsxs)(l.Z,{children:[(0,k.jsx)(c.Z,{md:"6",className:"mt-2",children:(0,k.jsx)(h.Z,{block:!0,color:"grey",title:"Revert Code to Last Saved State",disabled:v===y,onClick:w,id:"reset",children:(0,k.jsx)("i",{className:"fa fa-undo"})})}),(0,k.jsx)(c.Z,{md:"6",className:"mt-2",children:(0,k.jsx)(h.Z,{block:!0,title:"Save Code to Instance",color:"success",id:"addEditItem",onClick:async()=>{const e=await Ye({auth:g,url:j,function_content:v,project:p,type:m,file:f});e.error?t.error(e.message):(setTimeout((()=>(0,K.Z)({auth:g,url:j,service:"custom_functions"})),500),t.success(e.message)),w()},children:(0,k.jsx)("i",{className:"fa fa-save"})})})]})]}):(0,k.jsx)(u.Z,{children:(0,k.jsxs)("div",{className:"empty-prompt narrow",children:[(0,k.jsx)("div",{className:"mt-3 text-bold",children:"This project does not yet have any routes or helpers"}),(0,k.jsx)("div",{className:"mt-3",children:"Add some using the form fields at left."})]})})})]})};var st=n(6855);const rt=e=>{let{initializing:t,loading:n,handleClick:a}=e;return[{Header:"instance name",accessor:"instance_name"},{Header:"instance url",accessor:"url"},{Header:"cf capable",id:"hdb-narrow-cfcapable",Cell:e=>{let{row:{original:{custom_functions_status:t}}}=e;return t.error?"no":"yes"}},{Header:"cf enabled",id:"hdb-narrow-cfenabled",Cell:e=>{let{row:{original:{custom_functions_status:t}}}=e;return t.is_enabled?"yes":"no"}},{Header:"has project",id:"hdb-narrow-cfhasproject",Cell:e=>{let{row:{original:{has_current_project:t}}}=e;return t?"yes":"no"}},{Header:"deploy",id:"hdb-narrow-deploy",Cell:e=>{let{row:{original:{compute_stack_id:s,custom_functions_status:r,has_auth:o}}}=e;return r.is_enabled&&o?(0,k.jsx)(h.Z,{color:"success",block:!0,size:"sm",disabled:t||n[s],onClick:()=>a(s,"deploy"),children:(0,k.jsx)("i",{className:"fa ".concat("deploy"===n[s]?"fa-spinner fa-spin":"fa-share")})}):null}},{Header:"remove",id:"hdb-narrow-remove",Cell:e=>{let{row:{original:{compute_stack_id:t,custom_functions_status:s,has_current_project:r,has_auth:o}}}=e;return s.is_enabled&&r&&o?(0,k.jsx)(h.Z,{color:"danger",block:!0,size:"sm",disabled:n[t],onClick:()=>a(t,"drop"),children:(0,k.jsx)("i",{className:"fa ".concat("drop"===n[t]?"fa-spinner fa-spin":"fa-trash")})}):null}}]},ot={filtered:[],sorted:[],page:0,totalPages:1,pageSize:20,autoRefresh:!1,showFilter:!1,lastUpdate:!1};const lt=function(){const{customer_id:e,compute_stack_id:t,project:n}=(0,d.UO)(),r=(0,d.s0)(),[p]=(0,L.Z)({}),m=(0,s.Kw)(o.Z,(e=>e.auth)),f=(0,s.Kw)(o.Z,(e=>e.url)),j=(0,s.Kw)(o.Z,(e=>{var t;return null===(t=e.registration)||void 0===t?void 0:t.version})),[{payload:y,file:N},w]=(0,a.useState)([]),C="/o/".concat(e,"/i/").concat(t,"/functions/edit/").concat(n),Z=(0,s.Kw)(R.Z,(e=>e.instances.filter((e=>e.compute_stack_id!==t)))),[_,S]=j.split("."),F=_>=3&&(_>3||S>=3),[P,O]=(0,a.useState)([]),[E,D]=(0,a.useState)(F),[I,T]=(0,a.useReducer)(((e,t)=>({...e,...t})),{}),[A,U]=(0,a.useState)(ot),z=(0,a.useCallback)((()=>r(C)),[r,C]),W=(0,a.useCallback)((async(e,t)=>{const a=P.find((t=>t.compute_stack_id===e)),s=p[e];if(a&&s){T({[e]:t});let r=!1;const o=await v({auth:s,url:a.url});if(!o.error){const e=await b({auth:s,url:a.url});r=Object.keys(e).includes(n)}const l=P.map((t=>(t.compute_stack_id===e&&(t.custom_functions_status=o,t.has_current_project=r),t)));O(l),T({[e]:null})}}),[p,n,P]),B=(0,a.useCallback)((async(e,t)=>{const a=P.find((t=>t.compute_stack_id===e)),s=p[e];a&&s&&(T({[e]:t}),"deploy"===t?(await(async e=>{let{auth:t,url:n,project:a,payload:s,file:r}=e;return(0,x.Z)({operation:{operation:"deploy_custom_function_project",project:a,payload:s,file:r},auth:t,url:n})})({auth:s,url:a.url,payload:y,project:n,file:N}),E&&await(async e=>{let{auth:t,url:n,projects:a,dry_run:s=!1}=e;return(0,x.Z)({operation:{operation:"install_node_modules",projects:a,dry_run:s},auth:t,url:n})})({auth:s,url:a.url,projects:[n]}),await(0,K.Z)({auth:s,url:a.url,service:"custom_functions"})):await Xe({auth:s,url:a.url,project:n}),setTimeout((()=>{T({[e]:!1}),W(e,t)}),1e3))}),[N,p,y,n,P,W,E]);return g()((async()=>{if(m&&f&&n){w(!1);const e=await(async e=>{let{auth:t,url:n,project:a,skip_node_modules:s}=e;return(0,x.Z)({operation:{operation:"package_custom_function_project",project:a,skip_node_modules:s},auth:t,url:n})})({auth:m,url:f,project:n,skip_node_modules:E});w(e)}}),[m,f,n,E]),g()((async()=>{if(Z){const e=await Promise.all(Z.map((async e=>{const t=p[e.compute_stack_id];let a={};if(t){const s=await v({auth:t,url:e.url});return s.error||(a=await b({auth:t,url:e.url})),{...e,custom_functions_status:s,has_auth:!0,has_current_project:Object.keys(a).includes(n)}}return{...e,custom_functions_status:!1}})));O(e)}}),[Z,n]),(0,a.useEffect)((()=>{U({...A,totalPages:Math.ceil((P.length||A.pageSize)/A.pageSize)})}),[U,A.pageSize]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l.Z,{className:"floating-card-header",children:[(0,k.jsxs)(c.Z,{children:["deploy ",n&&"> ".concat(n)]}),(0,k.jsxs)(c.Z,{className:"text-end",children:[F&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(h.Z,{color:"link",title:"Turn on autofresh",onClick:()=>D(!E),children:[(0,k.jsx)("span",{className:"me-2",children:"install dependencies at destination"}),(0,k.jsx)("i",{className:"fa fa-lg fa-toggle-".concat(E?"on":"off")})]}),(0,k.jsx)("span",{className:"mx-3 text",children:"|"})]}),(0,k.jsxs)(h.Z,{onClick:z,color:"link",className:"me-2",children:[(0,k.jsx)("span",{className:"me-2",children:"back to edit"}),(0,k.jsx)("i",{title:"Edit Project",className:"fa fa-edit"})]})]})]}),(0,k.jsx)(i.Z,{className:"my-3",children:(0,k.jsx)(u.Z,{className:"react-table-holder",children:P.length?(0,k.jsx)(st.Z,{columns:rt({initializing:!y,loading:I,handleClick:B}),data:P,page:A.page,pageSize:A.pageSize,totalPages:A.totalPages,showFilter:A.showFilter,sorted:A.sorted,onFilteredChange:e=>U({...A,filtered:e}),onSortedChange:e=>U({...A,sorted:e}),onPageChange:e=>U({...A,pageSize:e}),onPageSizeChange:e=>U({...A,page:0,pageSize:e})}):(0,k.jsx)("div",{className:"empty-prompt",children:"Please register at least one Custom Function-enabled instance to deploy to"})})})]})};const ct=function(e){let{loading:t,refreshCustomFunctions:n,restarting:a}=e;const r=(0,s.Kw)(o.Z,(e=>e.auth)),l=(0,s.Kw)(o.Z,(e=>e.url));return(0,k.jsxs)("span",{className:"structure-reloader d-block text-center mb-4",children:[(0,k.jsxs)(h.Z,{disabled:t,color:"link",onClick:n,children:[(0,k.jsx)("span",{className:"me-2",children:"refresh projects"}),(0,k.jsx)("i",{title:"Refresh Endpoint Files",className:"fa ".concat(t?"fa-spinner fa-spin":"fa-sync-alt")})]}),(0,k.jsx)("span",{className:"mx-3 text",children:"|"}),(0,k.jsxs)(h.Z,{disabled:a,color:"link",onClick:()=>(0,K.Z)({auth:r,url:l,service:"custom_functions"}),className:"me-2",children:[(0,k.jsx)("span",{className:"me-2",children:"restart server"}),(0,k.jsx)("i",{title:"Refresh Endpoint Files",className:"fa ".concat(a?"fa-spinner fa-spin":"fa-stop-circle")})]}),(0,k.jsx)("hr",{className:"d-block d-md-none mt-4"})]})};const it=function(e){let{url:t,project:n,fileCount:a}=e;return(0,k.jsxs)("div",{className:"entity-manager",children:[(0,k.jsxs)("div",{className:"floating-card-header",children:["/",n,"/static"]}),(0,k.jsx)(i.Z,{className:"my-3",children:(0,k.jsx)(u.Z,{children:(0,k.jsxs)(l.Z,{className:"item-row",children:[(0,k.jsx)(c.Z,{className:"item-label",children:a?"enabled":'"static" subfolder not found'}),(0,k.jsxs)(c.Z,{className:"item-action",children:[(0,k.jsx)(h.Z,{tabIndex:"-1",color:a?"success":"danger",disabled:!a,className:"round me-1",children:a}),(0,k.jsx)(h.Z,{tabIndex:"-1",color:"purple",className:"round",disabled:!a,href:"".concat(t,"/").concat(n,"/static"),target:"_blank",rel:"noopener noreferrer",children:(0,k.jsx)("i",{title:"View UI",className:"fa fa-share"})})]})]})})})]})};var ut=n(7266);const dt=function(e){var t,n,i;let{refreshCustomFunctions:u,loading:m}=e;const{customer_id:h,compute_stack_id:f,action:g="edit",project:j,file:x}=(0,d.UO)(),v=(0,d.s0)(),b=(0,s.Kw)(o.Z,(e=>e.custom_functions)),y=(0,s.Kw)(o.Z,(e=>e.registration)),[N,w]=((null===y||void 0===y?void 0:y.version)||"").split("."),C=parseFloat("".concat(N,".").concat(w))<4.1,Z=(0,s.Kw)(o.Z,(e=>"custom_functions"===e.restarting_service)),_=(0,s.Kw)(o.Z,(e=>{var t;return e.custom_functions_url||"".concat(e.url.split(":").slice(0,-1).join(":"),":").concat(null===(t=e.custom_functions)||void 0===t?void 0:t.port)})),S="/o/".concat(h,"/i/").concat(f,"/functions/").concat(g);return(0,a.useEffect)((()=>{const e=(null===b||void 0===b?void 0:b.endpoints)&&Object.keys(null===b||void 0===b?void 0:b.endpoints).length,t=(null===b||void 0===b?void 0:b.endpoints)&&Object.keys(null===b||void 0===b?void 0:b.endpoints).includes(j);if(e&&j&&!t){const e=j&&Object.keys(null===b||void 0===b?void 0:b.endpoints)[0];v("".concat(S,"/").concat(e))}else if(e&&j&&!x){var n,a;const e=j&&(null===b||void 0===b||null===(n=b.endpoints[j])||void 0===n?void 0:n.routes[0]),t=j&&(null===b||void 0===b||null===(a=b.endpoints[j])||void 0===a?void 0:a.helpers[0]),s=e?"routes":"helpers";v("".concat(S,"/").concat(j,"/").concat(s,"/").concat(e||t))}else if(e&&!j){const e=Object.keys(null===b||void 0===b?void 0:b.endpoints)[0];v("".concat(S,"/").concat(e))}else e||v(S)}),[null===b||void 0===b?void 0:b.endpoints,h,f,v,g,j,x,S]),(0,r.Z)((async()=>{if(_&&Z)try{await fetch(_),o.Z.update((e=>{e.restarting_service=!1}))}catch(e){console.log(e)}}),1e3),(0,k.jsxs)(l.Z,{id:"functions",children:[(0,k.jsx)(c.Z,{xl:"3",lg:"4",md:"6",xs:"12",children:(0,k.jsxs)(p.SV,{onError:(e,t)=>(0,E.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:O.Z,children:[(0,k.jsx)(nt,{itemType:"projects",items:Object.keys(null===b||void 0===b?void 0:b.endpoints)||[],activeItem:j,baseUrl:S,restarting:Z,showForm:"edit"===g}),j&&"edit"===g&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(nt,{itemType:"routes",items:j&&(null===b||void 0===b||null===(t=b.endpoints[j])||void 0===t?void 0:t.routes)||[],project:j,activeItem:x,baseUrl:"".concat(S,"/").concat(j,"/routes"),restarting:Z,showForm:"edit"===g}),(0,k.jsx)(nt,{itemType:"helpers",items:j&&(null===b||void 0===b||null===(n=b.endpoints[j])||void 0===n?void 0:n.helpers)||[],project:j,activeItem:x,baseUrl:"".concat(S,"/").concat(j,"/helpers"),restarting:Z,showForm:"edit"===g}),C&&(0,k.jsx)(it,{url:_,project:j,fileCount:j&&(null===b||void 0===b||null===(i=b.endpoints[j])||void 0===i?void 0:i.static)||0})]}),(0,k.jsx)("hr",{className:"mt-0"}),(0,k.jsxs)("div",{className:"entity-manager-footer",children:[(0,k.jsx)("div",{className:"text-bold mb-1",children:"Root File Directory"}),(0,k.jsx)(ut.Z,{text:b.directory}),(0,k.jsx)("div",{className:"text-bold mb-1 mt-3",children:"Custom Functions Server URL"}),(0,k.jsx)(ut.Z,{text:_})]}),(0,k.jsx)("hr",{}),(0,k.jsx)(ct,{refreshCustomFunctions:u,loading:m,restarting:Z})]})}),(0,k.jsx)(c.Z,{xl:"9",lg:"8",md:"6",xs:"12",children:"deploy"===g?(0,k.jsx)(lt,{}):j?(0,k.jsx)(at,{}):(0,k.jsx)(P.Z,{refreshCustomFunctions:u,headline:"Please ".concat(null!==b&&void 0!==b&&b.endpoints.length?"choose":"create"," a project at left.")})})]})};function pt(e){return e.split("/").slice(2).join("/")}function mt(e,t,n,a){return e.reduce(((e,s)=>{const r=s.compute_stack_id,o=t[r];if(null===o||void 0===o||!o.version)return e;const[l,c]=(null===o||void 0===o?void 0:o.version.split("."))||[];return parseInt(l,10)>=4&&parseInt(c,10)>=2&&e.push({isCurrentInstance:r===n,auth:a,instance:s}),e}),[])}const ht=function(e){let{refreshCustomFunctions:t,loading:n}=e;const{compute_stack_id:r}=(0,d.UO)(),l=(0,s.Kw)(o.Z,(e=>e.registration)),{fileTree:c}=(0,s.Kw)(o.Z,(e=>e.custom_functions)),i=(0,s.Kw)(o.Z,(e=>e.auth)),u=(0,s.Kw)(o.Z,(e=>e.url)),[p,m]=((null===l||void 0===l?void 0:l.version)||"").split(".")||[],h=parseFloat("".concat(p,".").concat(m))>=4.2,f=(0,s.Kw)(R.Z,(e=>e.instances)),[g]=(0,L.Z)({}),[j,v]=W({}),[b,y]=(0,a.useState)(!1),N=(0,I.VY)();function w(e){let{path:t}=e;const n={...j},a="".concat(r,"_").concat(t);a in n&&delete n[a],v({...n})}async function C(e){let{auth:t,url:n}=e;y(!0),setTimeout((async()=>{await(0,K.Z)({auth:t,url:n,service:"http_workers"}),y(!1)}),100)}return h?(0,k.jsx)(Ve,{fileTree:c,deployTargets:mt(f,g,r,i),onRevertFile:async function(e){w({path:e.path});const{error:n,message:a}=await T({auth:i,url:u,project:e.project,file:pt(e.path)});return n?N.error(a):(await t(),a)},onFileChange:async function(e){const{path:t,content:n}=e,a="".concat(r,"_").concat(t);v({...j,[a]:n})},onFileSave:async function(e,n){const a=e.path.split("/").slice(2).join("/"),s={auth:i,url:u,project:e.project,file:a,payload:e.content},{error:r,message:o}=await A(s);r&&N.error(o),n&&await C({auth:i,url:u}),w({path:e.path}),e.cached=!1,await t()},onUpdate:t,onAddFile:async function(e,n){const{path:a,project:s}=n,r=pt(a),o=r?"".concat(r,"/").concat(e):e;return await A({auth:i,url:u,project:s,file:o,payload:""}),await t(),{content:"",path:[n.path,e].join("/"),project:s}},onAddProject:async function(e){const{error:n,message:a}=await(async e=>{let{auth:t,url:n,project:a}=e;return(0,x.Z)({operation:{operation:"add_component",project:a},auth:t,url:n})})({auth:i,url:u,project:e});n&&N.error(a),await(0,K.Z)({auth:i,url:u,service:"http_workers"}),await t()},onAddProjectFolder:async function(e,n){const{path:a,project:s}=n,r=pt(a),o=r?"".concat(r,"/").concat(e):e,{error:l,message:c}=await A({auth:i,url:u,project:s,file:o});l&&N.error(c),await t()},onInstallPackage:async function(e,n,a){const s=a.map((async t=>{const{error:a,message:s}=await z({auth:t.auth,url:t.instance.url,project:e,packageUrl:n});a&&N.error(s),await(0,K.Z)({auth:t.auth,url:t.instance.url,service:"http_workers"})}));await Promise.all(s),await t(),await t()},onDeployProject:async function(e){let{project:n,deployTarget:a}=e;const{auth:s,instance:r}=a,{payload:o}=await(async e=>{let{auth:t,url:n,project:a,skip_node_modules:s=!0}=e;return(0,x.Z)({auth:t,url:n,operation:{operation:"package_component",project:a,skip_node_modules:s}})})({auth:i,url:u,project:n.name});await z({auth:s,url:r.url,project:n.name,payload:o}),await(0,K.Z)({auth:s,url:r.url,service:"http_workers"}),await(0,K.Z)({auth:i,url:u,service:"http_workers"}),await t()},onDeleteFile:async function(e){const{error:n,message:a}=await U({auth:i,url:u,project:e.project,file:pt(e.path)});n&&N.error(a),await t()},onDeleteFolder:async function(e){let{path:n,project:a}=e;const s=pt(n);if(s.length>0){const{error:e,message:t}=await U({auth:i,url:u,project:a,file:s});e&&N.error(t)}else{const{error:e,message:t}=await U({auth:i,url:u,project:a});e&&N.error(t)}await t()},onDeletePackage:async function(e){let{name:n}=e;const{error:a,message:s}=await U({auth:i,url:u,project:n});a?N.error(s):(await(0,K.Z)({auth:i,url:u,service:"http_workers"}),await t())},onFileSelect:async function(e){const{path:t,project:n,name:a}=e,s=pt(t),o="".concat(r,"_").concat(t),l=j[o],c=o in j;if(c)return{cached:c,content:l,path:t,project:n,name:a};const{error:d,message:p}=await T({auth:i,url:u,project:n,file:s});return d?(N.error(p),{content:"",path:t,project:n,name:a,cached:!1}):{cached:c,content:p,path:t,project:n,name:a}},onFileRename:async function(e,n){const{path:a,content:s,project:r}=n,o=pt(a).split("/").slice(0,-1).join("/"),l=o?"".concat(o,"/").concat(e):e;await U({auth:i,url:u,project:r,file:pt(a)}),await A({auth:i,url:u,project:r,file:l,payload:s}),t()},onFolderRename:async function(){},refreshingCustomFunctions:n,restartInstance:async()=>C({auth:i,url:u}),restartingInstance:b}):(0,k.jsx)(dt,{refreshCustomFunctions:t,loading:n})};const ft=function(){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"floating-card-header text-end",children:"\xa0"}),(0,k.jsx)(i.Z,{className:"my-3",children:(0,k.jsx)(u.Z,{children:(0,k.jsxs)("div",{className:"empty-prompt narrow",children:[(0,k.jsx)("i",{className:"fa fa-bullhorn fa-3x text-success"}),(0,k.jsx)("div",{className:"mt-3 text-bold",children:"Coming Soon: Custom Functions!"}),(0,k.jsx)("div",{className:"mt-3",children:(0,k.jsxs)("ul",{children:[(0,k.jsx)("li",{children:"Add your own API endpoints to a standalone API server inside HarperDB"}),(0,k.jsx)("li",{children:"Use HarperDB Core methods to interact with your data at lightning speed"}),(0,k.jsx)("li",{children:"Custom Functions are powered by Fastify, so they're extremely flexible"}),(0,k.jsx)("li",{children:"Manage in HarperDB Studio, or use your own IDE and Version Management System"}),(0,k.jsx)("li",{children:"Distribute your Custom Functions to all your HarperDB instances with a single click"})]})})]})})})]})};var gt=n(7377);const jt=function(){const e=(0,s.Kw)(o.Z,(e=>e.auth)),t=(0,s.Kw)(o.Z,(e=>e.url)),n=(0,s.Kw)(o.Z,(e=>e.custom_functions)),l=(0,s.Kw)(o.Z,(e=>e.registration)),[c,i]=((null===l||void 0===l?void 0:l.version)||"").split(".")||[],u=parseFloat("".concat(c,".").concat(i))>=4.2,d=(0,s.Kw)(o.Z,(e=>e.restarting)),[p,m]=(0,a.useState)(!1),[h,f]=(0,a.useState)(!0),[g,j]=(0,a.useState)(!1),x=(0,a.useCallback)((async()=>{e&&t&&!d&&(f(!0),await w({auth:e,url:t}),f(!1))}),[e,t,d]);return(0,a.useEffect)((()=>{x()}),[x]),(0,a.useEffect)((()=>{const e=(null===n||void 0===n?void 0:n.is_enabled)&&(null===n||void 0===n?void 0:n.port)||u;m(e),e&&j(!1)}),[n,u]),(0,r.Z)((()=>{g&&x()}),2e3),n?n.error?(0,k.jsx)(ft,{}):g?(0,k.jsx)(P.Z,{description:"Configuring Custom Functions",icon:(0,k.jsx)("i",{className:"fa fa-spinner fa-spin"})}):p?(0,k.jsx)(ht,{refreshCustomFunctions:x,loading:h}):(0,k.jsx)(D,{setConfiguring:j}):(0,k.jsx)(gt.Z,{header:"loading custom functions",spinner:!0})}},7266:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7313),s=n(6782),r=n(5399),o=n(9327),l=n(6160),c=n(6417);const i=function(e){let{text:t,beforeText:n,afterText:i,obscure:u=!1}=e;const d=(0,l.VY)(),p=navigator.clipboard,m=(0,a.useCallback)((async e=>{e.stopPropagation(),await navigator.clipboard.writeText(t),d.success("Text copied to clipboard")}),[d,t]);return(0,c.jsxs)(s.Z,{className:"copyable-text-holder g-0",children:[p&&t&&(0,c.jsx)(r.Z,{className:"copy-icon",children:(0,c.jsx)(o.Z,{title:"Copy this value",onClick:m,color:"link",children:(0,c.jsx)("i",{className:"fa fa-copy text-small"})})}),(0,c.jsx)(r.Z,{className:"text-container",children:t?(0,c.jsxs)(c.Fragment,{children:[n,u?t.replace(/./g,"*"):t,i]}):(0,c.jsx)("span",{children:"\xa0"})})]})}},6855:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(7313),s=n(5110),r=n(1781),o=n(9842),l=n(6782),c=n(5399),i=n(6417);const u=e=>{let{headerGroups:t,onSortedChange:n,sorted:a,showFilter:s}=e;return t.map((e=>(0,i.jsxs)("div",{...e.getHeaderGroupProps(),children:[(0,i.jsx)(l.Z,{className:"header g-0",children:e.headers.map((e=>{var t,s;return(0,i.jsx)(c.Z,{onClick:()=>{var t,s;return n([{id:e.id,desc:(null===(t=a[0])||void 0===t?void 0:t.id)===e.id&&!(null!==(s=a[0])&&void 0!==s&&s.desc)}])},className:"".concat((null===(t=a[0])||void 0===t?void 0:t.id)===e.id?"sorted":""," ").concat(null!==(s=a[0])&&void 0!==s&&s.desc?"desc":"asc"," ").concat(-1!==e.id.indexOf("hdb-narrow")?"action":""," px-1"),children:(0,i.jsx)("div",{className:"text-renderer",children:e.render("Header")})},e.id)}))}),s&&(0,i.jsx)(l.Z,{className:"filter g-0",children:e.headers.map((e=>(0,i.jsx)(c.Z,{className:-1!==e.id.indexOf("hdb-narrow")?"action":"",children:e.render("Filter")},e.id)))})]})))};var d=n(9327);const p=function(e){let{page:t,pageSize:n,totalPages:a,onPageChange:s,onPageSizeChange:o,loading:u}=e;return(0,i.jsxs)(l.Z,{className:"pagination",children:[(0,i.jsx)(c.Z,{xs:"12",sm:"2",className:"previous",children:(0,i.jsx)(d.Z,{className:"mb-2 btn-pagination",color:"purple",block:!0,onClick:()=>s(t-1),disabled:!a||0===t,children:(0,i.jsx)("i",{className:"fa fa-chevron-left"})})}),(0,i.jsxs)(c.Z,{xs:"12",sm:"4",className:"paginator",children:[(0,i.jsx)("i",{className:"fa fa-book me-2"}),(0,i.jsx)(r.Z,{className:"mb-2",type:"number",value:t+1,min:1,max:a,onChange:e=>s(e.target.value-1)}),(0,i.jsxs)("div",{className:"page-count",children:["\xa0/\xa0",u?(0,i.jsx)("i",{className:"fa fa-spinner fa-spin"}):a]})]}),(0,i.jsx)(c.Z,{xs:"12",sm:"4",className:"page-size",children:(0,i.jsx)(r.Z,{className:"mb-2",type:"select",value:n,onChange:e=>o(e.target.value),children:[20,50,100,250].map((e=>(0,i.jsxs)("option",{value:e,children:[e," rows"]},e)))})}),(0,i.jsx)(c.Z,{xs:"12",sm:"2",className:"next",children:(0,i.jsx)(d.Z,{className:"mb-2 pull-right btn-pagination",block:!0,color:"purple",onClick:()=>s(t+1),disabled:!a||t+1===a,children:(0,i.jsx)("i",{className:"fa fa-chevron-right"})})})]})};const m=function(e){let{previousPage:t,canPreviousPage:n,pageIndex:a,gotoPage:s,setPageSize:o,pageCount:u,nextPage:p,canNextPage:m,loading:h}=e;return(0,i.jsxs)(l.Z,{className:"pagination",children:[(0,i.jsx)(c.Z,{xs:"12",sm:"2",className:"previous",children:(0,i.jsx)(d.Z,{className:"mb-2 btn-pagination",color:"purple",block:!0,onClick:t,disabled:!u||!n,children:(0,i.jsx)("i",{className:"fa fa-chevron-left"})})}),(0,i.jsxs)(c.Z,{xs:"12",sm:"4",className:"paginator",children:[(0,i.jsx)("i",{className:"fa fa-book me-2"}),(0,i.jsx)(r.Z,{className:"mb-2",type:"number",value:a+1||1,min:1,max:u,onChange:e=>s(e.target.value?Number(e.target.value)-1:0)}),(0,i.jsxs)("div",{className:"page-count",children:["\xa0/\xa0",h?(0,i.jsx)("i",{className:"fa fa-spinner fa-spin"}):u]})]}),(0,i.jsx)(c.Z,{xs:"12",sm:"4",className:"page-size",children:(0,i.jsx)(r.Z,{className:"mb-2",type:"select",onChange:e=>{s(0),setTimeout((()=>o(e.target.value)),1e3)},children:[20,50,100,250].map((e=>(0,i.jsxs)("option",{value:e,children:[e," rows"]},e)))})}),(0,i.jsx)(c.Z,{xs:"12",sm:"2",className:"next",children:(0,i.jsx)(d.Z,{className:"mb-2 pull-right btn-pagination",block:!0,color:"purple",onClick:p,disabled:!u||!m,children:(0,i.jsx)("i",{className:"fa fa-chevron-right"})})})]})};const h=function(e){let{prepareRow:t,row:n,onRowClick:a=!1}=e;return t(n),(0,i.jsx)(l.Z,{onClick:()=>a&&a(n.original),className:"g-0",children:n.cells.map((e=>(0,i.jsx)(c.Z,{className:-1!==e.column.id.indexOf("hdb-narrow")?"action":"",children:e.render("Cell")},"".concat(e.row.id,"-").concat(e.column.id))))})};var f=n(2261),g=n(4220);function j(e){let{value:t}=e;return(0,i.jsx)("div",{className:"text-renderer",children:t})}function x(e){let{src:t}=e;const[n,s]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1);return(0,i.jsxs)("div",{className:"image-renderer",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[(0,i.jsx)("i",{className:"fa fa-image"}),n&&r?(0,i.jsxs)("div",{className:"preview-image no-image",children:[(0,i.jsx)("i",{className:"fa fa-ban text-danger"}),(0,i.jsx)("div",{className:"mt-2",children:"image failed to load"})]}):n?(0,i.jsx)("img",{onError:o,alt:t,src:t,className:"preview-image"}):null]})}const v={Filter:e=>{let{column:{filterValue:t,setFilter:n}}=e;return(0,i.jsx)(r.Z,{type:"text",value:t||"",onChange:e=>n(e.target.value||void 0)})},Cell:e=>{let{value:t}=e;return(e=>{switch(Object.prototype.toString.call(e)){case"[object Array]":case"[object Object]":return(0,i.jsx)(j,{value:JSON.stringify(e)});case"[object Boolean]":return(0,i.jsx)(j,{value:e?"true":"false"});case"[object String]":return(t=e)&&(t.match(/^https?.*\.(jpeg|jpg|gif|png)$/)||-1!==t.indexOf("data:image"))?(0,i.jsx)(x,{src:e}):(0,i.jsx)(j,{value:e});default:return(0,i.jsx)(j,{value:e})}var t})(t)}};const b=function(e){let{columns:t,data:n,currentPage:r,pageSize:l,totalPages:c,onFilteredChange:d,onSortedChange:j,onPageChange:x,onPageSizeChange:b,showFilter:y,onRowClick:N,sorted:w,loading:k,manual:C=!1}=e;const{headerGroups:Z,page:_,rows:S,prepareRow:F,state:P,setAllFilters:O,canPreviousPage:E,canNextPage:D,pageOptions:I,pageCount:R,gotoPage:T,nextPage:A,previousPage:U,setPageSize:z}=(0,s.useTable)({columns:t,data:n,defaultColumn:v,onFilteredChange:d,onSortedChange:j,onPageChange:x,onPageSizeChange:b,onRowClick:N,manualPagination:C,manualFilters:C,initialState:{pageIndex:r,pageSize:l}},s.useFilters,s.usePagination),[K,L]=(0,a.useState)(!0),W=C||!_.length?S:_;return(0,a.useEffect)((()=>{!y&&P.filters.length?O([]):d(P.filters)}),[P.filters,y]),(0,a.useEffect)((()=>{setTimeout((()=>L(!1)),100)}),[null===W||void 0===W?void 0:W.length]),(0,i.jsxs)(o.SV,{onError:(e,t)=>(0,f.Z)({error:{message:e.message,componentStack:t}}),FallbackComponent:g.Z,children:[(0,i.jsxs)("div",{className:"react-table-scroller",children:[(0,i.jsx)(u,{headerGroups:Z,onSortedChange:j,sorted:w,showFilter:y}),k||K?(0,i.jsx)("div",{className:"centered text-center",children:(0,i.jsx)("i",{className:"fa fa-spinner fa-spin"})}):W.length?W.map((e=>(0,i.jsx)(h,{row:e,prepareRow:F,onRowClick:N},e.id))):(0,i.jsxs)("div",{className:"centered text-center",children:[(0,i.jsx)("i",{className:"fa fa-exclamation-triangle text-danger"}),(0,i.jsx)("div",{className:"mt-2 text-darkgrey",children:"no records"})]})]}),C?(0,i.jsx)(p,{page:r,pageSize:l,totalPages:c,onPageChange:x,onPageSizeChange:b,loading:k}):(0,i.jsx)(m,{previousPage:U,pageSize:l,canPreviousPage:E,pageIndex:P.pageIndex,pageOptions:I,gotoPage:T,setPageSize:z,pageCount:R,nextPage:A,canNextPage:D,loading:k})]})}},7093:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(9859);const s=async e=>{let{auth:t,url:n}=e;return(0,a.Z)({operation:{operation:"get_configuration"},auth:t,url:n})}},5200:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(9859),s=n(5447);const r=async e=>{let{auth:t,url:n}=e;const r=await(0,a.Z)({operation:{operation:"list_roles"},auth:t,url:n}),o=[...Array.isArray(r)?r:[]].sort(((e,t)=>e.role.toLowerCase()>t.role.toLowerCase()?1:-1));return s.Z.update((e=>{e.roles=o})),o}},2066:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(9859),s=n(5447);const r=async e=>{let{auth:t,url:n,signal:r}=e;const o=await(0,a.Z)({operation:{operation:"list_users"},auth:t,url:n,signal:r}),l=Array.isArray(o)?[...o].map((e=>({username:e.username,role:e.role.role}))).sort(((e,t)=>e.username.toLowerCase()>t.username.toLowerCase()?1:-1)):[];return s.Z.update((e=>{e.users=l})),l}},8147:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(9859),s=n(5447);const r=async e=>{let{auth:t,url:n}=e;return s.Z.update((e=>{e.restarting=!0})),(0,a.Z)({operation:{operation:"restart"},auth:t,url:n})}},9358:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(9859),s=n(5447);const r=async e=>{let{auth:t,url:n,service:r=null}=e;return r?(s.Z.update((e=>{e.restarting_service=r})),(0,a.Z)({operation:{operation:"restart_service",service:r},auth:t,url:n})):{error:!0,message:"You must specify a service"}}},4431:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(9859);const s=async e=>{let{auth:t,url:n,...s}=e;return(0,a.Z)({operation:{operation:"set_configuration",...s},auth:t,url:n})}},4095:(e,t,n)=>{n.d(t,{Z:()=>c});var a=n(7093),s=n(5200),r=n(2066),o=n(5491),l=n(9859);const c=async e=>{let{auth:t,url:n}=e;const c=await(0,a.Z)({auth:t,url:n}),i=await(0,o.Z)({auth:t,url:n}),u=await(async e=>{let{auth:t,url:n}=e;return(0,l.Z)({operation:{operation:"cluster_status"},auth:t,url:n})})({auth:t,url:n}),d=parseFloat(null===i||void 0===i?void 0:i.version)>=4?"nats":"socketcluster",p=await(0,s.Z)({auth:t,url:n});let m=!1;p.error||(m=p.find((e=>e.permission.cluster_user)));const h=await(0,r.Z)({auth:t,url:n});let f=!1;h.error||(f=m&&h.find((e=>e.role===m.role)));const g="nats"===d?c.clustering.enabled:c.CLUSTERING,j="nats"===d?c.clustering.user:c.CLUSTERING_USER,x="nats"===d?c.clustering.hubServer.cluster.network.port:c.CLUSTERING_PORT,v="nats"===d?c.clustering.nodeName:c.NODE_NAME;return{is_ready:!!g&&!!f&&!!j&&!!m&&!!x&&!!v,cluster_role:m,cluster_user:f,is_enabled:g,config_cluster_user:j,config_cluster_port:x,node_name:v,engine:d,status:null===u||void 0===u?void 0:u.status,message:null===u||void 0===u?void 0:u.message,connections:null===u||void 0===u?void 0:u.connections}}},3517:(e,t,n)=>{n.d(t,{Z:()=>a});const a=e=>e.match(/^[-a-zA-Z0-9_]+$/)},3262:(e,t,n)=>{n.d(t,{Z:()=>a});const a=e=>!Number.isNaN(parseFloat(e))&&Number.isFinite(parseFloat(e))},1781:(e,t,n)=>{n.d(t,{Z:()=>b});var a=n(7313),s=n(5192),r=n.n(s),o=n(6123),l=n.n(o),c=n(986);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var u=["className","cssModule","type","bsSize","valid","invalid","tag","addon","plaintext","innerRef"];function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}function p(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function m(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=j(e);if(t){var s=j(this).constructor;n=Reflect.construct(a,arguments,s)}else n=a.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}(this,n)}}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}var x={children:r().node,type:r().string,size:r().oneOfType([r().number,r().string]),bsSize:r().string,valid:r().bool,invalid:r().bool,tag:c.iC,innerRef:r().oneOfType([r().object,r().func,r().string]),plaintext:r().bool,addon:r().bool,className:r().string,cssModule:r().object},v=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(o,e);var t,n,s,r=f(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=r.call(this,e)).getRef=t.getRef.bind(g(t)),t.focus=t.focus.bind(g(t)),t}return t=o,(n=[{key:"getRef",value:function(e){this.props.innerRef&&this.props.innerRef(e),this.ref=e}},{key:"focus",value:function(){this.ref&&this.ref.focus()}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.cssModule,s=e.type,r=void 0===s?"text":s,o=e.bsSize,i=e.valid,m=e.invalid,h=e.tag,f=e.addon,g=e.plaintext,j=e.innerRef,x=p(e,u),v=["switch","radio","checkbox"].indexOf(r)>-1,b="select"===r,y="range"===r,N=h||(b||"textarea"===r?r:"input"),w="form-control";g?(w="".concat(w,"-plaintext"),N=h||"input"):y?w="form-range":b?w="form-select":v&&(w=f?null:"form-check-input"),x.size&&/\D/g.test(x.size)&&((0,c.O4)('Please use the prop "bsSize" instead of the "size" to bootstrap\'s input sizing.'),o=x.size,delete x.size);var k=(0,c.mx)(l()(t,m&&"is-invalid",i&&"is-valid",!!o&&(b?"form-select-".concat(o):"form-control-".concat(o)),w),n);return("input"===N||h&&"function"===typeof h)&&(x.type="switch"===r?"checkbox":r),x.children&&!g&&"select"!==r&&"string"===typeof N&&"select"!==N&&((0,c.O4)('Input with a type of "'.concat(r,'" cannot have children. Please use "value"/"defaultValue" instead.')),delete x.children),a.createElement(N,d({},x,{ref:j,className:k,"aria-invalid":m}))}}])&&m(t.prototype,n),s&&m(t,s),Object.defineProperty(t,"prototype",{writable:!1}),o}(a.Component);v.propTypes=x;const b=v}}]);