"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[641],{9716:(e,a,t)=>{t.r(a),t.d(a,{default:()=>N});var s=t(7313),c=t(9424),r=t(238),n=t(3516),l=t(6782),o=t(5399),i=t(9327),d=t(8467),h=t(3672),u=t.n(h),m=t(7387),b=t(6160),f=t(9842),p=t(5447),j=t(6449),x=t(9859),_=t(2261),Z=t(4220),k=t(6417);const N=function(e){let{newEntityAttributes:a,hashAttribute:t}=e;const{customer_id:h,schema:N,table:g,hash:v,action:w,compute_stack_id:y}=(0,d.UO)(),C=decodeURIComponent(N),S=decodeURIComponent(g),T=decodeURIComponent(v),D=(0,b.VY)(),{state:I}=(0,d.TH)(),U=(0,d.s0)(),V=(0,m.Kw)(p.Z,(e=>e.auth)),E=(0,m.Kw)(p.Z,(e=>e.url)),F=(0,m.Kw)(j.Z,(e=>e.theme)),O=(0,s.useRef)(null),[R,A]=(0,s.useState)("{}"),[J,K]=(0,s.useState)(),[Y,P]=(0,s.useState)(!0),[H,M]=(0,s.useState)(!1),[q,z]=(0,s.useState)(!1),B="/o/".concat(h,"/i/").concat(y,"/browse/").concat(C,"/").concat(S),G=async e=>{if(e.preventDefault(),Y||D.error("Please insert valid JSON to proceed"),!w||!Y)return!1;M(!0);const a=JSON.parse(R),t={operation:{operation:"edit"===w?"update":"insert",schema:C,table:S,records:"edit"!==w&&Array.isArray(a)?a:[a]},auth:V,url:E},{error:s,message:c}=await(0,x.Z)(t);return s?(D.error(c),M(!1)):(p.Z.update((e=>{e.lastUpdate=Date.now()})),setTimeout((()=>U("/o/".concat(h,"/i/").concat(y,"/browse/").concat(C,"/").concat(S))),1e3))};return(0,s.useEffect)((()=>{var e,a;null!==(e=O.current)&&void 0!==e&&null!==(a=e.editor)&&void 0!==a&&a.setTheme&&O.current.editor.setTheme("dark"===F?"vs-dark":"light")}),[F]),u()((()=>{a||U(B)}),[]),u()((async()=>{if("edit"===w){let a;null!==I&&void 0!==I&&I.hashValue?a=[I.hashValue]:(e=T,a="".concat(parseFloat(e))===e?["".concat(T),parseInt(T,10)]:[T]);const s=await(0,x.Z)({operation:{operation:"search_by_hash",schema:C,table:S,hash_values:a,get_attributes:["*"]},auth:V,url:E}),[c]=s;if(c){const e=c[t],a=c.__createdtime__,s=c.__updatedtime__;delete c.__createdtime__,delete c.__updatedtime__,delete c[t];const r={[t]:e,...c,__createdtime__:a,__updatedtime__:s};A(JSON.stringify(r,null,4))}else U(B),D.error("Unable to find record with that hash_attribute")}else A(JSON.stringify(a||{},null,4));var e}),[T]),(0,k.jsxs)(f.SV,{onError:(e,a)=>(0,_.Z)({error:{message:e.message,componentStack:a}}),FallbackComponent:Z.Z,children:[(0,k.jsxs)("span",{className:"floating-card-header",children:[C," ",S&&">"," ",S," ","add"===w?"> add new":T?"> edit > ".concat(T):"","\xa0"]}),(0,k.jsx)(r.Z,{className:"my-3",children:(0,k.jsxs)(n.Z,{children:[(0,k.jsx)("ul",{className:"text-small",children:"add"===w&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("li",{children:['The hash_attribute for this table is "',(0,k.jsx)("b",{children:t}),'", and will auto-generate. You may manually add it if you want to specify its value.']}),(0,k.jsxs)("li",{children:[(0,k.jsx)("b",{children:"You may paste in an array"})," if you want to add more than one record at a time."]})]})}),(0,k.jsx)(r.Z,{className:"mb-2 json-editor-holder",children:(0,k.jsx)(n.Z,{children:(0,k.jsx)(c.ZP,{height:"350px",language:"json",value:R,theme:"vs-dark",onValidate:e=>{P(0===e.length)},onChange:e=>{A(e)},onMount:(e,a)=>{O.current=a}})})}),(0,k.jsxs)(l.Z,{children:[(0,k.jsx)(o.Z,{md:"4",className:"mt-2",children:J?(0,k.jsx)("div",{className:"pt-2",children:"Delete this record?"}):(0,k.jsx)(i.Z,{disabled:H||q,id:"backToTable",block:!0,color:"black",onClick:()=>U("/o/".concat(h,"/i/").concat(y,"/browse/").concat(C,"/").concat(S)),children:(0,k.jsx)("i",{className:"fa fa-chevron-left"})})}),"add"===w?(0,k.jsx)(o.Z,{md:"8",children:(0,k.jsx)(i.Z,{disabled:H||!Y,id:"addEditItem",className:"mt-2",onClick:G,block:!0,color:"success",children:(0,k.jsx)("i",{className:"fa ".concat(H?"fa-spinner fa-spin":"fa-save")})})}):J?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.Z,{md:"4",className:"mt-2",children:(0,k.jsx)(i.Z,{disabled:H||q,id:"cancelDelete",block:!0,color:"black",onClick:()=>K(!1),children:(0,k.jsx)("i",{className:"fa fa-ban"})})}),(0,k.jsx)(o.Z,{md:"4",children:(0,k.jsx)(i.Z,{disabled:H||q,id:"deleteRecord",className:"mt-2",onClick:async e=>{if(e.preventDefault(),!w)return!1;z(!0);const{error:a,message:t}=await(0,x.Z)({operation:{operation:"delete",schema:C,table:S,hash_values:[I.hashValue]},auth:V,url:E});return a?(D.error(t),K(!1),z(!1)):setTimeout((()=>U("/o/".concat(h,"/i/").concat(y,"/browse/").concat(C,"/").concat(S))),100)},block:!0,color:"success",children:(0,k.jsx)("i",{className:"fa ".concat(q?"fa-spinner fa-spin":"fa-check")})})})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(o.Z,{md:"4",className:"mt-2",children:(0,k.jsx)(i.Z,{disabled:H||q,id:"confirmDelete",block:!0,color:"danger",onClick:()=>K(T),children:(0,k.jsx)("i",{className:"fa fa-trash"})})}),(0,k.jsx)(o.Z,{md:"4",children:(0,k.jsx)(i.Z,{disabled:H||!Y,id:"addEditItem",className:"mt-2",onClick:G,block:!0,color:"success",children:(0,k.jsx)("i",{className:"fa ".concat(H?"fa-spinner fa-spin":"fa-save")})})})]})]})]})})]})}}}]);