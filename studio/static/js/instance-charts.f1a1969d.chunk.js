"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[60],{7606:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var s=r(7313),a=r(238),i=r(3516),o=r(9327),l=r(6782),c=r(5399),n=r(7387),d=r(8467),u=r(6160),m=r(4122),h=r(6449),p=r(5447),f=r(5192),b=r.n(f),g=r(6123),x=r.n(g),v=r(986),j=["className","cssModule","size","vertical","tag"];function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},y.apply(this,arguments)}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(e,t){if(null==e)return{};var r,s,a=function(e,t){if(null==e)return{};var r,s,a={},i=Object.keys(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)r=i[s],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var O={"aria-label":b().string,className:b().string,cssModule:b().object,role:b().string,size:b().string,tag:v.iC,vertical:b().bool};function N(e){var t=e.className,r=e.cssModule,a=e.size,i=e.vertical,o=e.tag,l=void 0===o?"div":o,c=k(e,j),n=(0,v.mx)(x()(t,!!a&&"btn-group-"+a,i?"btn-group-vertical":"btn-group"),r);return s.createElement(l,y({},function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({role:"group"},c),{className:n}))}N.propTypes=O;const w=N;var C=r(8446),D=r(3672),S=r.n(D),P=r(6512),z=r(9356),q=r(3262),K=r(511),A=r(6417);const E=function(e){let{chart:{query:t,name:r,id:l,type:u,labelAttribute:f,seriesAttributes:b,user_id:g},removeChart:x,confirmDelete:v,setConfirmDelete:j}=e;const{compute_stack_id:y}=(0,d.UO)(),Z=(0,n.Kw)(p.Z,(e=>e.auth),[y]),_=(0,n.Kw)(p.Z,(e=>e.url),[y]),k=(0,n.Kw)(h.Z,(e=>e.theme)),O=(0,n.Kw)(h.Z,(e=>{var t;return(null===(t=e.auth)||void 0===t?void 0:t.user_id)===g})),[N,D]=(0,s.useState)(!1),[E,T]=(0,s.useState)(!0),[F,H]=(0,s.useState)(!1),M=N&&!N.error&&(0,z.Z)({title:r,type:u,labels:N.map((e=>e[f])),theme:k}),Y=!N||N.error?[]:"single value"===u?N[0][b[0]]:["donut","pie"].includes(u)?N.map((e=>e[b[0]])):b.map((e=>({name:e,data:N.map((t=>t[e]))})));let B;const R=async()=>{if(Z){T(!0),B&&B.abort(),B=new AbortController;const e=await(0,P.Z)({sql:t,auth:Z,url:_,signal:B.signal});if(!e.error&&e.length){const t=Object.keys(e[0]);("single value"===u?b:[f,...b]).every((e=>t.includes(e)))?D(e):D({error:!0,message:"You do not have permission to access some of the data required to render this chart."})}else D(e);T(!1)}};S()((()=>R()),(()=>B&&B.abort()),[]),(0,m.Z)(R,K.Z.refresh_content_interval);const J=e=>{H(!0),x(e)};return N.error?(0,A.jsx)(c.Z,{lg:"6",xs:"12",className:"mb-3",children:(0,A.jsx)(a.Z,{className:"dashboard-chart",children:(0,A.jsxs)(i.Z,{className:"text-nowrap position-relative",children:[v===l?(0,A.jsxs)(w,{size:"sm",className:"chart-remove-confirm",children:[(0,A.jsxs)(o.Z,{disabled:F,title:"Remove this chart",color:"success",onClick:()=>J(v),children:[F?"deleting chart":"confirm delete chart"," ",(0,A.jsx)("i",{className:"ms-2 fa ".concat(F?"fa-spinner fa-spin":"fa-check")})]}),(0,A.jsxs)(o.Z,{disabled:F,title:"Do not remove this chart",color:"danger",onClick:()=>j(!1),children:["cancel ",(0,A.jsx)("i",{className:"ms-2 fa fa-times"})]})]}):(0,A.jsx)(o.Z,{title:"Remove this chart",className:"chart-remove",color:"link",onClick:()=>j(l),children:(0,A.jsx)("i",{className:"fa fa-times text-darkgrey"})}),(0,A.jsxs)("div",{className:"dashboard single-value-chart",children:[(0,A.jsx)("div",{className:"title",children:"Error Loading Chart"}),(0,A.jsx)("div",{children:N.message}),(0,A.jsx)("div",{className:"mt-3",children:'You may remove this chart by clicking the "x"'})]})]})})},r):(0,A.jsx)(c.Z,{lg:"6",xs:"12",className:"mb-3",children:(0,A.jsx)(a.Z,{className:"dashboard-chart",children:(0,A.jsxs)(i.Z,{className:"text-nowrap position-relative",children:[E&&(0,A.jsx)(o.Z,{disabled:!0,title:"loading",className:"chart-loading",color:"link",children:(0,A.jsx)("i",{className:"fa fa-spinner fa-spin text-darkgrey"})}),v===l?(0,A.jsxs)(w,{size:"sm",className:"chart-remove-confirm",children:[(0,A.jsxs)(o.Z,{disabled:F,title:"Remove this chart",color:"success",onClick:()=>J(v),children:[F?"deleting chart":"confirm delete chart"," ",(0,A.jsx)("i",{className:"ms-2 fa ".concat(F?"fa-spinner fa-spin":"fa-check")})]}),(0,A.jsxs)(o.Z,{disabled:F,title:"Do not remove this chart",color:"danger",onClick:()=>j(!1),children:["cancel ",(0,A.jsx)("i",{className:"ms-2 fa fa-times"})]})]}):O?(0,A.jsx)(o.Z,{title:"Remove this chart",className:"chart-remove",color:"link",onClick:()=>j(l),children:(0,A.jsx)("i",{className:"fa fa-times text-darkgrey"})}):null,N&&"single value"===u?(0,A.jsxs)("div",{className:"dashboard single-value-chart",children:[(0,A.jsx)("div",{className:"title",children:r}),(0,A.jsx)("h1",{children:(0,q.Z)(Y)?Y.toFixed(2):Y})]}):N?(0,A.jsx)(C.Z,{options:M,series:Y,type:u,height:220}):null]})})},r)},T=()=>{let e=(new Date).getMonth();const t=[],r=["January","February","March","April","May","June","July","August","September","October","November","December"];for(let s=0;s<12;s+=1)t.push(r[e]),e-=1,e<0&&(e=11);return t.reverse()};const F=function(){const e=(0,n.Kw)(h.Z,(e=>e.theme));return(0,A.jsx)(C.Z,{options:(0,z.Z)({title:"HarperDB Satisfaction Over Time (Placeholder Example)",type:"line",labels:T(),theme:e}),series:[{name:"HarperDB Core",data:[98,98,97,99,98,97,100,100,100,100,100,100]},{name:"HarperDB Studio",data:[95,97,99,97,98,96,98,100,99,98,100,99]},{name:"HarperDB Documentation",data:[90,92,94,92,94,92,95,97,99,95,97,98]}],type:"line",height:220})};var H=r(576),M=r(2261);let Y;const B=function(){const{customer_id:e}=(0,d.UO)(),t=(0,d.s0)(),r=(0,u.VY)(),f=(0,n.Kw)(h.Z,(e=>e.auth)),b=(0,n.Kw)(p.Z,(e=>e.compute_stack_id)),g=(0,n.Kw)(p.Z,(e=>e.charts)),[x,v]=(0,s.useState)(!1),[j,y]=(0,s.useState)(!0),Z=(0,s.useCallback)((async t=>{const s=await(async e=>{let{auth:t,customer_id:r,compute_stack_id:s,id:a}=e;return(0,H.Z)({endpoint:"removeChart",method:"POST",payload:{user_id:t.user_id,customer_id:r,compute_stack_id:s,id:a},auth:t})})({auth:f,customer_id:e,compute_stack_id:b,id:t});s.error?r.error(s.message):(r.success(s.message),y(Date.now()))}),[r,f,b,e]);return(0,s.useEffect)((()=>(f&&(async()=>{Y=new AbortController,await(async e=>{let{auth:t,customer_id:r,compute_stack_id:s,signal:a}=e,i=null;try{return i=await(0,H.Z)({endpoint:"getCharts",method:"POST",payload:{customer_id:r,compute_stack_id:s,user_id:t.user_id},auth:t,signal:a}),i.error||p.Z.update((e=>{e.charts=i})),i}catch(o){return(0,M.Z)({type:"lms data",status:"error",url:K.Z.lms_api_url,operation:"getCharts",request:{customer_id:r,compute_stack_id:s,user_id:t.user_id},error:{catch:o.toString()},customer_id:r})}})({auth:f,customer_id:e,compute_stack_id:b,signal:Y.signal})})(),()=>{var e;return null===(e=Y)||void 0===e?void 0:e.abort()})),[f,j]),(0,m.Z)((()=>f&&y(Date.now())),K.Z.refresh_content_interval),(0,A.jsxs)("div",{id:"charts",children:[(0,A.jsx)(a.Z,{className:"mb-4",children:(0,A.jsxs)(i.Z,{className:"text-center",children:["To add charts to the dashboard, execute a",(0,A.jsxs)(o.Z,{id:"goToQueryPage",onClick:()=>t("/o/".concat(e,"/i/").concat(b,"/query")),size:"sm",color:"success",className:"px-2 mx-2",children:[(0,A.jsx)("i",{className:"fa fa-search text-small me-2 "})," query"]}),'Then click "create chart"']})}),(0,A.jsx)(l.Z,{children:null!==g&&void 0!==g&&g.length?g.map((e=>(0,A.jsx)(E,{chart:e,removeChart:Z,confirmDelete:x,setConfirmDelete:v},e.id))):(0,A.jsx)(c.Z,{lg:"6",xs:"12",className:"mb-3",children:(0,A.jsx)(a.Z,{className:"dashboard-chart",children:(0,A.jsx)(i.Z,{className:"text-nowrap position-relative",children:(0,A.jsx)(F,{})})})})})]})}},6512:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(9859);const a=async e=>{let{auth:t,url:r,sql:a,signal:i}=e;return(0,s.Z)({operation:{operation:"sql",sql:a},auth:t,url:r,signal:i})}},9356:(e,t,r)=>{r.d(t,{Z:()=>s});const s=e=>{let{title:t,type:r,labels:s,theme:a}=e;const i="light"===a?"#696969":"dark"===a?"#fff":"#212121";return{title:{text:t,style:{color:i}},chart:{type:r,animations:{enabled:!1},fontFamily:"Arial, Helvetica, Verdana, Sans-Serif",toolbar:{offsetX:-25,tools:{selection:!1,pan:!1,zoom:!1,zoomin:!1,zoomout:!1,reset:!1}}},labels:s,theme:{palette:"palette10"},plotOptions:{pie:{offsetY:10}},legend:{offsetY:5,labels:{colors:i}},markers:{size:[4],strokeColors:"dark"===a?"#212121":"#fff",strokeWidth:1,strokeOpacity:"dark"===a?.5:1,hover:{sizeOffset:0}},xaxis:{labels:{rotate:-60,maxHeight:80,style:{fontSize:"10px",colors:i}},tooltip:{enabled:!1}},yaxis:{labels:{style:{fontSize:"10px",colors:i}}}}}},3262:(e,t,r)=>{r.d(t,{Z:()=>s});const s=e=>!Number.isNaN(parseFloat(e))&&Number.isFinite(parseFloat(e))}}]);