"use strict";(self.webpackChunkharperdb_studio=self.webpackChunkharperdb_studio||[]).push([[938],{638:(e,s,a)=>{a.r(s),a.d(s,{default:()=>R});var r=a(7313),t=a(238),c=a(3516),l=a(6782),o=a(5399),i=a(9327),n=a(8467),d=a(1781),u=a(7387),m=a(3672),h=a.n(m),p=a(9842),x=a(5447),b=a(9859);const f=async e=>{let{auth:s,url:a,id:r}=e;return(0,b.Z)({operation:{operation:"get_job",id:r},auth:s,url:a})};var v=a(3263);var j=a(2261),g=a(4220),Z=a(6417);const _=function(){const e=(0,n.s0)(),{schema:s,table:a,customer_id:t,compute_stack_id:c}=(0,n.UO)(),m=(0,u.Kw)(x.Z,(e=>e.auth)),_=(0,u.Kw)(x.Z,(e=>e.url)),[k,w]=(0,r.useState)({}),[C,N]=(0,r.useState)({}),[R,S]=(0,r.useState)(!1),y=(0,r.useCallback)((async r=>{try{const[{status:l,message:o}]=await f({auth:m,url:_,id:r});return"ERROR"===l?["Error: CSV Load failed from URL","Error downloading CSV file"].some((e=>-1!==o.indexOf(e)))?N({error:"The URL did not return a valid csv file"}):["unsupported content type"].some((e=>-1!==o.indexOf(e)))?N({error:"File error: ".concat(o.split(",")[1])}):N({error:o.split(":")[1]}):"COMPLETE"!==l&&R?setTimeout((()=>y(r)),2e3):(x.Z.update((e=>{e.lastUpdate=Date.now()})),setTimeout((()=>e("/o/".concat(t,"/i/").concat(c,"/browse/").concat(s,"/").concat(a))),1e3))}catch(l){return setTimeout((()=>{x.Z.update((e=>{e.lastUpdate=Date.now()})),e("/o/".concat(t,"/i/").concat(c,"/browse/").concat(s,"/").concat(a))}),2e3)}}),[R]);return h()((async()=>{if(C.submitted)if((0,v.Z)(k.csv_url)){N({uploading:!0});const e=await(async e=>{let{schema:s,table:a,csv_url:r,auth:t,url:c}=e;return(0,b.Z)({operation:{operation:"csv_url_load",action:"insert",transact_to_cluster:!0,schema:s,table:a,csv_url:r},auth:t,url:c})})({schema:s,table:a,csv_url:k.csv_url,auth:m,url:_}),r=e.message.replace("Starting job with id ","");setTimeout((()=>y(r)),1e3)}else N({error:"Please provide a valid URL"}),setTimeout((()=>N({})),2e3)}),[C]),h()((()=>S(!0)),(()=>S(!1)),[]),(0,Z.jsx)(p.SV,{onError:(e,s)=>(0,j.Z)({error:{message:e.message,componentStack:s}}),FallbackComponent:g.Z,children:(0,Z.jsxs)(l.Z,{children:[(0,Z.jsxs)(o.Z,{xs:"12",lg:"4",className:"pt-1 pb-2",children:["Import A CSV File From URL",(0,Z.jsx)("br",{}),(0,Z.jsx)("span",{className:"text-small",children:"csv must be publicly accessible"})]}),(0,Z.jsx)(o.Z,{xs:"12",lg:"4",children:C.error?(0,Z.jsxs)("div",{className:"text-danger csv-status",children:[(0,Z.jsx)("i",{className:"fa fa-exclamation-triangle me-3"}),C.error]}):C.uploading?(0,Z.jsxs)("div",{className:"csv-status",children:[(0,Z.jsx)("i",{className:"fa fa-spin fa-spinner me-3"}),"uploading .csv into ",s,".",a]}):(0,Z.jsx)(d.Z,{onChange:e=>w({csv_url:e.target.value}),type:"text",invalid:k.csv_url&&!(0,v.Z)(k.csv_url),id:"csv_url",title:"csv url",placeholder:"CSV file URL",value:k.csv_url||"",disabled:C.submitted})}),(0,Z.jsx)(o.Z,{xs:"12",lg:"4",children:C.error?(0,Z.jsx)(i.Z,{id:"clearURL",block:!0,color:"danger",onClick:()=>{N({}),w({})},children:"Clear URL"}):(0,Z.jsx)(i.Z,{id:"importFromURL",disabled:!!Object.keys(C).length||!(0,v.Z)(k.csv_url),block:!0,color:"success",onClick:()=>N({submitted:!0}),children:"Import From URL"})})]})})};var k=a(3917),w=a(511);var C=a(1842);const N=function(){const e=(0,n.s0)(),{schema:s,table:a,customer_id:t,compute_stack_id:c}=(0,n.UO)(),d=(0,u.Kw)(x.Z,(e=>e.auth)),m=(0,u.Kw)(x.Z,(e=>e.url)),[v,_]=(0,r.useState)({}),[N,R]=(0,r.useState)({}),[S,y]=(0,r.useState)(!1),T=(0,r.useCallback)((async r=>{try{const[{status:l,message:o}]=await f({auth:d,url:m,id:r});return"ERROR"===l?-1!==o.indexOf("transaction aborted due to record(s) with a hash value that contains a forward slash")?R({error:"The CSV file contains a row with a forward slash in the hash field."}):-1!==o.indexOf("Invalid column name")?R({error:"The CSV file contains an invalid column name."}):R({error:o}):"COMPLETE"!==l&&S?setTimeout((()=>T(r)),1e3):setTimeout((()=>e("/o/".concat(t,"/i/").concat(c,"/browse/").concat(s,"/").concat(a))),1e3)}catch(l){return setTimeout((()=>{e("/o/".concat(t,"/i/").concat(c,"/browse/").concat(s,"/").concat(a))}),2e3)}}),[S]),U=(0,r.useCallback)((e=>{e.forEach((e=>{const s=new FileReader;s.onabort=()=>R({error:"File reading was aborted"}),s.onerror=()=>R({error:"file reading has failed"}),s.onload=()=>{R({processing:!0});const e=s.result.split(/\r\n|\n/).filter((e=>e.trim().length)).length-1;_({records:e,csv_file:s.result}),R({processed:!0})},e.size>w.Z.max_file_upload_size?R({error:"File exceeds 10MB Limit. Use URL Loader Above."}):s.readAsText(e)}))}),[]);return h()((async()=>{if(N.submitted)if(v.csv_file){R({uploading:!0});const e=await(async e=>{let{schema:s,table:a,csv_file:r,auth:t,url:c}=e;return(0,b.Z)({operation:{operation:"csv_data_load",action:"insert",transact_to_cluster:!0,schema:s,table:a,data:r},auth:t,url:c})})({schema:s,table:a,csv_file:v.csv_file,auth:d,url:m}),r=e.message.replace("Starting job with id ","");setTimeout((()=>T(r)),1e3)}else R({error:"Please select a valid CSV file"})}),[N]),h()((()=>y(!0)),(()=>y(!1)),[]),(0,Z.jsx)(p.SV,{onError:(e,s)=>(0,j.Z)({error:{message:e.message,componentStack:s}}),FallbackComponent:g.Z,children:(0,Z.jsxs)(l.Z,{children:[(0,Z.jsxs)(o.Z,{xs:"12",lg:"4",className:"pt-1 pb-2",children:["Upload A CSV File",(0,Z.jsx)("br",{}),(0,Z.jsx)("span",{className:"text-small",children:"from your computer (10MB limit)"})]}),(0,Z.jsx)(o.Z,{xs:"12",lg:"4",children:N.error?(0,Z.jsx)("div",{className:"text-danger csv-status",children:N.error}):N.uploading?(0,Z.jsxs)("div",{className:"csv-status",children:[(0,Z.jsx)("i",{className:"fa fa-spin fa-spinner me-3"}),"inserting ",(0,C.Z)(v.records)," records into ",s,".",a]}):N.processed?(0,Z.jsx)(i.Z,{id:"replaceFile",block:!0,color:"default",onClick:()=>{R({}),_({})},children:(0,Z.jsxs)("span",{className:"text-nowrap text-small",children:[(0,Z.jsx)("i",{className:"fa fa-thumbs-up text-success me-3"}),(0,C.Z)(v.records)," records. Click here to replace file."]})}):N.processing?(0,Z.jsxs)("div",{className:"csv-status",children:[(0,Z.jsx)("i",{className:"fa fa-spin fa-spinner"})," processing ",(0,C.Z)(v.records)," records"]}):(0,Z.jsx)(k.ZP,{onDrop:U,children:e=>{let{getRootProps:s,getInputProps:a}=e;return(0,Z.jsxs)("div",{...s(),className:"drop-zone",children:[(0,Z.jsx)("input",{...a()}),"Click or Drag to select a .csv file"]})}})}),(0,Z.jsx)(o.Z,{xs:"12",lg:"4",children:N.error?(0,Z.jsx)(i.Z,{id:"clearFile",color:"danger",block:!0,className:"px-5 clear-files",onClick:()=>{R({}),_({})},children:"Clear File"}):(0,Z.jsxs)(i.Z,{id:"insertRecords",block:!0,disabled:N.uploading||!v.csv_file,color:"success",onClick:()=>R({submitted:!0}),children:["Insert ",(0,C.Z)(v.records)," Records"]})})]})})};const R=function(){const e=(0,n.s0)(),{schema:s,table:a,customer_id:r,compute_stack_id:d}=(0,n.UO)();return(0,Z.jsxs)("div",{id:"csv-upload",children:[(0,Z.jsxs)("span",{className:"floating-card-header",children:[s," > ",a," > csv upload"]}),(0,Z.jsx)(t.Z,{className:"my-3",children:(0,Z.jsxs)(c.Z,{children:[(0,Z.jsx)(_,{}),(0,Z.jsx)("hr",{className:"my-3"}),(0,Z.jsx)(N,{}),(0,Z.jsx)("hr",{className:"my-3"}),(0,Z.jsxs)(l.Z,{children:[(0,Z.jsxs)(o.Z,{lg:"8",className:"py-1 d-none d-lg-inline-block",children:["Return to Table",(0,Z.jsx)("br",{}),(0,Z.jsx)("span",{className:"text-small",children:"do not upload csv data"})]}),(0,Z.jsx)(o.Z,{xs:"12",lg:"4",children:(0,Z.jsx)(i.Z,{id:"returnToTable",block:!0,color:"grey",onClick:()=>e("/o/".concat(r,"/i/").concat(d,"/browse/").concat(s,"/").concat(a)),children:"Return to Table"})})]})]})})]})}},3263:(e,s,a)=>{a.d(s,{Z:()=>r});const r=e=>!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}}]);